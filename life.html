<!DOCTYPE html>
<html>
<head>
    <script src="js/libs/fabric.js"></script>
    <title></title>

</head>
<body style="background-color: black">
<script>
var c = document.createElement('canvas');
c.width = document.body.offsetWidth.toString();
c.setAttribute('id', 'myCanvas');
c.height = window.innerHeight;
document.body.appendChild(c);
var canvas = new fabric.StaticCanvas('myCanvas');
canvas.renderOnAddition = false;
var cellSize = 8;
var cellSize2 = cellSize/2;
var numCellsHor = Math.ceil(canvas.getWidth()/cellSize);
var numCellsVer = Math.ceil(canvas.getHeight()/cellSize);
var lifeCycle = 90;
var life = [];
var nextLife = [];
var cells = [];

function getSumNeighbors(i, j, arr) {
    var sum = 0;

    for (var k=i-1; k<=i+1; ++k) {
        for (var l=j-1; l<=j+1; ++l) {
            if (k==i && l==j) {
                continue;
            }
            if (k < 0) {
                if (l < 0) {
                    arr[numCellsVer-1][numCellsHor-1] && sum++
                } else if (l >= 0 && l < numCellsHor) {
                    arr[numCellsVer-1][l] && sum++;
                } else if (l == numCellsHor) {
                    arr[numCellsVer-1][0] && sum++;
                }
            } else if (k >= 0 && k < numCellsVer) {
                if (l < 0) {
                    arr[k][numCellsHor-1] && sum++;
                } else if (l >= 0 && l < numCellsHor) {
                    arr[k][l] && sum++;
                } else if (l == numCellsHor) {
                    arr[k][0] && sum++;
                }
            } else if (k == numCellsVer) {
                if (l < 0) {
                    arr[0][numCellsHor-1] && sum++
                } else if (l >= 0 && l < numCellsHor) {
                    arr[0][l] && sum++;
                } else if (l == numCellsHor) {
                    arr[0][0] && sum++;
                }
            }
        }
    }

    return sum;
}

function runLife() {
    var x, y = cellSize2;
    for (var i = 0; i < numCellsVer; ++i) {
        life[i] = [];
        nextLife[i] = [];
        cells[i] = [];
        x = cellSize2;
        for (var j = 0; j < numCellsHor; ++j) {
            nextLife[i][j] = 0;
            cells[i][j] = new fabric.Rect({left: x, top: y, fill: 'green', width: cellSize-1, height: cellSize-1});
            canvas.add(cells[i][j]);
            life[i][j] = Math.floor((Math.random() * 10) + 1) > 6 ? 1 : 0;
            x += cellSize;
        }
        y += cellSize;
    }
    window.setInterval(function () {
        var sum=0;
        for (var i = 0; i < numCellsVer; ++i) {
            for (var j = 0; j < numCellsHor; ++j) {
                sum = getSumNeighbors(i, j, life);
                if (life[i][j] && sum < 2 || sum > 3) {
                    nextLife[i][j] = 0;
                    cells[i][j].set('fill', 'red');
                } else if (!life[i][j] && sum == 3) {
                    nextLife[i][j] = 1;
                    cells[i][j].set('fill', 'green');
                } else if (!life[i][j]) {
                    cells[i][j].set('fill', 'black');
                }
            }
        }
        for (var i = 0; i < numCellsVer; ++i) {
            life[i] = nextLife[i].slice(0);
        }
        canvas.renderAll();
    }, lifeCycle);


    return life;
}

runLife();
</script>
</body>
</html>