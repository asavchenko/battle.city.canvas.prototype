var Prototype={Version:"1.7.1",Browser:function(){var a=navigator.userAgent,b="[object Opera]"==Object.prototype.toString.call(window.opera);return{IE:!!window.attachEvent&&!b,Opera:b,WebKit:-1<a.indexOf("AppleWebKit/"),Gecko:-1<a.indexOf("Gecko")&&-1===a.indexOf("KHTML"),MobileSafari:/Apple.*Mobile/.test(a)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var a=window.Element||window.HTMLElement;return!(!a||!a.prototype)}(),SpecificElementExtensions:function(){if("undefined"!==
typeof window.HTMLDivElement)return!0;var a=document.createElement("div"),b=document.createElement("form"),c=!1;a.__proto__&&a.__proto__!==b.__proto__&&(c=!0);return c}()},ScriptFragment:"<script[^>]*>([\\S\\s]*?)\x3c/script\\s*>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(a){return a}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);
var Class=function(){function a(){}var b=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}();return{create:function(){function c(){this.initialize.apply(this,arguments)}var b=null,d=$A(arguments);Object.isFunction(d[0])&&(b=d.shift());Object.extend(c,Class.Methods);c.superclass=b;c.subclasses=[];b&&(a.prototype=b.prototype,c.prototype=new a,b.subclasses.push(c));for(var b=0,g=d.length;b<g;b++)c.addMethods(d[b]);c.prototype.initialize||(c.prototype.initialize=Prototype.emptyFunction);
return c.prototype.constructor=c},Methods:{addMethods:function(a){var f=this.superclass&&this.superclass.prototype,d=Object.keys(a);b&&(a.toString!=Object.prototype.toString&&d.push("toString"),a.valueOf!=Object.prototype.valueOf&&d.push("valueOf"));for(var g=0,e=d.length;g<e;g++){var h=d[g],k=a[h];if(f&&Object.isFunction(k)&&"$super"==k.argumentNames()[0]){var l=k,k=function(a){return function(){return f[a].apply(this,arguments)}}(h).wrap(l);k.valueOf=function(a){return function(){return a.valueOf.call(a)}}(l);
k.toString=function(a){return function(){return a.toString.call(a)}}(l)}this.prototype[h]=k}return this}}}}();
(function(){function a(a){switch(a){case null:return m;case void 0:return n}switch(typeof a){case "boolean":return p;case "number":return q;case "string":return u}return y}function b(a,c){for(var b in c)a[b]=c[b];return a}function c(a){return f("",{"":a},[])}function f(c,b,e){b=b[c];a(b)===y&&"function"===typeof b.toJSON&&(b=b.toJSON(c));c=k.call(b);switch(c){case w:case x:case A:b=b.valueOf()}switch(b){case null:return"null";case !0:return"true";case !1:return"false"}switch(typeof b){case "string":return b.inspect(!0);
case "number":return isFinite(b)?String(b):"null";case "object":for(var d=0,g=e.length;d<g;d++)if(e[d]===b)throw new TypeError("Cyclic reference to '"+b+"' in object");e.push(b);var h=[];if(c===t){d=0;for(g=b.length;d<g;d++){var l=f(d,b,e);h.push("undefined"===typeof l?"null":l)}h="["+h.join(",")+"]"}else{for(var m=Object.keys(b),d=0,g=m.length;d<g;d++)c=m[d],l=f(c,b,e),"undefined"!==typeof l&&h.push(c.inspect(!0)+":"+l);h="{"+h.join(",")+"}"}e.pop();return h}}function d(a){return JSON.stringify(a)}
function g(c){if(a(c)!==y)throw new TypeError;var b=[],e;for(e in c)l.call(c,e)&&b.push(e);if(s)for(var d=0;e=r[d];d++)l.call(c,e)&&b.push(e);return b}function e(a){return k.call(a)===t}function h(a){return"undefined"===typeof a}var k=Object.prototype.toString,l=Object.prototype.hasOwnProperty,m="Null",n="Undefined",p="Boolean",q="Number",u="String",y="Object",x="[object Boolean]",w="[object Number]",A="[object String]",t="[object Array]",z=window.JSON&&"function"===typeof JSON.stringify&&"0"===JSON.stringify(0)&&
"undefined"===typeof JSON.stringify(Prototype.K),r="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),s=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}();"function"==typeof Array.isArray&&(Array.isArray([])&&!Array.isArray({}))&&(e=Array.isArray);b(Object,{extend:b,inspect:function(a){try{return h(a)?"undefined":null===a?"null":a.inspect?a.inspect():String(a)}catch(c){if(c instanceof RangeError)return"...";throw c;}},
toJSON:z?d:c,toQueryString:function(a){return $H(a).toQueryString()},toHTML:function(a){return a&&a.toHTML?a.toHTML():String.interpret(a)},keys:Object.keys||g,values:function(a){var c=[],b;for(b in a)c.push(a[b]);return c},clone:function(a){return b({},a)},isElement:function(a){return!(!a||1!=a.nodeType)},isArray:e,isHash:function(a){return a instanceof Hash},isFunction:function(a){return"[object Function]"===k.call(a)},isString:function(a){return k.call(a)===A},isNumber:function(a){return k.call(a)===
w},isDate:function(a){return"[object Date]"===k.call(a)},isUndefined:h})})();
Object.extend(Function.prototype,function(){function a(a,c){for(var b=a.length,d=c.length;d--;)a[b+d]=c[d];return a}function b(c,b){c=f.call(c,0);return a(c,b)}function c(a){if(2>arguments.length&&Object.isUndefined(arguments[0]))return this;if(!Object.isFunction(this))throw new TypeError("The object is not callable.");var c=function(){},d=this,k=f.call(arguments,1),l=function(){var c=b(k,arguments),e=a,e=this instanceof l?this:a;return d.apply(e,c)};c.prototype=this.prototype;l.prototype=new c;return l}
var f=Array.prototype.slice,d={argumentNames:function(){var a=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return 1!=a.length||a[0]?a:[]},bindAsEventListener:function(c){var b=this,d=f.call(arguments,1);return function(f){f=a([f||window.event],d);return b.apply(c,f)}},curry:function(){if(!arguments.length)return this;var a=this,c=f.call(arguments,0);return function(){var d=b(c,arguments);return a.apply(this,
d)}},delay:function(a){var c=this,b=f.call(arguments,1);return window.setTimeout(function(){return c.apply(c,b)},1E3*a)},defer:function(){var c=a([0.01],arguments);return this.delay.apply(this,c)},wrap:function(c){var b=this;return function(){var d=a([b.bind(this)],arguments);return c.apply(this,d)}},methodize:function(){if(this._methodized)return this._methodized;var c=this;return this._methodized=function(){var b=a([this],arguments);return c.apply(null,b)}}};Function.prototype.bind||(d.bind=c);
return d}());(function(a){function b(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+"Z"}function c(){return this.toISOString()}a.toISOString||(a.toISOString=b);a.toJSON||(a.toJSON=c)})(Date.prototype);RegExp.prototype.match=RegExp.prototype.test;
RegExp.escape=function(a){return String(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};
var PeriodicalExecuter=Class.create({initialize:function(a,b){this.callback=a;this.frequency=b;this.currentlyExecuting=!1;this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),1E3*this.frequency)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute(),this.currentlyExecuting=!1}catch(a){throw this.currentlyExecuting=
!1,a;}}});Object.extend(String,{interpret:function(a){return null==a?"":String(a)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}});
Object.extend(String.prototype,function(){function a(a){if(Object.isFunction(a))return a;var c=new Template(a);return function(a){return c.evaluate(a)}}function b(){return this.replace(/^\s+/,"").replace(/\s+$/,"")}function c(a){var c=this.strip().match(/([^?#]*)(#.*)?$/);return c?c[1].split(a||"&").inject({},function(a,c){if((c=c.split("="))[0]){var b=decodeURIComponent(c.shift()),e=1<c.length?c.join("="):c[0];void 0!=e&&(e=decodeURIComponent(e));b in a?(Object.isArray(a[b])||(a[b]=[a[b]]),a[b].push(e)):
a[b]=e}return a}):{}}function f(a){var c=this.unfilterJSON(),b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;b.test(c)&&(c=c.replace(b,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));try{if(!a||c.isJSON())return eval("("+c+")")}catch(d){}throw new SyntaxError("Badly formed JSON string: "+this.inspect());}function d(){var a=this.unfilterJSON();return JSON.parse(a)}var g=window.JSON&&"function"===typeof JSON.parse&&
JSON.parse('{"test": true}').test;return{gsub:function(c,b){var d="",g=this,f;b=a(b);Object.isString(c)&&(c=RegExp.escape(c));if(!c.length&&!c.source)return b=b(""),b+g.split("").join(b)+b;for(;0<g.length;)(f=g.match(c))?(d+=g.slice(0,f.index),d+=String.interpret(b(f)),g=g.slice(f.index+f[0].length)):(d+=g,g="");return d},sub:function(c,b,d){b=a(b);d=Object.isUndefined(d)?1:d;return this.gsub(c,function(a){return 0>--d?a[0]:b(a)})},scan:function(a,c){this.gsub(a,c);return String(this)},truncate:function(a,
c){a=a||30;c=Object.isUndefined(c)?"...":c;return this.length>a?this.slice(0,a-c.length)+c:String(this)},strip:String.prototype.trim||b,stripTags:function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},stripScripts:function(){return this.replace(RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var a=RegExp(Prototype.ScriptFragment,"im");return(this.match(RegExp(Prototype.ScriptFragment,"img"))||[]).map(function(c){return(c.match(a)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(a){return eval(a)})},
escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.stripTags().replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")},toQueryParams:c,parseQuery:c,toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(a){return 1>a?"":Array(a+1).join(this)},camelize:function(){return this.replace(/-+(.)?/g,function(a,
c){return c?c.toUpperCase():""})},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/-/g,"_").toLowerCase()},dasherize:function(){return this.replace(/_/g,"-")},inspect:function(a){var c=this.replace(/[\x00-\x1f\\]/g,function(a){return a in String.specialChar?String.specialChar[a]:"\\u00"+a.charCodeAt().toPaddedString(2,
16)});return a?'"'+c.replace(/"/g,'\\"')+'"':"'"+c.replace(/'/g,"\\'")+"'"},unfilterJSON:function(a){return this.replace(a||Prototype.JSONFilter,"$1")},isJSON:function(){var a=this;if(a.blank())return!1;a=a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@");a=a.replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]");a=a.replace(/(?:^|:|,)(?:\s*\[)+/g,"");return/^[\],:{}\s]*$/.test(a)},evalJSON:g?d:f,include:function(a){return-1<this.indexOf(a)},startsWith:function(a){return 0===
this.lastIndexOf(a,0)},endsWith:function(a){var c=this.length-a.length;return 0<=c&&this.indexOf(a,c)===c},empty:function(){return""==this},blank:function(){return/^\s*$/.test(this)},interpolate:function(a,c){return(new Template(this,c)).evaluate(a)}}}());
var Template=Class.create({initialize:function(a,b){this.template=a.toString();this.pattern=b||Template.Pattern},evaluate:function(a){a&&Object.isFunction(a.toTemplateReplacements)&&(a=a.toTemplateReplacements());return this.template.gsub(this.pattern,function(b){if(null==a)return b[1]+"";var c=b[1]||"";if("\\"==c)return b[2];var f=a,d=b[3],g=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;b=g.exec(d);if(null==b)return c;for(;null!=b;){var e=b[1].startsWith("[")?b[2].replace(/\\\\]/g,"]"):b[1],f=f[e];if(null==
f||""==b[3])break;d=d.substring("["==b[3]?b[1].length:b[0].length);b=g.exec(d)}return c+String.interpret(f)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;
var $break={},Enumerable=function(){function a(a,c){a=a||Prototype.K;var b=!0;this.each(function(d,e){b=b&&!!a.call(c,d,e,this);if(!b)throw $break;},this);return b}function b(a,c){a=a||Prototype.K;var b=!1;this.each(function(d,e){if(b=!!a.call(c,d,e,this))throw $break;},this);return b}function c(a,c){a=a||Prototype.K;var b=[];this.each(function(d,e){b.push(a.call(c,d,e,this))},this);return b}function f(a,c){var b;this.each(function(d,e){if(a.call(c,d,e,this))throw b=d,$break;},this);return b}function d(a,
c){var b=[];this.each(function(d,e){a.call(c,d,e,this)&&b.push(d)},this);return b}function g(a){if(Object.isFunction(this.indexOf)&&-1!=this.indexOf(a))return!0;var c=!1;this.each(function(b){if(b==a)throw c=!0,$break;});return c}function e(){return this.map()}return{each:function(a,c){try{this._each(a,c)}catch(b){if(b!=$break)throw b;}return this},eachSlice:function(a,c,b){var d=-a,e=[],g=this.toArray();if(1>a)return g;for(;(d+=a)<g.length;)e.push(g.slice(d,d+a));return e.collect(c,b)},all:a,every:a,
any:b,some:b,collect:c,map:c,detect:f,findAll:d,select:d,filter:d,grep:function(a,c,b){c=c||Prototype.K;var d=[];Object.isString(a)&&(a=RegExp(RegExp.escape(a)));this.each(function(e,g){a.match(e)&&d.push(c.call(b,e,g,this))},this);return d},include:g,member:g,inGroupsOf:function(a,c){c=Object.isUndefined(c)?null:c;return this.eachSlice(a,function(b){for(;b.length<a;)b.push(c);return b})},inject:function(a,c,b){this.each(function(d,e){a=c.call(b,a,d,e,this)},this);return a},invoke:function(a){var c=
$A(arguments).slice(1);return this.map(function(b){return b[a].apply(b,c)})},max:function(a,c){a=a||Prototype.K;var b;this.each(function(d,e){d=a.call(c,d,e,this);if(null==b||d>=b)b=d},this);return b},min:function(a,c){a=a||Prototype.K;var b;this.each(function(d,e){d=a.call(c,d,e,this);if(null==b||d<b)b=d},this);return b},partition:function(a,c){a=a||Prototype.K;var b=[],d=[];this.each(function(e,g){(a.call(c,e,g,this)?b:d).push(e)},this);return[b,d]},pluck:function(a){var c=[];this.each(function(b){c.push(b[a])});
return c},reject:function(a,c){var b=[];this.each(function(d,e){a.call(c,d,e,this)||b.push(d)},this);return b},sortBy:function(a,c){return this.map(function(b,d){return{value:b,criteria:a.call(c,b,d,this)}},this).sort(function(a,c){var b=a.criteria,d=c.criteria;return b<d?-1:b>d?1:0}).pluck("value")},toArray:e,entries:e,zip:function(){var a=Prototype.K,c=$A(arguments);Object.isFunction(c.last())&&(a=c.pop());var b=[this].concat(c).map($A);return this.map(function(c,d){return a(b.pluck(d))})},size:function(){return this.toArray().length},
inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"},find:f}}();function $A(a){if(!a)return[];if("toArray"in Object(a))return a.toArray();for(var b=a.length||0,c=Array(b);b--;)c[b]=a[b];return c}function $w(a){return Object.isString(a)?(a=a.strip())?a.split(/\s+/):[]:[]}Array.from=$A;
(function(){function a(a,c){for(var b=0,d=this.length>>>0;b<d;b++)b in this&&a.call(c,this[b],b,this)}function b(){return p.call(this,0)}function c(a,c){if(null==this)throw new TypeError;var b=Object(this),d=b.length>>>0;if(0===d)return-1;c=Number(c);isNaN(c)?c=0:0!==c&&isFinite(c)&&(c=(0<c?1:-1)*Math.floor(Math.abs(c)));if(c>d)return-1;for(var e=0<=c?c:Math.max(d-Math.abs(c),0);e<d;e++)if(e in b&&b[e]===a)return e;return-1}function f(a,c){if(null==this)throw new TypeError;var b=Object(this),d=b.length>>>
0;if(0===d)return-1;Object.isUndefined(c)?c=d:(c=Number(c),isNaN(c)?c=0:0!==c&&isFinite(c)&&(c=(0<c?1:-1)*Math.floor(Math.abs(c))));for(d=0<=c?Math.min(c,d-1):d-Math.abs(c);0<=d;d--)if(d in b&&b[d]===a)return d;return-1}function d(a){var c=[],b=p.call(arguments,0),d,e=0;b.unshift(this);for(var g=0,f=b.length;g<f;g++)if(d=b[g],!Object.isArray(d)||"callee"in d)c[e++]=d;else for(var h=0,l=d.length;h<l;h++)h in d&&(c[e]=d[h]),e++;c.length=e;return c}function g(a){return function(){if(0===arguments.length)return a.call(this,
Prototype.K);if(void 0===arguments[0]){var c=p.call(arguments,1);c.unshift(Prototype.K);return a.apply(this,c)}return a.apply(this,arguments)}}function e(a,c){if(null==this)throw new TypeError;a=a||Prototype.K;for(var b=Object(this),d=[],e=0,g=0,f=b.length>>>0;g<f;g++)g in b&&(d[e]=a.call(c,b[g],g,b)),e++;d.length=e;return d}function h(a,c){if(null==this||!Object.isFunction(a))throw new TypeError;for(var b=Object(this),d=[],e,g=0,f=b.length>>>0;g<f;g++)g in b&&(e=b[g],a.call(c,e,g,b)&&d.push(e));
return d}function k(a,c){if(null==this)throw new TypeError;a=a||Prototype.K;for(var b=Object(this),d=0,e=b.length>>>0;d<e;d++)if(d in b&&a.call(c,b[d],d,b))return!0;return!1}function l(a,c){if(null==this)throw new TypeError;a=a||Prototype.K;for(var b=Object(this),d=0,e=b.length>>>0;d<e;d++)if(d in b&&!a.call(c,b[d],d,b))return!1;return!0}function m(a,c,b){c=c||Prototype.K;return u.call(this,c.bind(b),a)}var n=Array.prototype,p=n.slice,q=n.forEach;q||(q=a);n.map&&(e=g(Array.prototype.map));n.filter&&
(h=Array.prototype.filter);n.some&&(k=g(Array.prototype.some));n.every&&(l=g(Array.prototype.every));var u=n.reduce;n.reduce||(m=Enumerable.inject);Object.extend(n,Enumerable);n._reverse||(n._reverse=n.reverse);Object.extend(n,{_each:q,map:e,collect:e,select:h,filter:h,findAll:h,some:k,any:k,every:l,all:l,inject:m,clear:function(){this.length=0;return this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(a){return null!=a})},
flatten:function(){return this.inject([],function(a,c){if(Object.isArray(c))return a.concat(c.flatten());a.push(c);return a})},without:function(){var a=p.call(arguments,0);return this.select(function(c){return!a.include(c)})},reverse:function(a){return(!1===a?this.toArray():this)._reverse()},uniq:function(a){return this.inject([],function(c,b,d){0!=d&&(a?c.last()==b:c.include(b))||c.push(b);return c})},intersect:function(a){return this.uniq().findAll(function(c){return-1!==a.indexOf(c)})},clone:b,
toArray:b,size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"}});(function(){return 1!==[].concat(arguments)[0][0]})(1,2)&&(n.concat=d);n.indexOf||(n.indexOf=c);n.lastIndexOf||(n.lastIndexOf=f)})();function $H(a){return new Hash(a)}
var Hash=Class.create(Enumerable,function(){function a(){return Object.clone(this._object)}function b(a,b){if(Object.isUndefined(b))return a;b=String.interpret(b);b=b.gsub(/(\r)?\n/,"\r\n");b=encodeURIComponent(b);b=b.gsub(/%20/,"+");return a+"="+b}return{initialize:function(a){this._object=Object.isHash(a)?a.toObject():Object.clone(a)},_each:function(a,b){for(var d in this._object){var g=this._object[d],e=[d,g];e.key=d;e.value=g;a.call(b,e)}},set:function(a,b){return this._object[a]=b},get:function(a){if(this._object[a]!==
Object.prototype[a])return this._object[a]},unset:function(a){var b=this._object[a];delete this._object[a];return b},toObject:a,toTemplateReplacements:a,keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(a){var b=this.detect(function(b){return b.value===a});return b&&b.key},merge:function(a){return this.clone().update(a)},update:function(a){return(new Hash(a)).inject(this,function(a,c){a.set(c.key,c.value);return a})},toQueryString:function(){return this.inject([],
function(a,f){var d=encodeURIComponent(f.key),g=f.value;if(g&&"object"==typeof g){if(Object.isArray(g)){for(var e=[],h=0,k=g.length,l;h<k;h++)l=g[h],e.push(b(d,l));return a.concat(e)}}else a.push(b(d,g));return a}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(a){return a.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:a,clone:function(){return new Hash(this)}}}());Hash.from=$H;
Object.extend(Number.prototype,function(){return{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(a,b){$R(0,this,!0).each(a,b);return this},toPaddedString:function(a,b){var c=this.toString(b||10);return"0".times(a-c.length)+c},abs:function(){return Math.abs(this)},round:function(){return Math.round(this)},ceil:function(){return Math.ceil(this)},floor:function(){return Math.floor(this)}}}());function $R(a,b,c){return new ObjectRange(a,b,c)}
var ObjectRange=Class.create(Enumerable,function(){return{initialize:function(a,b,c){this.start=a;this.end=b;this.exclusive=c},_each:function(a,b){for(var c=this.start;this.include(c);)a.call(b,c),c=c.succ()},include:function(a){return a<this.start?!1:this.exclusive?a<this.end:a<=this.end}}}()),Abstract={},Try={these:function(){for(var a,b=0,c=arguments.length;b<c;b++){var f=arguments[b];try{a=f();break}catch(d){}}return a}},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},
function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0,Responders:{responders:[],_each:function(a,b){this.responders._each(a,b)},register:function(a){this.include(a)||this.responders.push(a)},unregister:function(a){this.responders=this.responders.without(a)},dispatch:function(a,b,c,f){this.each(function(d){if(Object.isFunction(d[a]))try{d[a].apply(d,[b,c,f])}catch(g){}})}}};Object.extend(Ajax.Responders,Enumerable);
Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(a){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0};Object.extend(this.options,a||{});this.options.method=this.options.method.toLowerCase();Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}});
Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function($super,b,c){$super(c);this.transport=Ajax.getTransport();this.request(b)},request:function(a){this.url=a;this.method=this.options.method;a=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);["get","post"].include(this.method)||(a+=(a?"&":"")+"_method="+this.method,this.method="post");a&&"get"===this.method&&(this.url+=(this.url.include("?")?"&":"?")+a);this.parameters=
a.toQueryParams();try{var b=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(b);Ajax.Responders.dispatch("onCreate",this,b);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body="post"==this.method?this.options.postBody||a:null;this.transport.send(this.body);if(!this.options.asynchronous&&
this.transport.overrideMimeType)this.onStateChange()}catch(c){this.dispatchException(c)}},onStateChange:function(){var a=this.transport.readyState;1<a&&(4!=a||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var a={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};"post"==this.method&&(a["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+
this.options.encoding:""),this.transport.overrideMimeType&&2005>(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]&&(a.Connection="close"));if("object"==typeof this.options.requestHeaders){var b=this.options.requestHeaders;if(Object.isFunction(b.push))for(var c=0,f=b.length;c<f;c+=2)a[b[c]]=b[c+1];else $H(b).each(function(c){a[c.key]=c.value})}for(var d in a)this.transport.setRequestHeader(d,a[d])},success:function(){var a=this.getStatus();return!a||200<=a&&300>a||304==a},getStatus:function(){try{return 1223===
this.transport.status?204:this.transport.status||0}catch(a){return 0}},respondToReadyState:function(a){a=Ajax.Request.Events[a];var b=new Ajax.Response(this);if("Complete"==a){try{this._complete=!0,(this.options["on"+b.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(b,b.headerJSON)}catch(c){this.dispatchException(c)}var f=b.getHeader("Content-type");("force"==this.options.evalJS||this.options.evalJS&&this.isSameOrigin()&&f&&f.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&
this.evalResponse()}try{(this.options["on"+a]||Prototype.emptyFunction)(b,b.headerJSON),Ajax.Responders.dispatch("on"+a,this,b,b.headerJSON)}catch(d){this.dispatchException(d)}"Complete"==a&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var a=this.url.match(/^\s*https?:\/\/[^\/]*/);return!a||a[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(a){try{return this.transport.getResponseHeader(a)||
null}catch(b){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(a){this.dispatchException(a)}},dispatchException:function(a){(this.options.onException||Prototype.emptyFunction)(this,a);Ajax.Responders.dispatch("onException",this,a)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];
Ajax.Response=Class.create({initialize:function(a){this.request=a;a=this.transport=a.transport;var b=this.readyState=a.readyState;if(2<b&&!Prototype.Browser.IE||4==b)this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(a.responseText),this.headerJSON=this._getHeaderJSON();4==b&&(a=a.responseXML,this.responseXML=Object.isUndefined(a)?null:a,this.responseJSON=this._getResponseJSON())},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||
""}catch(a){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(a){return null}},getResponseHeader:function(a){return this.transport.getResponseHeader(a)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var a=this.getHeader("X-JSON");if(!a)return null;try{a=decodeURIComponent(escape(a))}catch(b){}try{return a.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(c){this.request.dispatchException(c)}},
_getResponseJSON:function(){var a=this.request.options;if(!a.evalJSON||"force"!=a.evalJSON&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(a.sanitizeJSON||!this.request.isSameOrigin())}catch(b){this.request.dispatchException(b)}}});
Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,b,c,f){this.container={success:b.success||b,failure:b.failure||(b.success?null:b)};f=Object.clone(f);var d=f.onComplete;f.onComplete=function(c,b){this.updateContent(c.responseText);Object.isFunction(d)&&d(c,b)}.bind(this);$super(c,f)},updateContent:function(a){var b=this.container[this.success()?"success":"failure"],c=this.options;c.evalScripts||(a=a.stripScripts());if(b=$(b))if(c.insertion)if(Object.isString(c.insertion)){var f=
{};f[c.insertion]=a;b.insert(f)}else c.insertion(b,a);else b.update(a)}});
Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,b,c,f){$super(f);this.onComplete=this.options.onComplete;this.frequency=this.options.frequency||2;this.decay=this.options.decay||1;this.updater={};this.container=b;this.url=c;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},
updateComplete:function(a){this.options.decay&&(this.decay=a.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=a.responseText);this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
(function(a){function b(a){if(1<arguments.length){for(var d=0,e=[],g=arguments.length;d<g;d++)e.push(b(arguments[d]));return e}Object.isString(a)&&(a=document.getElementById(a));return c.extend(a)}function c(a,b){b=b||{};a=a.toLowerCase();if(ga&&b.name)return a="<"+a+' name="'+b.name+'">',delete b.name,c.writeAttribute(document.createElement(a),b);U[a]||(U[a]=c.extend(document.createElement(a)));var d="select"===a||"type"in b?document.createElement(a):U[a].cloneNode(!1);return c.writeAttribute(d,
b)}function f(a,c){a=b(a);if(c&&c.toElement)c=c.toElement();else if(!Object.isElement(c)){c=Object.toHTML(c);var d=a.ownerDocument.createRange();d.selectNode(a);c.evalScripts.bind(c).defer();c=d.createContextualFragment(c.stripScripts())}a.parentNode.replaceChild(c,a);return a}function d(a,d){a=b(a);d&&d.toElement&&(d=d.toElement());if(Object.isElement(d))return a.parentNode.replaceChild(d,a),a;d=Object.toHTML(d);var e=a.parentNode,f=e.tagName.toUpperCase();if(f in S.tags){var h=c.next(a),f=g(f,d.stripScripts());
e.removeChild(a);f.each(h?function(a){e.insertBefore(a,h)}:function(a){e.appendChild(a)})}else a.outerHTML=d.stripScripts();d.evalScripts.bind(d).defer();return a}function g(a,c,b){var d=S.tags[a];a=K;var e=!!d;!e&&b&&(e=!0,d=["","",0]);if(e)for(a.innerHTML="&#160;"+d[0]+c+d[1],a.removeChild(a.firstChild),c=d[2];c--;)a=a.firstChild;else a.innerHTML=c;return $A(a.childNodes)}function e(a){var b=D(a);b&&(c.stopObserving(a),X||(a._prototypeUID=Y),delete c.Storage[b])}function h(a,d,e){a=b(a);e=e||-1;
for(var g=[];(a=a[d])&&(a.nodeType===Node.ELEMENT_NODE&&g.push(c.extend(a)),g.length!==e););return g}function k(a){var d=[];for(a=b(a).firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&d.push(c.extend(a)),a=a.nextSibling;return d}function l(a){return h(a,"previousSibling")}function m(a){return h(a,"nextSibling")}function n(a,d,e,g){a=b(a);e=e||0;g=g||0;Object.isNumber(e)&&(g=e,e=null);for(;a=a[d];)if(1===a.nodeType&&!(e&&!Prototype.Selector.match(a,e)||0<=--g))return c.extend(a)}function p(a){a=b(a);
var c=ca.call(arguments,1).join(", ");return Prototype.Selector.select(c,a)}function q(a,c){a=b(a);for(c=b(c);a=a.parentNode;)if(a===c)return!0;return!1}function u(a,c){a=b(a);c=b(c);return c.contains?c.contains(a)&&c!==a:q(a,c)}function y(a,c){a=b(a);c=b(c);return 8===(a.compareDocumentPosition(c)&8)}function x(a,c){return b(a).getAttribute(c)}function w(a,c){a=b(a);var d=O.read;if(d.values[c])return d.values[c](a,c);d.names[c]&&(c=d.names[c]);return c.include(":")?a.attributes&&a.attributes[c]?
a.attributes[c].value:null:a.getAttribute(c)}function A(a,c){return"title"===c?a.title:a.getAttribute(c)}function t(a){if(Z[a])return Z[a];var c=RegExp("(^|\\s+)"+a+"(\\s+|$)");return Z[a]=c}function z(a,c){if(a=b(a)){var d=a.className;return 0===d.length?!1:d===c?!0:t(c).test(d)}}function r(a,c){return a.getAttribute(c,2)}function s(a,c){return b(a).hasAttribute(c)?c:null}function B(a,d){a=b(a);d="float"===d||"cssFloat"===d?"styleFloat":d.camelize();var e=a.style[d];!e&&a.currentStyle&&(e=a.currentStyle[d]);
return"opacity"!==d||V?"auto"===e?"width"!==d&&"height"!==d||!c.visible(a)?null:c.measure(a,d)+"px":e:H(a)}function C(a,c){a=b(a);1==c||""===c?c="":1E-5>c&&(c=0);a.style.opacity=c;return a}function F(a,d){if(V)return C(a,d);var e=b(a);e.currentStyle.hasLayout||(e.style.zoom=1);a=e;var e=c.getStyle(a,"filter"),g=a.style;if(1==d||""===d)return(e=(e||"").replace(/alpha\([^\)]*\)/gi,""))?g.filter=e:g.removeAttribute("filter"),a;1E-5>d&&(d=0);g.filter=(e||"").replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+
100*d+")";return a}function I(a){return c.getStyle(a,"opacity")}function H(a){if(V)return I(a);a=c.getStyle(a,"filter");if(0===a.length)return 1;a=(a||"").match(/alpha\(opacity=(.*)\)/);return a[1]?parseFloat(a[1])/100:1}function D(a){if(a===window)return 0;"undefined"===typeof a._prototypeUID&&(a._prototypeUID=c.Storage.UID++);return a._prototypeUID}function v(a){return a===window?0:a==document?1:a.uniqueID}function G(a){if(a=b(a))return a=D(a),c.Storage[a]||(c.Storage[a]=$H()),c.Storage[a]}function E(a,
c){for(var b in c){var d=c[b];!Object.isFunction(d)||b in a||(a[b]=d.methodize())}}function P(a){if(!a||D(a)in W||a.nodeType!==Node.ELEMENT_NODE||a==window)return a;var c=Object.clone(aa),b=a.tagName.toUpperCase();R[b]&&Object.extend(c,R[b]);E(a,c);W[D(a)]=!0;return a}function ha(a){if(!a||D(a)in W)return a;var b=a.tagName;b&&/^(?:object|applet|embed)$/i.test(b)&&(E(a,c.Methods),E(a,c.Methods.Simulated),E(a,c.Methods.ByTag[b.toUpperCase()]));return a}function da(a,c){a=a.toUpperCase();R[a]||(R[a]=
{});Object.extend(R[a],c)}function ba(a,c,b){Object.isUndefined(b)&&(b=!1);for(var d in c){var e=c[d];Object.isFunction(e)&&(b&&d in a||(a[d]=e.methodize()))}}function ia(a){var c,b={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",
TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};b[a]&&(c="HTML"+b[a]+"Element");if(window[c])return window[c];c="HTML"+a+"Element";if(window[c])return window[c];c="HTML"+a.capitalize()+"Element";if(window[c])return window[c];a=document.createElement(a);return a.__proto__||a.constructor.prototype}var Y,ca=Array.prototype.slice,K=document.createElement("div");a.$=b;a.Node||(a.Node={});a.Node.ELEMENT_NODE||Object.extend(a.Node,
{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});var U={},ga=function(){try{var a=document.createElement('<input name="x">');return"input"===a.tagName.toLowerCase()&&"x"===a.name}catch(c){return!1}}(),L=a.Element;a.Element=c;Object.extend(a.Element,L||{});L&&(a.Element.prototype=L.prototype);c.Methods={ByTag:{},Simulated:{}};
var L={},ea={id:"id",className:"class"};L.inspect=function(a){a=b(a);var c="<"+a.tagName.toLowerCase(),d,e,g;for(g in ea)d=ea[g],(e=(a[g]||"").toString())&&(c+=" "+d+"="+e.inspect(!0));return c+">"};Object.extend(L,{visible:function(a){return"none"!==b(a).style.display},toggle:function(a,d){a=b(a);Object.isUndefined(d)&&(d=!c.visible(a));c[d?"show":"hide"](a);return a},hide:function(a){a=b(a);a.style.display="none";return a},show:function(a){a=b(a);a.style.display="";return a}});var M=function(){var a=
document.createElement("select"),c=!0;a.innerHTML='<option value="test">test</option>';a.options&&a.options[0]&&(c="OPTION"!==a.options[0].nodeName.toUpperCase());return c}(),Q=function(){try{var a=document.createElement("table");if(a&&a.tBodies)return a.innerHTML="<tbody><tr><td>test</td></tr></tbody>","undefined"==typeof a.tBodies[0]}catch(c){return!0}}(),fa=function(){try{var a=document.createElement("div");a.innerHTML="<link />";return 0===a.childNodes.length}catch(c){return!0}}(),ja=M||Q||fa,
ka=function(){var a=document.createElement("script"),c=!1;try{a.appendChild(document.createTextNode("")),c=!a.firstChild||a.firstChild&&3!==a.firstChild.nodeType}catch(b){c=!0}return c}(),S={before:function(a,c){a.parentNode.insertBefore(c,a)},top:function(a,c){a.insertBefore(c,a.firstChild)},bottom:function(a,c){a.appendChild(c)},after:function(a,c){a.parentNode.insertBefore(c,a.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>",
"</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},M=S.tags;Object.extend(M,{THEAD:M.TBODY,TFOOT:M.TBODY,TH:M.TD});"outerHTML"in document.documentElement&&(f=d);Object.extend(L,{remove:function(a){a=b(a);a.parentNode.removeChild(a);return a},update:function(a,c){a=b(a);for(var d=a.getElementsByTagName("*"),f=d.length;f--;)e(d[f]);c&&c.toElement&&(c=c.toElement());if(Object.isElement(c))return a.update().insert(c);c=Object.toHTML(c);
f=a.tagName.toUpperCase();if("SCRIPT"===f&&ka)return a.text=c,a;if(ja)if(f in S.tags){for(;a.firstChild;)a.removeChild(a.firstChild);for(var d=g(f,c.stripScripts()),f=0,h;h=d[f];f++)a.appendChild(h)}else if(fa&&Object.isString(c)&&-1<c.indexOf("<link")){for(;a.firstChild;)a.removeChild(a.firstChild);d=g(f,c.stripScripts(),!0);for(f=0;h=d[f];f++)a.appendChild(h)}else a.innerHTML=c.stripScripts();else a.innerHTML=c.stripScripts();c.evalScripts.bind(c).defer();return a},replace:f,insert:function(a,c){a=
b(a);(Object.isUndefined(c)||null===c?0:Object.isString(c)||Object.isNumber(c)||Object.isElement(c)||c.toElement||c.toHTML)&&(c={bottom:c});for(var d in c){var e=a,f=c[d],h=d,h=h.toLowerCase(),l=S[h];f&&f.toElement&&(f=f.toElement());if(Object.isElement(f))l(e,f);else{var f=Object.toHTML(f),m=("before"===h||"after"===h?e.parentNode:e).tagName.toUpperCase(),m=g(m,f.stripScripts());"top"!==h&&"after"!==h||m.reverse();for(var h=0,n=void 0;n=m[h];h++)l(e,n);f.evalScripts.bind(f).defer()}}return a},wrap:function(a,
d,e){a=b(a);Object.isElement(d)?b(d).writeAttribute(e||{}):d=Object.isString(d)?new c(d,e):new c("div",d);a.parentNode&&a.parentNode.replaceChild(d,a);d.appendChild(a);return d},cleanWhitespace:function(a){a=b(a);for(var c=a.firstChild;c;){var d=c.nextSibling;c.nodeType!==Node.TEXT_NODE||/\S/.test(c.nodeValue)||a.removeChild(c);c=d}return a},empty:function(a){return b(a).innerHTML.blank()},clone:function(a,d){if(a=b(a)){var e=a.cloneNode(d);if(!X&&(e._prototypeUID=Y,d))for(var g=c.select(e,"*"),f=
g.length;f--;)g[f]._prototypeUID=Y;return c.extend(e)}},purge:function(a){if(a=b(a)){e(a);a=a.getElementsByTagName("*");for(var c=a.length;c--;)e(a[c]);return null}}});Object.extend(L,{recursivelyCollect:h,ancestors:function(a){return h(a,"parentNode")},descendants:function(a){return c.select(a,"*")},firstDescendant:function(a){for(a=b(a).firstChild;a&&a.nodeType!==Node.ELEMENT_NODE;)a=a.nextSibling;return b(a)},immediateDescendants:k,previousSiblings:l,nextSiblings:m,siblings:function(a){a=b(a);
var c=l(a);a=m(a);return c.reverse().concat(a)},match:function(a,c){a=b(a);return Object.isString(c)?Prototype.Selector.match(a,c):c.match(a)},up:function(a,c,d){a=b(a);return 1===arguments.length?b(a.parentNode):n(a,"parentNode",c,d)},down:function(a,d,e){a=b(a);d=d||0;e=e||0;Object.isNumber(d)&&(e=d,d="*");a=Prototype.Selector.select(d,a)[e];return c.extend(a)},previous:function(a,c,b){return n(a,"previousSibling",c,b)},next:function(a,c,b){return n(a,"nextSibling",c,b)},select:p,adjacent:function(a){a=
b(a);for(var d=ca.call(arguments,1).join(", "),e=c.siblings(a),g=[],f=0,h;h=e[f];f++)Prototype.Selector.match(h,d)&&g.push(h);return g},descendantOf:K.compareDocumentPosition?y:K.contains?u:q,getElementsBySelector:p,childElements:k});var la=1;(function(){K.setAttribute("onclick",Prototype.emptyFunction);var a="function"===typeof K.getAttribute("onclick");K.removeAttribute("onclick");return a})()?x=w:Prototype.Browser.Opera&&(x=A);a.Element.Methods.Simulated.hasAttribute=function(a,c){c=O.has[c]||
c;var d=b(a).getAttributeNode(c);return!(!d||!d.specified)};var Z={},O={},M="className",Q="for";K.setAttribute(M,"x");"x"!==K.className&&(K.setAttribute("class","x"),"x"===K.className&&(M="class"));var N=document.createElement("label");N.setAttribute(Q,"x");"x"!==N.htmlFor&&(N.setAttribute("htmlFor","x"),"x"===N.htmlFor&&(Q="htmlFor"));N=null;K.onclick=Prototype.emptyFunction;var N=K.getAttribute("onclick"),J;-1<String(N).indexOf("{")?J=function(a,c){var b=a.getAttribute(c);if(!b)return null;b=b.toString();
b=b.split("{")[1];b=b.split("}")[0];return b.strip()}:""===N&&(J=function(a,c){var b=a.getAttribute(c);return b?b.strip():null});O.read={names:{"class":M,className:M,"for":Q,htmlFor:Q},values:{style:function(a){return a.style.cssText.toLowerCase()},title:function(a){return a.title}}};O.write={names:{className:"class",htmlFor:"for",cellpadding:"cellPadding",cellspacing:"cellSpacing"},values:{checked:function(a,c){a.checked=!!c},style:function(a,c){a.style.cssText=c?c:""}}};O.has={names:{}};Object.extend(O.write.names,
O.read.names);M=$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder");for(Q=0;N=M[Q];Q++)O.write.names[N.toLowerCase()]=N,O.has.names[N.toLowerCase()]=N;Object.extend(O.read.values,{href:r,src:r,type:function(a,c){return a.getAttribute(c)},action:function(a,c){var b=a.getAttributeNode(c);return b?b.value:""},disabled:s,checked:s,readonly:s,multiple:s,onload:J,onunload:J,onclick:J,ondblclick:J,onmousedown:J,onmouseup:J,onmouseover:J,onmousemove:J,
onmouseout:J,onfocus:J,onblur:J,onkeypress:J,onkeydown:J,onkeyup:J,onsubmit:J,onreset:J,onselect:J,onchange:J});Object.extend(L,{identify:function(a){a=b(a);var d=c.readAttribute(a,"id");if(d)return d;do d="anonymous_element_"+la++;while(b(d));c.writeAttribute(a,"id",d);return d},readAttribute:x,writeAttribute:function(a,c,d){a=b(a);var e={},g=O.write;"object"===typeof c?e=c:e[c]=Object.isUndefined(d)?!0:d;for(var f in e)c=g.names[f]||f,d=e[f],g.values[f]&&(c=g.values[f](a,d)),!1===d||null===d?a.removeAttribute(c):
!0===d?a.setAttribute(c,c):a.setAttribute(c,d);return a},classNames:function(a){return new c.ClassNames(a)},hasClassName:z,addClassName:function(a,c){if(a=b(a))return z(a,c)||(a.className+=(a.className?" ":"")+c),a},removeClassName:function(a,c){if(a=b(a))return a.className=a.className.replace(t(c)," ").strip(),a},toggleClassName:function(a,d,e){if(a=b(a))return Object.isUndefined(e)&&(e=!z(a,d)),(0,c[e?"addClassName":"removeClassName"])(a,d)}});var V;K.style.cssText="opacity:.55";V=/^0.55/.test(K.style.opacity);
Object.extend(L,{setStyle:function(a,d){a=b(a);var e=a.style;if(Object.isString(d))return e.cssText+=";"+d,d.include("opacity")&&(e=d.match(/opacity:\s*(\d?\.?\d*)/)[1],c.setOpacity(a,e)),a;for(var g in d)if("opacity"===g)c.setOpacity(a,d[g]);else{var f=d[g];if("float"===g||"cssFloat"===g)g=Object.isUndefined(e.styleFloat)?"cssFloat":"styleFloat";e[g]=f}return a},getStyle:function(a,c){a=b(a);c="float"===c||"styleFloat"===c?"cssFloat":c.camelize();var d=a.style[c];d&&"auto"!==d||(d=(d=document.defaultView.getComputedStyle(a,
null))?d[c]:null);return"opacity"===c?d?parseFloat(d):1:"auto"===d?null:d},setOpacity:C,getOpacity:I});"styleFloat"in K.style&&(L.getStyle=B,L.setOpacity=F,L.getOpacity=H);a.Element.Storage={UID:1};var X="uniqueID"in K;X&&(D=v);Object.extend(L,{getStorage:G,store:function(a,c,d){if(a=b(a)){var e=G(a);2===arguments.length?e.update(c):e.set(c,d);return a}},retrieve:function(a,c,d){if(a=b(a)){a=G(a);var e=a.get(c);Object.isUndefined(e)&&(a.set(c,d),e=d);return e}}});var aa={},R=c.Methods.ByTag,T=Prototype.BrowserFeatures;
!T.ElementExtensions&&"__proto__"in K&&(a.HTMLElement={},a.HTMLElement.prototype=K.__proto__,T.ElementExtensions=!0);J=function(a){if("undefined"===typeof window.Element)return!1;var c=window.Element.prototype;if(c){var b="_"+(Math.random()+"").slice(2);a=document.createElement(a);c[b]="x";a="x"!==a[b];delete c[b];return a}return!1}("object");var W={};T.SpecificElementExtensions&&(P=J?ha:Prototype.K);Object.extend(a.Element,{extend:P,addMethods:function(a){0===arguments.length&&(Object.extend(Form,
Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(c.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)}));if(2===arguments.length){var b=a;a=arguments[1]}if(b)if(Object.isArray(b))for(var d=0,e;e=b[d];d++)da(e,a);else da(b,a);else Object.extend(c.Methods,a||{});b=window.HTMLElement?HTMLElement.prototype:c.prototype;
T.ElementExtensions&&(ba(b,c.Methods),ba(b,c.Methods.Simulated,!0));if(T.SpecificElementExtensions)for(e in c.Methods.ByTag)b=ia(e),Object.isUndefined(b)||ba(b.prototype,R[e]);Object.extend(c,c.Methods);Object.extend(c,c.Methods.Simulated);delete c.ByTag;delete c.Simulated;c.extend.refresh();U={}}});a.Element.extend.refresh=P===Prototype.K?Prototype.emptyFunction:function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(aa,c.Methods),Object.extend(aa,c.Methods.Simulated),W={})};c.addMethods(L)})(this);
(function(){function a(a,c){a=$(a);var b=a.style[c];b&&"auto"!==b||(b=(b=document.defaultView.getComputedStyle(a,null))?b[c]:null);return"opacity"===c?b?parseFloat(b):1:"auto"===b?null:b}function b(a,c){var b=a.style[c];!b&&a.currentStyle&&(b=a.currentStyle[c]);return b}function c(a,c){var b=a.offsetWidth,d=f(a,"borderLeftWidth",c)||0,e=f(a,"borderRightWidth",c)||0,g=f(a,"paddingLeft",c)||0,h=f(a,"paddingRight",c)||0;return b-d-e-g-h}function f(c,b,d){var e=null;Object.isElement(c)&&(e=c,c=a(e,b));
if(null===c||Object.isUndefined(c))return null;if(/^(?:-)?\d+(\.\d+)?(px)?$/i.test(c))return window.parseFloat(c);var g=c.include("%"),f=d===document.viewport;return!/\d/.test(c)||!e||!e.runtimeStyle||g&&f?e&&g?(d=d||e.parentNode,c=(c=c.match(/^(\d+)%?$/i))?Number(c[1])/100:null,e=null,g=b.include("left")||b.include("right")||b.include("width"),b=b.include("top")||b.include("bottom")||b.include("height"),d===document.viewport?g?e=document.viewport.getWidth():b&&(e=document.viewport.getHeight()):g?
e=$(d).measure("width"):b&&(e=$(d).measure("height")),null===e?0:e*c):0:(d=e.style.left,b=e.runtimeStyle.left,e.runtimeStyle.left=e.currentStyle.left,e.style.left=c||0,c=e.style.pixelLeft,e.style.left=d,e.runtimeStyle.left=b,c)}function d(a){a=$(a);if(a.nodeType===Node.DOCUMENT_NODE||h(a)||"BODY"===a.nodeName.toUpperCase()||"HTML"===a.nodeName.toUpperCase())return $(document.body);if("inline"!==Element.getStyle(a,"display")&&a.offsetParent)return $(a.offsetParent);for(;(a=a.parentNode)&&a!==document.body;)if("static"!==
Element.getStyle(a,"position"))return"HTML"===a.nodeName.toUpperCase()?$(document.body):$(a);return $(document.body)}function g(a){a=$(a);var c=0,b=0;if(a.parentNode){do c+=a.offsetTop||0,b+=a.offsetLeft||0,a=a.offsetParent;while(a)}return new Element.Offset(b,c)}function e(a){a=$(a);var c=a.getLayout(),b=0,d=0;do if(b+=a.offsetTop||0,d+=a.offsetLeft||0,a=a.offsetParent){if("BODY"===a.nodeName.toUpperCase())break;if("static"!==Element.getStyle(a,"position"))break}while(a);d-=c.get("margin-top");b-=
c.get("margin-left");return new Element.Offset(d,b)}function h(a){return a!==document.body&&!Element.descendantOf(a,document.body)}"currentStyle"in document.documentElement&&(a=b);var k=Prototype.K;"currentStyle"in document.documentElement&&(k=function(a){a.currentStyle.hasLayout||(a.style.zoom=1);return a});Element.Layout=Class.create(Hash,{initialize:function($super,a,c){$super();this.element=$(a);Element.Layout.PROPERTIES.each(function(a){this._set(a,null)},this);c&&(this._preComputing=!0,this._begin(),
Element.Layout.PROPERTIES.each(this._compute,this),this._end(),this._preComputing=!1)},_set:function(a,c){return Hash.prototype.set.call(this,a,c)},set:function(a,c){throw"Properties of Element.Layout are read-only.";},get:function($super,a){var c=$super(a);return null===c?this._compute(a):c},_begin:function(){if(!this._isPrepared()){var b=this.element,d;a:{for(d=b;d&&d.parentNode;){if("none"===d.getStyle("display")){d=!1;break a}d=$(d.parentNode)}d=!0}if(!d){b.store("prototype_original_styles",{position:b.style.position||
"",width:b.style.width||"",visibility:b.style.visibility||"",display:b.style.display||""});d=a(b,"position");var e=b.offsetWidth;if(0===e||null===e)b.style.display="block",e=b.offsetWidth;var g="fixed"===d?document.viewport:b.parentNode,f={visibility:"hidden",display:"block"};"fixed"!==d&&(f.position="absolute");b.setStyle(f);f=b.offsetWidth;d=e&&f===e?c(b,g):"absolute"===d||"fixed"===d?c(b,g):$(b.parentNode).getLayout().get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-
this.get("padding-right")-this.get("border-right")-this.get("margin-right");b.setStyle({width:d+"px"})}this._setPrepared(!0)}},_end:function(){var a=this.element,c=a.retrieve("prototype_original_styles");a.store("prototype_original_styles",null);a.setStyle(c);this._setPrepared(!1)},_compute:function(a){var c=Element.Layout.COMPUTATIONS;if(!(a in c))throw"Property not found.";return this._set(a,c[a].call(this,this.element))},_isPrepared:function(){return this.element.retrieve("prototype_element_layout_prepared",
!1)},_setPrepared:function(a){return this.element.store("prototype_element_layout_prepared",a)},toObject:function(){var a=$A(arguments),c={};(0===a.length?Element.Layout.PROPERTIES:a.join(" ").split(" ")).each(function(a){if(Element.Layout.PROPERTIES.include(a)){var b=this.get(a);null!=b&&(c[a]=b)}},this);return c},toHash:function(){var a=this.toObject.apply(this,arguments);return new Hash(a)},toCSS:function(){var a=$A(arguments),c={};(0===a.length?Element.Layout.PROPERTIES:a.join(" ").split(" ")).each(function(a){if(Element.Layout.PROPERTIES.include(a)&&
!Element.Layout.COMPOSITE_PROPERTIES.include(a)){var b=this.get(a);if(null!=b){var d=c;a.include("border")&&(a+="-width");a=a.camelize();d[a]=b+"px"}}},this);return c},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),
COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(a){this._preComputing||this._begin();a=this.get("border-box-height");if(0>=a)return this._preComputing||this._end(),0;var c=this.get("border-top"),b=this.get("border-bottom"),d=this.get("padding-top"),e=this.get("padding-bottom");this._preComputing||this._end();return a-c-b-d-e},width:function(a){this._preComputing||this._begin();a=this.get("border-box-width");
if(0>=a)return this._preComputing||this._end(),0;var c=this.get("border-left"),b=this.get("border-right"),d=this.get("padding-left"),e=this.get("padding-right");this._preComputing||this._end();return a-c-b-d-e},"padding-box-height":function(a){a=this.get("height");var c=this.get("padding-top"),b=this.get("padding-bottom");return a+c+b},"padding-box-width":function(a){a=this.get("width");var c=this.get("padding-left"),b=this.get("padding-right");return a+c+b},"border-box-height":function(a){this._preComputing||
this._begin();a=a.offsetHeight;this._preComputing||this._end();return a},"border-box-width":function(a){this._preComputing||this._begin();a=a.offsetWidth;this._preComputing||this._end();return a},"margin-box-height":function(a){a=this.get("border-box-height");var c=this.get("margin-top"),b=this.get("margin-bottom");return 0>=a?0:a+c+b},"margin-box-width":function(a){a=this.get("border-box-width");var c=this.get("margin-left"),b=this.get("margin-right");return 0>=a?0:a+c+b},top:function(a){return a.positionedOffset().top},
bottom:function(a){var c=a.positionedOffset();a=a.getOffsetParent().measure("height");var b=this.get("border-box-height");return a-b-c.top},left:function(a){return a.positionedOffset().left},right:function(a){var c=a.positionedOffset();a=a.getOffsetParent().measure("width");var b=this.get("border-box-width");return a-b-c.left},"padding-top":function(a){return f(a,"paddingTop")},"padding-bottom":function(a){return f(a,"paddingBottom")},"padding-left":function(a){return f(a,"paddingLeft")},"padding-right":function(a){return f(a,
"paddingRight")},"border-top":function(a){return f(a,"borderTopWidth")},"border-bottom":function(a){return f(a,"borderBottomWidth")},"border-left":function(a){return f(a,"borderLeftWidth")},"border-right":function(a){return f(a,"borderRightWidth")},"margin-top":function(a){return f(a,"marginTop")},"margin-bottom":function(a){return f(a,"marginBottom")},"margin-left":function(a){return f(a,"marginLeft")},"margin-right":function(a){return f(a,"marginRight")}}});"getBoundingClientRect"in document.documentElement&&
Object.extend(Element.Layout.COMPUTATIONS,{right:function(a){var c=k(a.getOffsetParent());a=a.getBoundingClientRect();return(c.getBoundingClientRect().right-a.right).round()},bottom:function(a){var c=k(a.getOffsetParent());a=a.getBoundingClientRect();return(c.getBoundingClientRect().bottom-a.bottom).round()}});Element.Offset=Class.create({initialize:function(a,c){this.left=a.round();this.top=c.round();this[0]=this.left;this[1]=this.top},relativeTo:function(a){return new Element.Offset(this.left-a.left,
this.top-a.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});Prototype.Browser.IE?(d=d.wrap(function(a,c){c=$(c);if(c.nodeType===Node.DOCUMENT_NODE||h(c)||"BODY"===c.nodeName.toUpperCase()||"HTML"===c.nodeName.toUpperCase())return $(document.body);var b=c.getStyle("position");if("static"!==b)return a(c);c.setStyle({position:"relative"});var d=
a(c);c.setStyle({position:b});return d}),e=e.wrap(function(a,c){c=$(c);if(!c.parentNode)return new Element.Offset(0,0);var b=c.getStyle("position");if("static"!==b)return a(c);var d=c.getOffsetParent();d&&"fixed"===d.getStyle("position")&&k(d);c.setStyle({position:"relative"});d=a(c);c.setStyle({position:b});return d})):Prototype.Browser.Webkit&&(g=function(a){a=$(a);var c=0,b=0;do{c+=a.offsetTop||0;b+=a.offsetLeft||0;if(a.offsetParent==document.body&&"absolute"==Element.getStyle(a,"position"))break;
a=a.offsetParent}while(a);return new Element.Offset(b,c)});Element.addMethods({getLayout:function(a,c){return new Element.Layout(a,c)},measure:function(a,c){return $(a).getLayout().get(c)},getWidth:function(a){return Element.getDimensions(a).width},getHeight:function(a){return Element.getDimensions(a).height},getDimensions:function(a){a=$(a);var c=Element.getStyle(a,"display");if(c&&"none"!==c)return{width:a.offsetWidth,height:a.offsetHeight};var c=a.style,c={visibility:c.visibility,position:c.position,
display:c.display},b={visibility:"hidden",display:"block"};"fixed"!==c.position&&(b.position="absolute");Element.setStyle(a,b);b={width:a.offsetWidth,height:a.offsetHeight};Element.setStyle(a,c);return b},getOffsetParent:d,cumulativeOffset:g,positionedOffset:e,cumulativeScrollOffset:function(a){var c=0,b=0;do c+=a.scrollTop||0,b+=a.scrollLeft||0,a=a.parentNode;while(a);return new Element.Offset(b,c)},viewportOffset:function(a){var c=0,b=0,d=document.body,e=$(a);do if(c+=e.offsetTop||0,b+=e.offsetLeft||
0,e.offsetParent==d&&"absolute"==Element.getStyle(e,"position"))break;while(e=e.offsetParent);e=a;do e!=d&&(c-=e.scrollTop||0,b-=e.scrollLeft||0);while(e=e.parentNode);return new Element.Offset(b,c)},absolutize:function(a){a=$(a);if("absolute"===Element.getStyle(a,"position"))return a;var c=d(a),b=a.viewportOffset(),c=c.viewportOffset(),b=b.relativeTo(c),c=a.getLayout();a.store("prototype_absolutize_original_styles",{left:a.getStyle("left"),top:a.getStyle("top"),width:a.getStyle("width"),height:a.getStyle("height")});
a.setStyle({position:"absolute",top:b.top+"px",left:b.left+"px",width:c.get("width")+"px",height:c.get("height")+"px"});return a},relativize:function(a){a=$(a);if("relative"===Element.getStyle(a,"position"))return a;var c=a.retrieve("prototype_absolutize_original_styles");c&&a.setStyle(c);return a},scrollTo:function(a){a=$(a);var c=Element.cumulativeOffset(a);window.scrollTo(c.left,c.top);return a},makePositioned:function(a){a=$(a);var c=Element.getStyle(a,"position"),b={};"static"!==c&&c||(b.position=
"relative",Prototype.Browser.Opera&&(b.top=0,b.left=0),Element.setStyle(a,b),Element.store(a,"prototype_made_positioned",!0));return a},undoPositioned:function(a){a=$(a);var c=Element.getStorage(a);c.get("prototype_made_positioned")&&(c.unset("prototype_made_positioned"),Element.setStyle(a,{position:"",top:"",bottom:"",left:"",right:""}));return a},makeClipping:function(a){a=$(a);var c=Element.getStorage(a),b=c.get("prototype_made_clipping");Object.isUndefined(b)&&(b=Element.getStyle(a,"overflow"),
c.set("prototype_made_clipping",b),"hidden"!==b&&(a.style.overflow="hidden"));return a},undoClipping:function(a){a=$(a);var c=Element.getStorage(a),b=c.get("prototype_made_clipping");Object.isUndefined(b)||(c.unset("prototype_made_clipping"),a.style.overflow=b||"");return a},clonePosition:function(a,c,b){b=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},b||{});c=$(c);a=$(a);var d,e,g,f={};if(b.setLeft||b.setTop)if(d=Element.viewportOffset(c),e=[0,0],"absolute"===
Element.getStyle(a,"position")){var h=Element.getOffsetParent(a);h!==document.body&&(e=Element.viewportOffset(h))}if(b.setWidth||b.setHeight)g=Element.getLayout(c);b.setLeft&&(f.left=d[0]-e[0]+b.offsetLeft+"px");b.setTop&&(f.top=d[1]-e[1]+b.offsetTop+"px");b.setWidth&&(f.width=g.get("border-box-width")+"px");b.setHeight&&(f.height=g.get("border-box-height")+"px");return Element.setStyle(a,f)}});"getBoundingClientRect"in document.documentElement&&Element.addMethods({viewportOffset:function(a){a=$(a);
if(h(a))return new Element.Offset(0,0);a=a.getBoundingClientRect();var c=document.documentElement;return new Element.Offset(a.left-c.clientLeft,a.top-c.clientTop)}})})();
(function(){function a(){return c?c:c=b?document.body:document.documentElement}var b=Prototype.Browser.Opera&&9.5>window.parseFloat(window.opera.version()),c=null;document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return a().clientWidth},getHeight:function(){return a().clientHeight},getScrollOffsets:function(){return new Element.Offset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||
document.documentElement.scrollTop||document.body.scrollTop)}}})();window.$$=function(){var a=$A(arguments).join(", ");return Prototype.Selector.select(a,document)};
Prototype.Selector=function(){function a(a){for(var b=0,d=a.length;b<d;b++)Element.extend(a[b]);return a}var b=Prototype.K;return{select:function(){throw Error('Method "Prototype.Selector.select" must be defined.');},match:function(){throw Error('Method "Prototype.Selector.match" must be defined.');},find:function(a,b,d){d=d||0;var g=Prototype.Selector.match,e=a.length,h=0,k;for(k=0;k<e;k++)if(g(a[k],b)&&d==h++)return Element.extend(a[k])},extendElements:Element.extend===b?b:a,extendElement:Element.extend}}();
(function(){function a(a,c,b,d,e,g){e=0;for(var f=d.length;e<f;e++){var h=d[e];if(h){for(var n=!1,h=h[a];h;){if(h.sizcache===b){n=d[h.sizset];break}1!==h.nodeType||g||(h.sizcache=b,h.sizset=e);if(h.nodeName.toLowerCase()===c){n=h;break}h=h[a]}d[e]=n}}}function b(a,c,b,d,e,g){e=0;for(var f=d.length;e<f;e++){var h=d[e];if(h){for(var n=!1,h=h[a];h;){if(h.sizcache===b){n=d[h.sizset];break}if(1===h.nodeType)if(g||(h.sizcache=b,h.sizset=e),"string"!==typeof c){if(h===c){n=!0;break}}else if(0<l.filter(c,
[h]).length){n=h;break}h=h[a]}d[e]=n}}}var c=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,f=0,d=Object.prototype.toString,g=!1,e=!0,h=/\\/g,k=/\W/;[0,0].sort(function(){e=!1;return 0});var l=function(a,b,e,g){e=e||[];var f=b=b||document;if(1!==b.nodeType&&9!==b.nodeType)return[];if(!a||"string"!==typeof a)return e;var h,k,p,q,y,x=!0,w=l.isXML(b),E=[],P=a;do if(c.exec(""),h=c.exec(P))if(P=h[3],E.push(h[1]),h[2]){q=
h[3];break}while(h);if(1<E.length&&n.exec(a))if(2===E.length&&m.relative[E[0]])k=A(E[0]+E[1],b);else for(k=m.relative[E[0]]?[b]:l(E.shift(),b);E.length;)a=E.shift(),m.relative[a]&&(a+=E.shift()),k=A(a,k);else if(!g&&(1<E.length&&9===b.nodeType&&!w&&m.match.ID.test(E[0])&&!m.match.ID.test(E[E.length-1]))&&(h=l.find(E.shift(),b,w),b=h.expr?l.filter(h.expr,h.set)[0]:h.set[0]),b)for(h=g?{expr:E.pop(),set:u(g)}:l.find(E.pop(),1!==E.length||"~"!==E[0]&&"+"!==E[0]||!b.parentNode?b:b.parentNode,w),k=h.expr?
l.filter(h.expr,h.set):h.set,0<E.length?p=u(k):x=!1;E.length;)h=y=E.pop(),m.relative[y]?h=E.pop():y="",null==h&&(h=b),m.relative[y](p,h,w);else p=[];p||(p=k);p||l.error(y||a);if("[object Array]"===d.call(p))if(x)if(b&&1===b.nodeType)for(a=0;null!=p[a];a++)p[a]&&(!0===p[a]||1===p[a].nodeType&&l.contains(b,p[a]))&&e.push(k[a]);else for(a=0;null!=p[a];a++)p[a]&&1===p[a].nodeType&&e.push(k[a]);else e.push.apply(e,p);else u(p,e);q&&(l(q,f,e,g),l.uniqueSort(e));return e};l.uniqueSort=function(a){if(x&&
(g=e,a.sort(x),g))for(var c=1;c<a.length;c++)a[c]===a[c-1]&&a.splice(c--,1);return a};l.matches=function(a,c){return l(a,null,null,c)};l.matchesSelector=function(a,c){return 0<l(c,null,null,[a]).length};l.find=function(a,c,b){var d;if(!a)return[];for(var e=0,g=m.order.length;e<g;e++){var f,n=m.order[e];if(f=m.leftMatch[n].exec(a)){var k=f[1];f.splice(1,1);if("\\"!==k.substr(k.length-1)&&(f[1]=(f[1]||"").replace(h,""),d=m.find[n](f,c,b),null!=d)){a=a.replace(m.match[n],"");break}}}d||(d="undefined"!==
typeof c.getElementsByTagName?c.getElementsByTagName("*"):[]);return{set:d,expr:a}};l.filter=function(a,c,b,d){for(var e,g,f=a,h=[],n=c,k=c&&c[0]&&l.isXML(c[0]);a&&c.length;){for(var p in m.filter)if(null!=(e=m.leftMatch[p].exec(a))&&e[2]){var q,u,y=m.filter[p];u=e[1];g=!1;e.splice(1,1);if("\\"!==u.substr(u.length-1)){n===h&&(h=[]);if(m.preFilter[p])if(e=m.preFilter[p](e,n,b,h,d,k),!e)g=q=!0;else if(!0===e)continue;if(e)for(var A=0;null!=(u=n[A]);A++)if(u){q=y(u,e,A,n);var x=d^!!q;b&&null!=q?x?g=
!0:n[A]=!1:x&&(h.push(u),g=!0)}if(void 0!==q){b||(n=h);a=a.replace(m.match[p],"");if(!g)return[];break}}}if(a===f)if(null==g)l.error(a);else break;f=a}return n};l.error=function(a){throw"Syntax error, unrecognized expression: "+a;};var m=l.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,
TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,c){var b=
"string"===typeof c,d=b&&!k.test(c),b=b&&!d;d&&(c=c.toLowerCase());for(var d=0,e=a.length,g;d<e;d++)if(g=a[d]){for(;(g=g.previousSibling)&&1!==g.nodeType;);a[d]=b||g&&g.nodeName.toLowerCase()===c?g||!1:g===c}b&&l.filter(c,a,!0)},">":function(a,c){var b,d="string"===typeof c,e=0,g=a.length;if(d&&!k.test(c))for(c=c.toLowerCase();e<g;e++){if(b=a[e])b=b.parentNode,a[e]=b.nodeName.toLowerCase()===c?b:!1}else{for(;e<g;e++)(b=a[e])&&(a[e]=d?b.parentNode:b.parentNode===c);d&&l.filter(c,a,!0)}},"":function(c,
d,e){var g,h=f++,n=b;"string"!==typeof d||k.test(d)||(g=d=d.toLowerCase(),n=a);n("parentNode",d,h,c,g,e)},"~":function(c,d,e){var g,h=f++,n=b;"string"!==typeof d||k.test(d)||(g=d=d.toLowerCase(),n=a);n("previousSibling",d,h,c,g,e)}},find:{ID:function(a,c,b){if("undefined"!==typeof c.getElementById&&!b)return(a=c.getElementById(a[1]))&&a.parentNode?[a]:[]},NAME:function(a,c){if("undefined"!==typeof c.getElementsByName){for(var b=[],d=c.getElementsByName(a[1]),e=0,g=d.length;e<g;e++)d[e].getAttribute("name")===
a[1]&&b.push(d[e]);return 0===b.length?null:b}},TAG:function(a,c){if("undefined"!==typeof c.getElementsByTagName)return c.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,c,b,d,e,g){a=" "+a[1].replace(h,"")+" ";if(g)return a;g=0;for(var f;null!=(f=c[g]);g++)f&&(e^(f.className&&0<=(" "+f.className+" ").replace(/[\t\n\r]/g," ").indexOf(a))?b||d.push(f):b&&(c[g]=!1));return!1},ID:function(a){return a[1].replace(h,"")},TAG:function(a,c){return a[1].replace(h,"").toLowerCase()},CHILD:function(a){if("nth"===
a[1]){a[2]||l.error(a[0]);a[2]=a[2].replace(/^\+|\s*/g,"");var c=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec("even"===a[2]&&"2n"||"odd"===a[2]&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=c[1]+(c[2]||1)-0;a[3]=c[3]-0}else a[2]&&l.error(a[0]);a[0]=f++;return a},ATTR:function(a,c,b,d,e,g){c=a[1]=a[1].replace(h,"");!g&&m.attrMap[c]&&(a[1]=m.attrMap[c]);a[4]=(a[4]||a[5]||"").replace(h,"");"~="===a[2]&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(a,b,d,e,g){if("not"===a[1])if(1<(c.exec(a[3])||"").length||
/^\w/.test(a[3]))a[3]=l(a[3],null,null,b);else return a=l.filter(a[3],b,d,1^g),d||e.push.apply(e,a),!1;else if(m.match.POS.test(a[0])||m.match.CHILD.test(a[0]))return!0;return a},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return!1===a.disabled&&"hidden"!==a.type},disabled:function(a){return!0===a.disabled},checked:function(a){return!0===a.checked},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return!0===a.selected},parent:function(a){return!!a.firstChild},
empty:function(a){return!a.firstChild},has:function(a,c,b){return!!l(b[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var c=a.getAttribute("type"),b=a.type;return"input"===a.nodeName.toLowerCase()&&"text"===b&&(c===b||null===c)},radio:function(a){return"input"===a.nodeName.toLowerCase()&&"radio"===a.type},checkbox:function(a){return"input"===a.nodeName.toLowerCase()&&"checkbox"===a.type},file:function(a){return"input"===a.nodeName.toLowerCase()&&"file"===a.type},
password:function(a){return"input"===a.nodeName.toLowerCase()&&"password"===a.type},submit:function(a){var c=a.nodeName.toLowerCase();return("input"===c||"button"===c)&&"submit"===a.type},image:function(a){return"input"===a.nodeName.toLowerCase()&&"image"===a.type},reset:function(a){var c=a.nodeName.toLowerCase();return("input"===c||"button"===c)&&"reset"===a.type},button:function(a){var c=a.nodeName.toLowerCase();return"input"===c&&"button"===a.type||"button"===c},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},
focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,c){return 0===c},last:function(a,c,b,d){return c===d.length-1},even:function(a,c){return 0===c%2},odd:function(a,c){return 1===c%2},lt:function(a,c,b){return c<b[3]-0},gt:function(a,c,b){return c>b[3]-0},nth:function(a,c,b){return b[3]-0===c},eq:function(a,c,b){return b[3]-0===c}},filter:{PSEUDO:function(a,c,b,d){var e=c[1],g=m.filters[e];if(g)return g(a,b,c,d);if("contains"===e)return 0<=(a.textContent||a.innerText||
l.getText([a])||"").indexOf(c[3]);if("not"===e){c=c[3];b=0;for(d=c.length;b<d;b++)if(c[b]===a)return!1;return!0}l.error(e)},CHILD:function(a,c){var b=c[1],d=a;switch(b){case "only":case "first":for(;d=d.previousSibling;)if(1===d.nodeType)return!1;if("first"===b)return!0;d=a;case "last":for(;d=d.nextSibling;)if(1===d.nodeType)return!1;return!0;case "nth":var b=c[2],e=c[3];if(1===b&&0===e)return!0;var g=c[0],f=a.parentNode;if(f&&(f.sizcache!==g||!a.nodeIndex)){for(var h=0,d=f.firstChild;d;d=d.nextSibling)1===
d.nodeType&&(d.nodeIndex=++h);f.sizcache=g}d=a.nodeIndex-e;return 0===b?0===d:0===d%b&&0<=d/b}},ID:function(a,c){return 1===a.nodeType&&a.getAttribute("id")===c},TAG:function(a,c){return"*"===c&&1===a.nodeType||a.nodeName.toLowerCase()===c},CLASS:function(a,c){return-1<(" "+(a.className||a.getAttribute("class"))+" ").indexOf(c)},ATTR:function(a,c){var b=c[1],b=m.attrHandle[b]?m.attrHandle[b](a):null!=a[b]?a[b]:a.getAttribute(b),d=b+"",e=c[2],g=c[4];return null==b?"!="===e:"="===e?d===g:"*="===e?0<=
d.indexOf(g):"~="===e?0<=(" "+d+" ").indexOf(g):g?"!="===e?d!==g:"^="===e?0===d.indexOf(g):"$="===e?d.substr(d.length-g.length)===g:"|="===e?d===g||d.substr(0,g.length+1)===g+"-":!1:d&&!1!==b},POS:function(a,c,b,d){var e=m.setFilters[c[2]];if(e)return e(a,b,c,d)}}},n=m.match.POS,p=function(a,c){return"\\"+(c-0+1)},q;for(q in m.match)m.match[q]=RegExp(m.match[q].source+/(?![^\[]*\])(?![^\(]*\))/.source),m.leftMatch[q]=RegExp(/(^(?:.|\r|\n)*?)/.source+m.match[q].source.replace(/\\(\d+)/g,p));var u=
function(a,c){a=Array.prototype.slice.call(a,0);return c?(c.push.apply(c,a),c):a};try{Array.prototype.slice.call(document.documentElement.childNodes,0)[0].nodeType}catch(y){u=function(a,c){var b=0,e=c||[];if("[object Array]"===d.call(a))Array.prototype.push.apply(e,a);else if("number"===typeof a.length)for(var g=a.length;b<g;b++)e.push(a[b]);else for(;a[b];b++)e.push(a[b]);return e}}var x,w;document.documentElement.compareDocumentPosition?x=function(a,c){return a===c?(g=!0,0):a.compareDocumentPosition&&
c.compareDocumentPosition?a.compareDocumentPosition(c)&4?-1:1:a.compareDocumentPosition?-1:1}:(x=function(a,c){if(a===c)return g=!0,0;if(a.sourceIndex&&c.sourceIndex)return a.sourceIndex-c.sourceIndex;var b,d,e=[],f=[];b=a.parentNode;d=c.parentNode;var h=b;if(b===d)return w(a,c);if(!b)return-1;if(!d)return 1;for(;h;)e.unshift(h),h=h.parentNode;for(h=d;h;)f.unshift(h),h=h.parentNode;b=e.length;d=f.length;for(h=0;h<b&&h<d;h++)if(e[h]!==f[h])return w(e[h],f[h]);return h===b?w(a,f[h],-1):w(e[h],c,1)},
w=function(a,c,b){if(a===c)return b;for(a=a.nextSibling;a;){if(a===c)return-1;a=a.nextSibling}return 1});l.getText=function(a){for(var c="",b,d=0;a[d];d++)b=a[d],3===b.nodeType||4===b.nodeType?c+=b.nodeValue:8!==b.nodeType&&(c+=l.getText(b.childNodes));return c};(function(){var a=document.createElement("div"),c="script"+(new Date).getTime(),b=document.documentElement;a.innerHTML="<a name='"+c+"'/>";b.insertBefore(a,b.firstChild);document.getElementById(c)&&(m.find.ID=function(a,c,b){if("undefined"!==
typeof c.getElementById&&!b)return(c=c.getElementById(a[1]))?c.id===a[1]||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").nodeValue===a[1]?[c]:void 0:[]},m.filter.ID=function(a,c){var b="undefined"!==typeof a.getAttributeNode&&a.getAttributeNode("id");return 1===a.nodeType&&b&&b.nodeValue===c});b.removeChild(a);b=a=null})();(function(){var a=document.createElement("div");a.appendChild(document.createComment(""));0<a.getElementsByTagName("*").length&&(m.find.TAG=function(a,c){var b=
c.getElementsByTagName(a[1]);if("*"===a[1]){for(var d=[],e=0;b[e];e++)1===b[e].nodeType&&d.push(b[e]);b=d}return b});a.innerHTML="<a href='#'></a>";a.firstChild&&("undefined"!==typeof a.firstChild.getAttribute&&"#"!==a.firstChild.getAttribute("href"))&&(m.attrHandle.href=function(a){return a.getAttribute("href",2)});a=null})();document.querySelectorAll&&function(){var a=l,c=document.createElement("div");c.innerHTML="<p class='TEST'></p>";if(!c.querySelectorAll||0!==c.querySelectorAll(".TEST").length){l=
function(c,b,d,e){b=b||document;if(!e&&!l.isXML(b)){var g=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(c);if(g&&(1===b.nodeType||9===b.nodeType)){if(g[1])return u(b.getElementsByTagName(c),d);if(g[2]&&m.find.CLASS&&b.getElementsByClassName)return u(b.getElementsByClassName(g[2]),d)}if(9===b.nodeType){if("body"===c&&b.body)return u([b.body],d);if(g&&g[3]){var f=b.getElementById(g[3]);if(f&&f.parentNode){if(f.id===g[3])return u([f],d)}else return u([],d)}try{return u(b.querySelectorAll(c),d)}catch(h){}}else if(1===
b.nodeType&&"object"!==b.nodeName.toLowerCase()){var g=b,n=(f=b.getAttribute("id"))||"__sizzle__",k=b.parentNode,p=/^\s*[+~]/.test(c);f?n=n.replace(/'/g,"\\$&"):b.setAttribute("id",n);p&&k&&(b=b.parentNode);try{if(!p||k)return u(b.querySelectorAll("[id='"+n+"'] "+c),d)}catch(q){}finally{f||g.removeAttribute("id")}}}return a(c,b,d,e)};for(var b in a)l[b]=a[b];c=null}}();(function(){var a=document.documentElement,c=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;
if(c){var b=!c.call(document.createElement("div"),"div"),d=!1;try{c.call(document.documentElement,"[test!='']:sizzle")}catch(e){d=!0}l.matchesSelector=function(a,e){e=e.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!l.isXML(a))try{if(d||!m.match.PSEUDO.test(e)&&!/!=/.test(e)){var g=c.call(a,e);if(g||!b||a.document&&11!==a.document.nodeType)return g}}catch(f){}return 0<l(e,null,null,[a]).length}}})();(function(){var a=document.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";
a.getElementsByClassName&&0!==a.getElementsByClassName("e").length&&(a.lastChild.className="e",1!==a.getElementsByClassName("e").length&&(m.order.splice(1,0,"CLASS"),m.find.CLASS=function(a,c,b){if("undefined"!==typeof c.getElementsByClassName&&!b)return c.getElementsByClassName(a[1])},a=null))})();l.contains=document.documentElement.contains?function(a,c){return a!==c&&(a.contains?a.contains(c):!0)}:document.documentElement.compareDocumentPosition?function(a,c){return!!(a.compareDocumentPosition(c)&
16)}:function(){return!1};l.isXML=function(a){return(a=(a?a.ownerDocument||a:0).documentElement)?"HTML"!==a.nodeName:!1};var A=function(a,c){for(var b,d=[],e="",g=c.nodeType?[c]:c;b=m.match.PSEUDO.exec(a);)e+=b[0],a=a.replace(m.match.PSEUDO,"");a=m.relative[a]?a+"*":a;b=0;for(var f=g.length;b<f;b++)l(a,g[b],d);return l.filter(e,d)};window.Sizzle=l})();Prototype._original_property=window.Sizzle;
(function(a){var b=Prototype.Selector.extendElements;Prototype.Selector.engine=a;Prototype.Selector.select=function(c,f){return b(a(c,f||document))};Prototype.Selector.match=function(c,b){return 1==a.matches(b,[c]).length}})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;
var Form={reset:function(a){a=$(a);a.reset();return a},serializeElements:function(a,b){"object"!=typeof b?b={hash:!!b}:Object.isUndefined(b.hash)&&(b.hash=!0);var c,f,d=!1,g=b.submit,e,h;b.hash?(h={},e=function(a,c,b){c in a?(Object.isArray(a[c])||(a[c]=[a[c]]),a[c].push(b)):a[c]=b;return a}):(h="",e=function(a,c,b){b=b.gsub(/(\r)?\n/,"\r\n");b=encodeURIComponent(b);b=b.gsub(/%20/,"+");return a+(a?"&":"")+encodeURIComponent(c)+"="+b});return a.inject(h,function(a,b){!b.disabled&&b.name&&(c=b.name,
f=$(b).getValue(),null==f||("file"==b.type||"submit"==b.type&&(d||!1===g||g&&c!=g||!(d=!0)))||(a=e(a,c,f)));return a})},Methods:{serialize:function(a,b){return Form.serializeElements(Form.getElements(a),b)},getElements:function(a){a=$(a).getElementsByTagName("*");for(var b,c=[],f=Form.Element.Serializers,d=0;b=a[d];d++)f[b.tagName.toLowerCase()]&&c.push(Element.extend(b));return c},getInputs:function(a,b,c){a=$(a);a=a.getElementsByTagName("input");if(!b&&!c)return $A(a).map(Element.extend);for(var f=
0,d=[],g=a.length;f<g;f++){var e=a[f];b&&e.type!=b||c&&e.name!=c||d.push(Element.extend(e))}return d},disable:function(a){a=$(a);Form.getElements(a).invoke("disable");return a},enable:function(a){a=$(a);Form.getElements(a).invoke("enable");return a},findFirstElement:function(a){a=$(a).getElements().findAll(function(a){return"hidden"!=a.type&&!a.disabled});var b=a.findAll(function(a){return a.hasAttribute("tabIndex")&&0<=a.tabIndex}).sortBy(function(a){return a.tabIndex}).first();return b?b:a.find(function(a){return/^(?:input|select|textarea)$/i.test(a.tagName)})},
focusFirstElement:function(a){a=$(a);var b=a.findFirstElement();b&&b.activate();return a},request:function(a,b){a=$(a);b=Object.clone(b||{});var c=b.parameters,f=a.readAttribute("action")||"";f.blank()&&(f=window.location.href);b.parameters=a.serialize(!0);c&&(Object.isString(c)&&(c=c.toQueryParams()),Object.extend(b.parameters,c));a.hasAttribute("method")&&!b.method&&(b.method=a.method);return new Ajax.Request(f,b)}},Element:{focus:function(a){$(a).focus();return a},select:function(a){$(a).select();
return a}}};
Form.Element.Methods={serialize:function(a){a=$(a);if(!a.disabled&&a.name){var b=a.getValue();if(void 0!=b){var c={};c[a.name]=b;return Object.toQueryString(c)}}return""},getValue:function(a){a=$(a);var b=a.tagName.toLowerCase();return Form.Element.Serializers[b](a)},setValue:function(a,b){a=$(a);var c=a.tagName.toLowerCase();Form.Element.Serializers[c](a,b);return a},clear:function(a){$(a).value="";return a},present:function(a){return""!=$(a).value},activate:function(a){a=$(a);try{a.focus(),!a.select||
"input"==a.tagName.toLowerCase()&&/^(?:button|reset|submit)$/i.test(a.type)||a.select()}catch(b){}return a},disable:function(a){a=$(a);a.disabled=!0;return a},enable:function(a){a=$(a);a.disabled=!1;return a}};var Field=Form.Element,$F=Form.Element.Methods.getValue;
Form.Element.Serializers=function(){function a(a,c){if(Object.isUndefined(c))return a.checked?a.value:null;a.checked=!!c}function b(a,c){if(Object.isUndefined(c))return a.value;a.value=c}function c(a){var c=a.selectedIndex;return 0<=c?d(a.options[c]):null}function f(a){var c,b=a.length;if(!b)return null;var f=0;for(c=[];f<b;f++){var l=a.options[f];l.selected&&c.push(d(l))}return c}function d(a){return Element.hasAttribute(a,"value")?a.value:a.text}return{input:function(c,d){switch(c.type.toLowerCase()){case "checkbox":case "radio":return a(c,
d);default:return b(c,d)}},inputSelector:a,textarea:b,select:function(a,b){if(Object.isUndefined(b))return("select-one"===a.type?c:f)(a);for(var d,k,l=!Object.isArray(b),m=0,n=a.length;m<n;m++)if(d=a.options[m],k=this.optionValue(d),l){if(k==b){d.selected=!0;break}}else d.selected=b.include(k)},selectOne:c,selectMany:f,optionValue:d,button:b}}();
Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,b,c,f){$super(f,c);this.element=$(b);this.lastValue=this.getValue()},execute:function(){var a=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(a)?this.lastValue!=a:String(this.lastValue)!=String(a))this.callback(this.element,a),this.lastValue=a}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});
Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});
Abstract.EventObserver=Class.create({initialize:function(a,b){this.element=$(a);this.callback=b;this.lastValue=this.getValue();"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var a=this.getValue();this.lastValue!=a&&(this.callback(this.element,a),this.lastValue=a)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(a){if(a.type)switch(a.type.toLowerCase()){case "checkbox":case "radio":Event.observe(a,
"click",this.onElementEvent.bind(this));break;default:Event.observe(a,"change",this.onElementEvent.bind(this))}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});
(function(a){function b(a,c){return a.which?a.which===c+1:a.button===c}function c(a,c){return a.button===F[c]}function f(a,c){switch(c){case 0:return 1==a.which&&!a.metaKey;case 1:return 2==a.which||1==a.which&&a.metaKey;case 2:return 3==a.which;default:return!1}}function d(a){a=s.extend(a);var c=a.target,b=a.type;(a=a.currentTarget)&&a.tagName&&("load"===b||"error"===b||"click"===b&&"input"===a.tagName.toLowerCase()&&"radio"===a.type)&&(c=a);c.nodeType==Node.TEXT_NODE&&(c=c.parentNode);return Element.extend(c)}
function g(a){var c=document.documentElement,b=document.body||{scrollLeft:0};return a.pageX||a.clientX+(c.scrollLeft||b.scrollLeft)-(c.clientLeft||0)}function e(a){var c=document.documentElement,b=document.body||{scrollTop:0};return a.pageY||a.clientY+(c.scrollTop||b.scrollTop)-(c.clientTop||0)}function h(a){return v[a]||a}function k(a){if(a===window)return 0;"undefined"===typeof a._prototypeUID&&(a._prototypeUID=Element.Storage.UID++);return a._prototypeUID}function l(a){return a===window?0:a==document?
1:a.uniqueID}function m(a){return a.include(":")}function n(c,b){var d=a.Event.cache;Object.isUndefined(b)&&(b=k(c));d[b]||(d[b]={element:c});return d[b]}function p(c,b,d){c=$(c);a:{var e=c,g=n(e);g[b]||(g[b]=[]);for(var g=g[b],f=g.length;f--;)if(g[f].handler===d){d=null;break a}e=k(e);d={responder:a.Event._createResponder(e,b,d),handler:d};g.push(d)}if(null===d)return c;d=d.responder;m(b)?(b=c,b.addEventListener?b.addEventListener("dataavailable",d,!1):(b.attachEvent("ondataavailable",d),b.attachEvent("onlosecapture",
d))):(g=c,b=h(b),g.addEventListener?g.addEventListener(b,d,!1):g.attachEvent("on"+b,d));return c}function q(c,b,d){c=$(c);var e=!Object.isUndefined(d);if(Object.isUndefined(b)&&!e){b=c;d=k(b);var g=n(b,d);Object.isUndefined(d)&&(d=k(b));delete a.Event.cache[d];for(var f in g)if("element"!==f)for(d=g[f],e=d.length;e--;)u(b,f,d[e].responder);return c}if(!e){f=c;d=n(f);if(g=d[b])for(delete d[b],d=g.length;d--;)u(f,b,g[d].responder);return c}if(f=n(c)[b]){for(e=f.length;e--;)if(f[e].handler===d){g=f[e];
break}g?(d=f.indexOf(g),f.splice(d,1),f=g):f=void 0}else f=void 0;if(!f)return c;u(c,b,f.responder);return c}function u(a,c,b){m(c)?a.removeEventListener?a.removeEventListener("dataavailable",b,!1):(a.detachEvent("ondataavailable",b),a.detachEvent("onlosecapture",b)):(c=h(c),a.removeEventListener?a.removeEventListener(c,b,!1):a.detachEvent("on"+c,b))}function y(a,c,b,d){a=$(a);a=a!==document?a:document.createEvent&&!a.dispatchEvent?document.documentElement:a;Object.isUndefined(d)&&(d=!0);b=b||{};
c=G(a,c,b,d);return s.extend(c)}function x(a,c,b,d){var e=document.createEvent("HTMLEvents");e.initEvent("dataavailable",d,!0);e.eventName=c;e.memo=b;a.dispatchEvent(e);return e}function w(a,c,b,d){var e=document.createEventObject();e.eventType=d?"ondataavailable":"onlosecapture";e.eventName=c;e.memo=b;a.fireEvent(e.eventType,e);return e}function A(a,c,b,d){a=$(a);Object.isFunction(b)&&Object.isUndefined(d)&&(d=b,b=null);return(new s.Handler(a,c,b,d)).start()}function t(){a.Event.cache=null}var z=
document.createElement("div"),r=document.documentElement,r="onmouseenter"in r&&"onmouseleave"in r,s={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45},B=function(a){return!1};window.attachEvent&&(B=window.addEventListener?function(a){return!(a instanceof window.Event)}:function(a){return!0});var C,F={0:1,1:4,2:2};C=window.attachEvent?window.addEventListener?function(a,
d){return B(a)?c(a,d):b(a,d)}:c:Prototype.Browser.WebKit?f:b;s.Methods={isLeftClick:function(a){return C(a,0)},isMiddleClick:function(a){return C(a,1)},isRightClick:function(a){return C(a,2)},element:function(a){return Element.extend(d(a))},findElement:function(a,c){var b=d(a),e=Prototype.Selector.match;if(!c)return Element.extend(b);for(;b;){if(Object.isElement(b)&&e(b,c))return Element.extend(b);b=b.parentNode}},pointer:function(a){return{x:g(a),y:e(a)}},pointerX:g,pointerY:e,stop:function(a){s.extend(a);
a.preventDefault();a.stopPropagation();a.stopped=!0}};var I=Object.keys(s.Methods).inject({},function(a,c){a[c]=s.Methods[c].methodize();return a});if(window.attachEvent){var H=function(a){switch(a.type){case "mouseover":case "mouseenter":a=a.fromElement;break;case "mouseout":case "mouseleave":a=a.toElement;break;default:return null}return Element.extend(a)},D={stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}};
s.extend=function(a,c){if(!a)return!1;if(!B(a)||a._extendedByPrototype)return a;a._extendedByPrototype=Prototype.emptyFunction;var b=s.pointer(a);Object.extend(a,{target:a.srcElement||c,relatedTarget:H(a),pageX:b.x,pageY:b.y});Object.extend(a,I);Object.extend(a,D);return a}}else s.extend=Prototype.K;window.addEventListener&&(s.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(s.prototype,I));var v={mouseenter:"mouseover",mouseleave:"mouseout"};r&&(h=Prototype.K);
"uniqueID"in z&&(k=l);s._isCustomEvent=m;var G=document.createEvent?x:w;s.Handler=Class.create({initialize:function(a,c,b,d){this.element=$(a);this.eventName=c;this.selector=b;this.callback=d;this.handler=this.handleEvent.bind(this)},start:function(){s.observe(this.element,this.eventName,this.handler);return this},stop:function(){s.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(a){var c=s.findElement(a,this.selector);c&&this.callback.call(this.element,a,
c)}});Object.extend(s,s.Methods);Object.extend(s,{fire:y,observe:p,stopObserving:q,on:A});Element.addMethods({fire:y,observe:p,stopObserving:q,on:A});Object.extend(document,{fire:y.methodize(),observe:p.methodize(),stopObserving:q.methodize(),on:A.methodize(),loaded:!1});a.Event?Object.extend(window.Event,s):a.Event=s;a.Event.cache={};window.attachEvent&&window.attachEvent("onunload",t);r=z=null})(this);
(function(a){function b(a,c,b){return function(d){var f=Event.cache[a].element;if(Object.isUndefined(d.eventName)||d.eventName!==c)return!1;Event.extend(d,f);b.call(f,d)}}function c(a,c,b){return function(c){var d=Event.cache[a].element;Event.extend(c,d);for(var e=c.relatedTarget;e&&e!==d;)try{e=e.parentNode}catch(f){e=d}e!==d&&b.call(d,c)}}var f=document.documentElement,d="onmouseenter"in f&&"onmouseleave"in f;a.Event._createResponder=function(a,e,f){return Event._isCustomEvent(e)?b(a,e,f):d||"mouseenter"!==
e&&"mouseleave"!==e?function(c){var b=Event.cache[a].element;Event.extend(c,b);f.call(b,c)}:c(a,e,f)};f=null})(this);
(function(a){function b(){document.loaded||(d&&window.clearTimeout(d),document.loaded=!0,document.fire("dom:loaded"))}function c(){"complete"===document.readyState&&(document.detachEvent("onreadystatechange",c),b())}function f(){try{document.documentElement.doScroll("left")}catch(a){d=f.defer();return}b()}var d;document.addEventListener?document.addEventListener("DOMContentLoaded",b,!1):(document.attachEvent("onreadystatechange",c),window==top&&(d=f.defer()));Event.observe(window,"load",b)})(this);
Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;
var Insertion={Before:function(a,b){return Element.insert(a,{before:b})},Top:function(a,b){return Element.insert(a,{top:b})},Bottom:function(a,b){return Element.insert(a,{bottom:b})},After:function(a,b){return Element.insert(a,{after:b})}},$continue=Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||
document.body.scrollTop||0},within:function(a,b,c){if(this.includeScrollOffsets)return this.withinIncludingScrolloffsets(a,b,c);this.xcomp=b;this.ycomp=c;this.offset=Element.cumulativeOffset(a);return c>=this.offset[1]&&c<this.offset[1]+a.offsetHeight&&b>=this.offset[0]&&b<this.offset[0]+a.offsetWidth},withinIncludingScrolloffsets:function(a,b,c){var f=Element.cumulativeScrollOffset(a);this.xcomp=b+f[0]-this.deltaX;this.ycomp=c+f[1]-this.deltaY;this.offset=Element.cumulativeOffset(a);return this.ycomp>=
this.offset[1]&&this.ycomp<this.offset[1]+a.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+a.offsetWidth},overlap:function(a,b){if(!a)return 0;if("vertical"==a)return(this.offset[1]+b.offsetHeight-this.ycomp)/b.offsetHeight;if("horizontal"==a)return(this.offset[0]+b.offsetWidth-this.xcomp)/b.offsetWidth},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(a){Position.prepare();return Element.absolutize(a)},relativize:function(a){Position.prepare();
return Element.relativize(a)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(a,b,c){c=c||{};return Element.clonePosition(b,a,c)}};
document.getElementsByClassName||(document.getElementsByClassName=function(a){function b(a){return a.blank()?null:"[contains(concat(' ', @class, ' '), ' "+a+" ')]"}a.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(a,f){f=f.toString().strip();var d=/\s/.test(f)?$w(f).map(b).join(""):b(f);return d?document._getElementsByXPath(".//*"+d,a):[]}:function(a,b){b=b.toString().strip();var d=[],g=/\s/.test(b)?$w(b):null;if(!g&&!b)return d;var e=$(a).getElementsByTagName("*");b=" "+b+" ";for(var h=
0,k,l;k=e[h];h++)k.className&&((l=" "+k.className+" ")&&(l.include(b)||g&&g.all(function(a){return!a.toString().blank()&&l.include(" "+a+" ")})))&&d.push(Element.extend(k));return d};return function(a,b){return $(b||document.body).getElementsByClassName(a)}}(Element.Methods));Element.ClassNames=Class.create();
Element.ClassNames.prototype={initialize:function(a){this.element=$(a)},_each:function(a,b){this.element.className.split(/\s+/).select(function(a){return 0<a.length})._each(a,b)},set:function(a){this.element.className=a},add:function(a){this.include(a)||this.set($A(this).concat(a).join(" "))},remove:function(a){this.include(a)&&this.set($A(this).without(a).join(" "))},toString:function(){return $A(this).join(" ")}};Object.extend(Element.ClassNames.prototype,Enumerable);
(function(){window.Selector=Class.create({initialize:function(a){this.expression=a.strip()},findElements:function(a){return Prototype.Selector.select(this.expression,a)},match:function(a){return Prototype.Selector.match(a,this.expression)},toString:function(){return this.expression},inspect:function(){return"#<Selector: "+this.expression+">"}});Object.extend(Selector,{matchElements:function(a,b){for(var c=Prototype.Selector.match,f=[],d=0,g=a.length;d<g;d++){var e=a[d];c(e,b)&&f.push(Element.extend(e))}return f},
findElement:function(a,b,c){c=c||0;for(var f=0,d,g=0,e=a.length;g<e;g++)if(d=a[g],Prototype.Selector.match(d,b)&&c===f++)return Element.extend(d)},findChildElements:function(a,b){var c=b.toArray().join(", ");return Prototype.Selector.select(c,a||document)}})})();var fabric=fabric||{version:"1.2.6"};"undefined"!==typeof exports&&(exports.fabric=fabric);"undefined"!==typeof document&&"undefined"!==typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow());fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode="undefined"!==typeof Buffer&&"undefined"===typeof window;
var Cufon=function(){function a(a){var c=this.face=a.face;this.glyphs=a.glyphs;this.w=a.w;this.baseSize=parseInt(c["units-per-em"],10);this.family=c["font-family"].toLowerCase();this.weight=c["font-weight"];this.style=c["font-style"]||"normal";this.viewBox=function(){var a=c.bbox.split(/\s+/),a={minX:parseInt(a[0],10),minY:parseInt(a[1],10),maxX:parseInt(a[2],10),maxY:parseInt(a[3],10)};a.width=a.maxX-a.minX;a.height=a.maxY-a.minY;a.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return a}();this.ascent=-parseInt(c.ascent,10);this.descent=-parseInt(c.descent,10);this.height=-this.ascent+this.descent}function b(){var a={},c={oblique:"italic",italic:"oblique"};this.add=function(c){(a[c.style]||(a[c.style]={}))[c.weight]=c};this.get=function(b,d){var e=a[b]||a[c[b]]||a.normal||a.italic||a.oblique;if(!e)return null;d={normal:400,bold:700}[d]||parseInt(d,10);if(e[d])return e[d];var g={1:1,99:0}[d%100],f=[],h,n;void 0===g&&(g=400<d);500==d&&(d=400);for(var k in e){k=parseInt(k,
10);if(!h||k<h)h=k;if(!n||k>n)n=k;f.push(k)}d<h&&(d=h);d>n&&(d=n);f.sort(function(a,c){return(g?a>d&&c>d?a<c:a>c:a<d&&c<d?a>c:a<c)?-1:1});return e[f[0]]}}function c(a){var c={},b={};this.get=function(b){return void 0!=c[b]?c[b]:a[b]};this.getSize=function(a,c){return b[a]||(b[a]=new n.Size(this.get(a),c))};this.extend=function(a){for(var b in a)c[b]=a[b];return this}}function f(a,c,b){a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent&&a.attachEvent("on"+c,function(){return b.call(a,fabric.window.event)})}
function d(a){var c={};return function(b){c.hasOwnProperty(b)||(c[b]=a.apply(null,arguments));return c[b]}}function g(a){return fabric.document.getElementsByTagName(a)}function e(){for(var a={},c,b=0,d=arguments.length;b<d;++b)for(c in arguments[b])a[c]=arguments[b][c];return a}function h(a,c,b,d,e,g){var f=d.separate;if("none"==f)return x[d.engine].apply(null,arguments);var h=fabric.document.createDocumentFragment(),k=c.split(t[f]),m="words"==f;m&&p&&(/^\s/.test(c)&&k.unshift(""),/\s$/.test(c)&&
k.push(""));for(var l=0,q=k.length;l<q;++l)(f=x[d.engine](a,m?n.textAlign(k[l],b,l,q):k[l],b,d,e,g,l<q-1))&&h.appendChild(f);return h}function k(a,c){var b,d,e,g;e=q.get(a);e.options||(c.hover&&c.hoverables[a.nodeName.toLowerCase()]&&u.attach(a),e.options=c);for(var f=a.firstChild;f;f=e){e=f.nextSibling;g=!1;if(1==f.nodeType){if(!f.firstChild)continue;if(/cufon/.test(f.className))g=!0;else{arguments.callee(f,c);continue}}d||(d=n.getStyle(a).extend(c));if(!b)a:{(b=d)||(b=n.getStyle(a));for(var k=n.quotedList(b.get("fontFamily").toLowerCase()),
m=void 0,p=0,l=k.length;p<l;++p)if(m=k[p],w[m]){b=w[m].get(b.get("fontStyle"),b.get("fontWeight"));break a}b=null}if(b)if(g)x[c.engine](b,null,d,c,f,a);else g=f.data,"undefined"!=typeof G_vmlCanvasManager&&(g=g.replace(/\r/g,"\n")),""!==g&&((g=h(b,g,d,c,f,a))?f.parentNode.replaceChild(g,f):f.parentNode.removeChild(f))}}var l=function(){return l.replace.apply(null,arguments)},m=l.DOM={ready:function(){var a=!1,c={loaded:1,complete:1},b=[],d=function(){if(!a){a=!0;for(var c;c=b.shift();c());}};fabric.document.addEventListener&&
(fabric.document.addEventListener("DOMContentLoaded",d,!1),fabric.window.addEventListener("pageshow",d,!1));!fabric.window.opera&&fabric.document.readyState&&function(){c[fabric.document.readyState]?d():setTimeout(arguments.callee,10)}();fabric.document.readyState&&fabric.document.createStyleSheet&&function(){try{fabric.document.body.doScroll("left"),d()}catch(a){setTimeout(arguments.callee,1)}}();f(fabric.window,"load",d);return function(c){arguments.length?a?c():b.push(c):d()}}()},n=l.CSS={Size:function(a,
c){this.value=parseFloat(a);this.unit=String(a).match(/[a-z%]*$/)[0]||"px";this.convert=function(a){return a/c*this.value};this.convertFrom=function(a){return a/this.value*c};this.toString=function(){return this.value+this.unit}},getStyle:function(a){return new c(a.style)},quotedList:d(function(a){for(var c=[],b=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,d;d=b.exec(a);)c.push(d[3]||d[1]);return c}),ready:function(){var a=!1,c=[],b=Object.prototype.propertyIsEnumerable?g("style"):{length:0},d=g("link");
m.ready(function(){for(var e=0,g,f=0,h=d.length;g=d[f],f<h;++f)g.disabled||"stylesheet"!=g.rel.toLowerCase()||++e;if(fabric.document.styleSheets.length>=b.length+e)for(a=!0;e=c.shift();e());else setTimeout(arguments.callee,10)});return function(b){a?b():c.push(b)}}(),supports:function(a,c){var b=fabric.document.createElement("span").style;if(void 0===b[a])return!1;b[a]=c;return b[a]===c},textAlign:function(a,c,b,d){"right"==c.get("textAlign")?0<b&&(a=" "+a):b<d-1&&(a+=" ");return a},textDecoration:function(a,
c){c||(c=this.getStyle(a));for(var b={underline:null,overline:null,"line-through":null},d=a;d.parentNode&&1==d.parentNode.nodeType;){var e=!0,g;for(g in b)b[g]||(-1!=c.get("textDecoration").indexOf(g)&&(b[g]=c.get("color")),e=!1);if(e)break;c=this.getStyle(d=d.parentNode)}return b},textShadow:d(function(a){if("none"==a)return null;for(var c=[],b={},d,e=0,g=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;d=g.exec(a);)","==d[0]?(c.push(b),b={},e=0):d[1]?b.color=d[1]:b[["offX","offY","blur"][e++]]=
d[2];c.push(b);return c}),color:d(function(a){var c={};c.color=a.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(a,b,d){c.opacity=parseFloat(d);return"rgb("+b+")"});return c}),textTransform:function(a,c){return a[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[c.get("textTransform")]||"toString"]()}},p=0==" ".split(/\s+/).length,q=new function(){var a={},c=0;this.get=function(b){b=b.cufid||(b.cufid=++c);return a[b]||(a[b]={})}},u=new function(){function a(c){c=c.relatedTarget;var d;(d=!c)||(d=this.contains?
this.contains(c):this.compareDocumentPosition(c)&16);d||b(this)}function c(a){b(this)}function b(a){setTimeout(function(){l.replace(a,q.get(a).options,!0)},10)}this.attach=function(b){void 0===b.onmouseenter?(f(b,"mouseover",a),f(b,"mouseout",a)):(f(b,"mouseenter",c),f(b,"mouseleave",c))}},y=[],x={},w={},A={engine:null,hover:!1,hoverables:{a:!0},printable:!0,selector:fabric.window.Sizzle||fabric.window.jQuery&&function(a){return jQuery(a)}||fabric.window.dojo&&dojo.query||fabric.window.$$&&function(a){return $$(a)}||
fabric.window.$&&function(a){return $(a)}||fabric.document.querySelectorAll&&function(a){return fabric.document.querySelectorAll(a)}||g,separate:"words",textShadow:"none"},t={words:/\s+/,characters:""};l.now=function(){m.ready();return l};l.refresh=function(){for(var a=y.splice(0,y.length),c=0,b=a.length;c<b;++c)l.replace.apply(null,a[c]);return l};l.registerEngine=function(a,c){if(!c)return l;x[a]=c;return l.set("engine",a)};l.registerFont=function(c){c=new a(c);var d=c.family;w[d]||(w[d]=new b);
w[d].add(c);return l.set("fontFamily",'"'+d+'"')};l.replace=function(a,c,b){c=e(A,c);if(!c.engine)return l;"string"==typeof c.textShadow&&c.textShadow&&(c.textShadow=n.textShadow(c.textShadow));b||y.push(arguments);if(a.nodeType||"string"==typeof a)a=[a];n.ready(function(){for(var b=0,d=a.length;b<d;++b){var e=a[b];"string"==typeof e?l.replace(c.selector(e),c,!0):k(e,c)}});return l};l.replaceElement=function(a,c){c=e(A,c);"string"==typeof c.textShadow&&c.textShadow&&(c.textShadow=n.textShadow(c.textShadow));
return k(a,c)};l.engines=x;l.fonts=w;l.getOptions=function(){return e(A)};l.set=function(a,c){A[a]=c;return l};return l}();
Cufon.registerEngine("canvas",function(){var a=Cufon.CSS.supports("display","inline-block"),b=!a&&("BackCompat"==fabric.document.compatMode||/frameset|transitional/i.test(fabric.document.doctype.publicId)),c=fabric.document.createElement("style");c.type="text/css";b=fabric.document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(b?"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+
(a?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}");try{c.appendChild(b)}catch(f){c.setAttribute("type","text/css"),c.styleSheet.cssText=b.data}fabric.document.getElementsByTagName("head")[0].appendChild(c);return function(c,b,e,f,k,l){function m(a){v.fillStyle=a||Cufon.textOptions.color||e.get("color");var b=a=0;"right"===f.textAlign?
v.translate(D[b],0):"center"===f.textAlign&&v.translate(D[b]/2,0);for(var g=0,n=B.length;g<n;++g)if("\n"===B[g]){b++;var k=-c.ascent-c.ascent/5*f.lineHeight;"right"===f.textAlign?(v.translate(-C,k),v.translate(D[b],0)):"center"===f.textAlign?(v.translate(-a-D[b-1]/2,k),v.translate(D[b]/2,0)):v.translate(-a,k);a=0}else{var m=c.glyphs[B[g]]||c.missingGlyph;if(m){k=Number(m.w||c.w)+u;E&&(v.save(),v.strokeStyle=v.fillStyle,v.lineWidth+=v.lineWidth,v.beginPath(),E.underline&&(v.moveTo(0,-c.face["underline-position"]+
0.5),v.lineTo(k,-c.face["underline-position"]+0.5)),E.overline&&(v.moveTo(0,c.ascent+0.5),v.lineTo(k,c.ascent+0.5)),E["line-through"]&&(v.moveTo(0,-c.descent+0.5),v.lineTo(k,-c.descent+0.5)),v.stroke(),v.restore());P&&(v.save(),v.transform(1,0,-0.25,1,0,0));v.beginPath();if(m.d)if(m.code)for(var p=m.code,m=v,l=0,q=p.length;l<q;++l){var y=p[l];m[y.m].apply(m,y.a)}else{var p=m,m="m"+m.d,l=v,y=q=0,A=[],t=/([mrvxe])([^a-z]*)/g,z=void 0,x=0;a:for(;z=t.exec(m);++x){var r=z[2].split(",");switch(z[1]){case "v":A[x]=
{m:"bezierCurveTo",a:[q+~~r[0],y+~~r[1],q+~~r[2],y+~~r[3],q+=~~r[4],y+=~~r[5]]};break;case "r":A[x]={m:"lineTo",a:[q+=~~r[0],y+=~~r[1]]};break;case "m":A[x]={m:"moveTo",a:[q=~~r[0],y=~~r[1]]};break;case "x":A[x]={m:"closePath",a:[]};break;case "e":break a}l[A[x].m].apply(l,A[x].a)}p.code=A}v.fill();f.strokeStyle&&(v.closePath(),v.save(),v.lineWidth=f.strokeWidth,v.strokeStyle=f.strokeStyle,v.stroke(),v.restore());P&&v.restore();v.translate(k,0);a+=k}}}var n=null===b,p=c.viewBox,q=e.getSize("fontSize",
c.baseSize),u=e.get("letterSpacing"),u="normal"==u?0:q.convertFrom(parseInt(u,10)),y=l=0,x=0,w=f.textShadow,A=[];Cufon.textOptions.shadowOffsets=[];Cufon.textOptions.shadows=null;if(w){Cufon.textOptions.shadows=w;for(var t=0,z=w.length;t<z;++t){var r=w[t],s=q.convertFrom(parseFloat(r.offX)),r=q.convertFrom(parseFloat(r.offY));A[t]=[s,r]}}for(var B=Cufon.CSS.textTransform(n?k.alt:b,e).split(""),C=0,r=null,s=0,F=1,I=[],t=0,z=B.length;t<z;++t)if("\n"===B[t])F++,C>s&&(s=C),I.push(C),C=0;else{var H=c.glyphs[B[t]]||
c.missingGlyph;H&&(C+=r=Number(H.w||c.w)+u)}I.push(C);for(var C=Math.max(s,C),D=[],t=I.length;t--;)D[t]=C-I[t];if(null===r)return null;y+=p.width-r;x+=p.minX;n?(n=k,k=k.firstChild):(n=fabric.document.createElement("span"),n.className="cufon cufon-canvas",n.alt=b,k=fabric.document.createElement("canvas"),n.appendChild(k),f.printable&&(t=fabric.document.createElement("span"),t.className="cufon-alt",t.appendChild(fabric.document.createTextNode(b)),n.appendChild(t)));b=n.style;z=k.style||{};r=q.convert(p.height-
l+0);t=Math.ceil(r);r=t/r;k.width=Math.ceil(q.convert(C+y-x)*r);k.height=t;l+=p.minY;z.top=Math.round(q.convert(l-c.ascent))+"px";z.left=Math.round(q.convert(x))+"px";y=Math.ceil(q.convert(C*r));z=y+"px";r=q.convert(c.height);q=(f.lineHeight-1)*q.convert(-c.ascent/5)*(F-1);Cufon.textOptions.width=y;Cufon.textOptions.height=r*F+q;Cufon.textOptions.lines=F;Cufon.textOptions.totalLineHeight=q;a?(b.width=z,b.height=r+"px"):(b.paddingLeft=z,b.paddingBottom=r-1+"px");var v=Cufon.textOptions.context||k.getContext("2d"),
G=t/p.height;Cufon.textOptions.fontAscent=c.ascent*G;Cufon.textOptions.boundaries=null;p=Cufon.textOptions.shadowOffsets;for(t=A.length;t--;)p[t]=[A[t][0]*G,A[t][1]*G];v.save();v.scale(G,G);v.translate(-x-1/G*k.width/2+(Cufon.fonts[c.family].offsetLeft||0),-l-Cufon.textOptions.height/G/2+(Cufon.fonts[c.family].offsetTop||0));v.lineWidth=c.face["underline-thickness"];v.save();var E=Cufon.getTextDecoration(f),P="italic"===f.fontStyle;v.save();(function(){v.save();var a=0,b=0,e=[{left:0}];f.backgroundColor&&
(v.save(),v.fillStyle=f.backgroundColor,v.translate(0,c.ascent),v.fillRect(0,0,C+10,(-c.ascent+c.descent)*F),v.restore());"right"===f.textAlign?(v.translate(D[b],0),e[0].left=D[b]*G):"center"===f.textAlign&&(v.translate(D[b]/2,0),e[0].left=D[b]/2*G);for(var g=0,n=B.length;g<n;++g)if("\n"===B[g]){b++;var k=-c.ascent-c.ascent/5*f.lineHeight,m=e[e.length-1],p={left:0};m.width=a*G;m.height=(-c.ascent+c.descent)*G;"right"===f.textAlign?(v.translate(-C,k),v.translate(D[b],0),p.left=D[b]*G):"center"===f.textAlign?
(v.translate(-a-D[b-1]/2,k),v.translate(D[b]/2,0),p.left=D[b]/2*G):v.translate(-a,k);e.push(p);a=0}else if(k=c.glyphs[B[g]]||c.missingGlyph)k=Number(k.w||c.w)+u,f.textBackgroundColor&&(v.save(),v.fillStyle=f.textBackgroundColor,v.translate(0,c.ascent),v.fillRect(0,0,k+10,-c.ascent+c.descent),v.restore()),v.translate(k,0),a+=k,g==n-1&&(e[e.length-1].width=a*G,e[e.length-1].height=(-c.ascent+c.descent)*G);v.restore();Cufon.textOptions.boundaries=e})();if(w)for(t=0,z=w.length;t<z;++t)r=w[t],v.save(),
v.translate.apply(v,A[t]),m(r.color),v.restore();m();v.restore();v.restore();v.restore();return n}}());
Cufon.registerEngine("vml",function(){function a(a,b){if(/px$/i.test(b))return parseFloat(b);var d=a.style.left,g=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=b;var e=a.style.pixelLeft;a.style.left=d;a.runtimeStyle.left=g;return e}if(fabric.document.namespaces){var b=fabric.document.createElement("canvas");if(!(b&&b.getContext&&b.getContext.apply)&&(null==fabric.document.namespaces.cvml&&fabric.document.namespaces.add("cvml","urn:schemas-microsoft-com:vml"),b=fabric.document.createElement("cvml:shape"),
b.style.behavior="url(#default#VML)",b.coordsize))return b=null,fabric.document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>'),
function(c,b,d,g,e,h,k){var l=null===b;l&&(b=e.alt);var m=c.viewBox,n;if(!(n=d.computedFontSize)){n=Cufon.CSS.Size;var p;p=d.get("fontSize");p=a(h,/(?:em|ex|%)$/i.test(p)?"1em":p);n=d.computedFontSize=new n(p+"px",c.baseSize)}p=d.computedLSpacing;void 0==p&&(p=d.get("letterSpacing"),d.computedLSpacing=p="normal"==p?0:~~n.convertFrom(a(h,p)));if(l)h=e,e=e.firstChild;else{h=fabric.document.createElement("span");h.className="cufon cufon-vml";h.alt=b;e=fabric.document.createElement("span");e.className=
"cufon-vml-canvas";h.appendChild(e);if(g.printable){var q=fabric.document.createElement("span");q.className="cufon-alt";q.appendChild(fabric.document.createTextNode(b));h.appendChild(q)}k||h.appendChild(fabric.document.createElement("cvml:shape"))}k=h.style;var u=e.style,y=n.convert(m.height),q=Math.ceil(y),y=q/y,x=m.minX,w=m.minY;u.height=q;u.top=Math.round(n.convert(w-c.ascent));u.left=Math.round(n.convert(x));k.height=n.convert(c.height)+"px";Cufon.getTextDecoration(g);u=d.get("color");b=Cufon.CSS.textTransform(b,
d).split("");var A=d=0,t=null,z;g=g.textShadow;for(var r=0,s=0,B=b.length;r<B;++r)(z=c.glyphs[b[r]]||c.missingGlyph)&&(d+=t=~~(z.w||c.w)+p);if(null===t)return null;z=-x+d+(m.width-t);for(var r=n.convert(z*y),t=Math.round(r),C=z+","+m.height,F,I="r"+C+"nsnf",r=0;r<B;++r)if(z=c.glyphs[b[r]]||c.missingGlyph){l?(m=e.childNodes[s],m.firstChild&&m.removeChild(m.firstChild)):(m=fabric.document.createElement("cvml:shape"),e.appendChild(m));m.stroked="f";m.coordsize=C;m.coordorigin=F=x-A+","+w;m.path=(z.d?
"m"+z.d+"xe":"")+"m"+F+I;m.fillcolor=u;F=m.style;F.width=t;F.height=q;if(g){F=g[0];var H=g[1],D=Cufon.CSS.color(F.color),v,G=fabric.document.createElement("cvml:shadow");G.on="t";G.color=D.color;G.offset=F.offX+","+F.offY;H&&(v=Cufon.CSS.color(H.color),G.type="double",G.color2=v.color,G.offset2=H.offX+","+H.offY);G.opacity=D.opacity||v&&v.opacity||1;m.appendChild(G)}A+=~~(z.w||c.w)+p;++s}k.width=Math.max(Math.ceil(n.convert(d*y)),0);return h}}}());
Cufon.getTextDecoration=function(a){return{underline:"underline"===a.textDecoration,overline:"overline"===a.textDecoration,"line-through":"line-through"===a.textDecoration}};"undefined"!=typeof exports&&(exports.Cufon=Cufon);var JSON;JSON||(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function b(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var c=h[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,d){var f,h,q,u,y=g,x,w=d[a];w&&("object"===typeof w&&"function"===typeof w.toJSON)&&(w=w.toJSON(a));"function"===typeof k&&(w=k.call(d,a,w));switch(typeof w){case "string":return b(w);case "number":return isFinite(w)?String(w):"null";case "boolean":case "null":return String(w);
case "object":if(!w)return"null";g+=e;x=[];if("[object Array]"===Object.prototype.toString.apply(w)){u=w.length;for(f=0;f<u;f+=1)x[f]=c(f,w)||"null";q=0===x.length?"[]":g?"[\n"+g+x.join(",\n"+g)+"\n"+y+"]":"["+x.join(",")+"]";g=y;return q}if(k&&"object"===typeof k)for(u=k.length,f=0;f<u;f+=1)"string"===typeof k[f]&&(h=k[f],(q=c(h,w))&&x.push(b(h)+(g?": ":":")+q));else for(h in w)Object.prototype.hasOwnProperty.call(w,h)&&(q=c(h,w))&&x.push(b(h)+(g?": ":":")+q);q=0===x.length?"{}":g?"{\n"+g+x.join(",\n"+
g)+"\n"+y+"}":"{"+x.join(",")+"}";g=y;return q}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(c){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g,e,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,d){var f;e=g="";if("number"===typeof d)for(f=0;f<d;f+=1)e+=" ";else"string"===typeof d&&(e=d);if((k=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,c){function b(a,d){var e,g,f=a[d];if(f&&"object"===typeof f)for(e in f)Object.prototype.hasOwnProperty.call(f,e)&&(g=b(f,e),void 0!==g?f[e]=g:delete f[e]);return c.call(a,d,f)}var d;a=String(a);f.lastIndex=0;f.test(a)&&(a=a.replace(f,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof c?b({"":d},""):d;throw new SyntaxError("JSON.parse");})})();fabric.log=function(){};fabric.warn=function(){};"undefined"!==typeof console&&("undefined"!==typeof console.log&&console.log.apply&&(fabric.log=function(){return console.log.apply(console,arguments)}),"undefined"!==typeof console.warn&&console.warn.apply&&(fabric.warn=function(){return console.warn.apply(console,arguments)}));
(function(){function a(a,c){this.__eventListeners||(this.__eventListeners={});if(1===arguments.length)for(var b in a)this.on(b,a[b]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(c)}function b(a,c){this.__eventListeners||(this.__eventListeners={});this.__eventListeners[a]&&(c?fabric.util.removeFromArray(this.__eventListeners[a],c):this.__eventListeners[a].length=0)}function c(a,c){this.__eventListeners||(this.__eventListeners={});var b=this.__eventListeners[a];
if(b)for(var e=0,h=b.length;e<h;e++)b[e](c||{})}fabric.Observable={observe:a,stopObserving:b,fire:c,on:a,off:b,trigger:c}})();
fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=arguments.length;a--;)this._onObjectAdded(arguments[a]);this.renderOnAddition&&this.renderAll();return this},insertAt:function(a,b,c){var f=this.getObjects();c?f[b]=a:f.splice(b,0,a);this._onObjectAdded(a);this.renderOnAddition&&this.renderAll();return this},remove:function(a){var b=this.getObjects(),c=b.indexOf(a);-1!==c&&(b.splice(c,1),this._onObjectRemoved(a));this.renderAll&&this.renderAll();return a},
forEachObject:function(a,b){for(var c=this.getObjects(),f=c.length;f--;)a.call(b,c[f],f,c);return this},item:function(a){return this.getObjects()[a]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(a){return-1<this.getObjects().indexOf(a)},complexity:function(){return this.getObjects().reduce(function(a,b){return a+=b.complexity?b.complexity():0},0)},toGrayscale:function(){return this.forEachObject(function(a){a.toGrayscale()})}};
(function(){function a(a,c,b,d,e,g,f,k,t){m=l.call(arguments);if(h[m])return h[m];var z=f*(Math.PI/180),r=Math.sin(z),z=Math.cos(z);b=Math.abs(b);d=Math.abs(d);var s=0.5*z*(k-a)+0.5*r*(t-c),B=0.5*z*(t-c)-0.5*r*(k-a),s=s*s/(b*b)+B*B/(d*d);1<s&&(s=Math.sqrt(s),b*=s,d*=s);var C=z/b,F=r/b,I=-r/d,H=z/d,s=C*k+F*t,B=I*k+H*t,C=C*a+F*c,F=I*a+H*c,I=1/((C-s)*(C-s)+(F-B)*(F-B))-0.25;0>I&&(I=0);H=Math.sqrt(I);g===e&&(H=-H);I=0.5*(s+C)-H*(F-B);H=0.5*(B+F)+H*(C-s);s=Math.atan2(B-H,s-I);B=Math.atan2(F-H,C-I)-s;0>
B&&1===g?B+=2*Math.PI:0<B&&0===g&&(B-=2*Math.PI);for(var C=Math.ceil(Math.abs(B/(0.5*Math.PI+0.0010))),F=[],D=0;D<C;D++)F[D]=[I,H,s+D*B/C,s+(D+1)*B/C,b,d,r,z];return h[m]=F}function b(a,c,b,d,e,g,f,h){m=l.call(arguments);if(k[m])return k[m];var t=h*e,z=-f*g,r=f*e,s=h*g,B=0.5*(d-b),C=8/3*Math.sin(0.5*B)*Math.sin(0.5*B)/Math.sin(B),B=a+Math.cos(b)-C*Math.sin(b),F=c+Math.sin(b)+C*Math.cos(b),I=a+Math.cos(d),H=c+Math.sin(d),D=I+C*Math.sin(d),C=H-C*Math.cos(d);k[m]=[t*B+z*F,r*B+s*F,t*D+z*C,r*D+s*C,t*I+
z*H,r*I+s*H];return k[m]}var c=Math.sqrt,f=Math.atan2;fabric.util={};var d=Math.PI/180,g=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(a){fabric.window.setTimeout(a,1E3/60)},e=function(){return g.apply(fabric.window,arguments)},h={},k={},l=Array.prototype.join,m;fabric.util.removeFromArray=function(a,c){var b=a.indexOf(c);-1!==b&&a.splice(b,
1);return a};fabric.util.degreesToRadians=function(a){return a*d};fabric.util.radiansToDegrees=function(a){return a/d};fabric.util.rotatePoint=function(a,c,b){var d=Math.sin(b);b=Math.cos(b);a.subtractEquals(c);return(new fabric.Point(a.x*b-a.y*d,a.x*d+a.y*b)).addEquals(c)};fabric.util.toFixed=function(a,c){return parseFloat(Number(a).toFixed(c))};fabric.util.getRandomInt=function(a,c){return Math.floor(Math.random()*(c-a+1))+a};fabric.util.falseFunction=function(){return!1};fabric.util.animate=function(a){a||
(a={});var c=+new Date,b=a.duration||500,d=c+b,g,f=a.onChange||function(){},h=a.abort||function(){return!1},k=a.easing||function(a,c,b,d){return-b*Math.cos(a/d*(Math.PI/2))+b+c},m="startValue"in a?a.startValue:0,l="endValue"in a?a.endValue:100,r=a.byValue||l-m;a.onStart&&a.onStart();(function B(){g=+new Date;f(k(g>d?b:g-c,m,r,b));g>d||h()?a.onComplete&&a.onComplete():e(B)})()};fabric.util.requestAnimFrame=e;fabric.util.getKlass=function(a){return fabric[fabric.util.string.camelize(fabric.util.string.capitalize(a))]};
fabric.util.loadImage=function(a,c,b){if(a){var d=fabric.util.createImage();d.onload=function(){c&&c.call(b,d);d=d.onload=null};d.src=a}else c&&c.call(b,a)};fabric.util.enlivenObjects=function(a,c){var b=[],d=0,e=a.length;a.forEach(function(a,g){if(a.type){var f=fabric.util.getKlass(a.type);f.async?f.fromObject(a,function(a,f){f||(b[g]=a);++d===e&&c&&c(b)}):(b[g]=f.fromObject(a),++d===e&&c&&c(b))}})};fabric.util.groupSVGElements=function(a,c,b){a=1<a.length?new fabric.PathGroup(a,c):a[0];"undefined"!==
typeof b&&a.setSourcePath(b);return a};fabric.util.populateWithProperties=function(a,c,b){if(b&&"[object Array]"===Object.prototype.toString.call(b))for(var d=0,e=b.length;d<e;d++)b[d]in a&&(c[b[d]]=a[b[d]])};fabric.util.drawDashedLine=function(a,b,d,e,g,h){e-=b;var k=g-d;g=c(e*e+k*k);e=f(k,e);var k=h.length,m=0,l=!0;a.save();a.translate(b,d);a.moveTo(0,0);a.rotate(e);for(b=0;g>b;)b+=h[m++%k],b>g&&(b=g),a[l?"lineTo":"moveTo"](b,0),l=!l;a.restore()};fabric.util.createCanvasElement=function(a){a||(a=
fabric.document.createElement("canvas"));a.getContext||"undefined"===typeof G_vmlCanvasManager||G_vmlCanvasManager.initElement(a);return a};fabric.util.createImage=function(){return fabric.isLikelyNode?new (require("canvas").Image):fabric.document.createElement("img")};fabric.util.createAccessors=function(a){a=a.prototype;for(var c=a.stateProperties.length;c--;){var b=a.stateProperties[c],d=b.charAt(0).toUpperCase()+b.slice(1),e="set"+d,d="get"+d;a[d]||(a[d]=new Function('return this.get("'+b+'")'));
a[e]||(a[e]=new Function("value",'return this.set("'+b+'", value)'))}};fabric.util.clipContext=function(a,c){c.save();c.beginPath();a.clipTo(c);c.clip()};fabric.util.multiplyTransformMatrices=function(a,c){for(var b=[[a[0],a[2],a[4]],[a[1],a[3],a[5]],[0,0,1]],d=[[c[0],c[2],c[4]],[c[1],c[3],c[5]],[0,0,1]],e=[],g=0;3>g;g++){e[g]=[];for(var f=0;3>f;f++){for(var h=0,k=0;3>k;k++)h+=b[g][k]*d[k][f];e[g][f]=h}}return[e[0][0],e[1][0],e[0][1],e[1][1],e[0][2],e[1][2]]};fabric.util.getFunctionBody=function(a){return(String(a).match(/function[^{]*\{([\s\S]*)\}/)||
{})[1]};fabric.util.drawArc=function(c,d,e,g){d=a(g[5],g[6],g[0],g[1],g[3],g[4],g[2],d,e);for(e=0;e<d.length;e++)g=b.apply(this,d[e]),c.bezierCurveTo.apply(c,g)}})();
(function(){var a=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(void 0===this||null===this)throw new TypeError;var c=Object(this),f=c.length>>>0;if(0===f)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&(d!==Number.POSITIVE_INFINITY&&d!==Number.NEGATIVE_INFINITY)&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=f)return-1;for(d=0<=d?d:Math.max(f-Math.abs(d),0);d<f;d++)if(d in c&&c[d]===a)return d;return-1});Array.prototype.forEach||
(Array.prototype.forEach=function(a,c){for(var f=0,d=this.length>>>0;f<d;f++)f in this&&a.call(c,this[f],f,this)});Array.prototype.map||(Array.prototype.map=function(a,c){for(var f=[],d=0,g=this.length>>>0;d<g;d++)d in this&&(f[d]=a.call(c,this[d],d,this));return f});Array.prototype.every||(Array.prototype.every=function(a,c){for(var f=0,d=this.length>>>0;f<d;f++)if(f in this&&!a.call(c,this[f],f,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(a,c){for(var f=0,d=this.length>>>
0;f<d;f++)if(f in this&&a.call(c,this[f],f,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(a,c){for(var f=[],d,g=0,e=this.length>>>0;g<e;g++)g in this&&(d=this[g],a.call(c,d,g,this)&&f.push(d));return f});Array.prototype.reduce||(Array.prototype.reduce=function(a){var c=this.length>>>0,f=0,d;if(1<arguments.length)d=arguments[1];else{do{if(f in this){d=this[f++];break}if(++f>=c)throw new TypeError;}while(1)}for(;f<c;f++)f in this&&(d=a.call(null,d,this[f],f,this));
return d});fabric.util.array={invoke:function(b,c){for(var f=a.call(arguments,2),d=[],g=0,e=b.length;g<e;g++)d[g]=f.length?b[g][c].apply(b[g],f):b[g][c].call(b[g]);return d},min:function(a,c){if(a&&0!==a.length){var f=a.length-1,d=c?a[f][c]:a[f];if(c)for(;f--;)a[f][c]<d&&(d=a[f][c]);else for(;f--;)a[f]<d&&(d=a[f]);return d}},max:function(a,c){if(a&&0!==a.length){var f=a.length-1,d=c?a[f][c]:a[f];if(c)for(;f--;)a[f][c]>=d&&(d=a[f][c]);else for(;f--;)a[f]>=d&&(d=a[f]);return d}}}})();
(function(){function a(a,c){for(var f in c)a[f]=c[f];return a}fabric.util.object={extend:a,clone:function(b){return a({},b)}}})();
(function(){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:function(a){return a.replace(/-+(.)?/g,function(a,c){return c?c.toUpperCase():""})},capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},escapeXml:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}}})();
(function(){var a=Array.prototype.slice,b=Function.prototype.apply,c=function(){};Function.prototype.bind||(Function.prototype.bind=function(f){var d=this,g=a.call(arguments,1),e;e=g.length?function(){return b.call(d,this instanceof c?this:f,g.concat(a.call(arguments)))}:function(){return b.call(d,this instanceof c?this:f,arguments)};c.prototype=this.prototype;e.prototype=new c;return e})})();
(function(){function a(){}function b(a){var b=this.constructor.superclass.prototype[a];return 1<arguments.length?b.apply(this,c.call(arguments,1)):b.call(this)}var c=Array.prototype.slice,f=function(){},d=function(){for(var a in{toString:1})if("toString"===a)return!1;return!0}(),g=function(a,c,b){for(var g in c)g in a.prototype&&"function"===typeof a.prototype[g]&&-1<(c[g]+"").indexOf("callSuper")?a.prototype[g]=function(a){return function(){var d=this.constructor.superclass;this.constructor.superclass=
b;var e=c[a].apply(this,arguments);this.constructor.superclass=d;if("initialize"!==a)return e}}(g):a.prototype[g]=c[g],d&&(c.toString!==Object.prototype.toString&&(a.prototype.toString=c.toString),c.valueOf!==Object.prototype.valueOf&&(a.prototype.valueOf=c.valueOf))};fabric.util.createClass=function(){function d(){this.initialize.apply(this,arguments)}var h=null,k=c.call(arguments,0);"function"===typeof k[0]&&(h=k.shift());d.superclass=h;d.subclasses=[];h&&(a.prototype=h.prototype,d.prototype=new a,
h.subclasses.push(d));for(var l=0,m=k.length;l<m;l++)g(d,k[l],h);d.prototype.initialize||(d.prototype.initialize=f);d.prototype.constructor=d;d.prototype.callSuper=b;return d}})();
(function(){function a(a){var c=Array.prototype.slice.call(arguments,1),b,d,e=c.length;for(d=0;d<e;d++)if(b=typeof a[c[d]],!/^(?:function|object|unknown)$/.test(b))return!1;return!0}function b(a,c){return function(b){c.call(d(a),b||fabric.window.event)}}function c(a,c){return function(b){if(l[a]&&l[a][c])for(var d=l[a][c],e=0,g=d.length;e<g;e++)d[e].call(this,b||fabric.window.event)}}var f=function(){var a=0;return function(c){return c.__uniqueID||(c.__uniqueID="uniqueID__"+a++)}}(),d,g;(function(){var a=
{};d=function(c){return a[c]};g=function(c,b){a[c]=b}})();var e=a(fabric.document.documentElement,"addEventListener","removeEventListener")&&a(fabric.window,"addEventListener","removeEventListener"),h=a(fabric.document.documentElement,"attachEvent","detachEvent")&&a(fabric.window,"attachEvent","detachEvent"),k={},l={};e?(e=function(a,c,b){a.addEventListener(c,b,!1)},h=function(a,c,b){a.removeEventListener(c,b,!1)}):h?(e=function(a,c,d){var e=f(a);g(e,a);k[e]||(k[e]={});k[e][c]||(k[e][c]=[]);d={handler:d,
wrappedHandler:b(e,d)};k[e][c].push(d);a.attachEvent("on"+c,d.wrappedHandler)},h=function(a,c,b){var d=f(a),e;if(k[d]&&k[d][c])for(var g=0,h=k[d][c].length;g<h;g++)(e=k[d][c][g])&&e.handler===b&&(a.detachEvent("on"+c,e.wrappedHandler),k[d][c][g]=null)}):(e=function(a,b,d){var e=f(a);l[e]||(l[e]={});if(!l[e][b]){l[e][b]=[];var g=a["on"+b];g&&l[e][b].push(g);a["on"+b]=c(e,b)}l[e][b].push(d)},h=function(a,c,b){a=f(a);if(l[a]&&l[a][c]){c=l[a][c];a=0;for(var d=c.length;a<d;a++)c[a]===b&&c.splice(a,1)}});
fabric.util.addListener=e;fabric.util.removeListener=h;var m=function(a){return"unknown"!==typeof a.clientX?a.clientX:0},n=function(a){return"unknown"!==typeof a.clientY?a.clientY:0};fabric.isTouchSupported&&(m=function(a){return"touchend"!==a.type?a.touches&&a.touches[0]?a.touches[0].pageX-(a.touches[0].pageX-a.touches[0].clientX)||a.clientX:a.clientX:a.changedTouches&&a.changedTouches[0]?a.changedTouches[0].pageX-(a.changedTouches[0].pageX-a.changedTouches[0].clientX)||a.clientX:a.clientX},n=function(a){return"touchend"!==
a.type?a.touches&&a.touches[0]?a.touches[0].pageY-(a.touches[0].pageY-a.touches[0].clientY)||a.clientY:a.clientY:a.changedTouches&&a.changedTouches[0]?a.changedTouches[0].pageY-(a.changedTouches[0].pageY-a.changedTouches[0].clientY)||a.clientY:a.clientY});fabric.util.getPointer=function(a,c){a||(a=fabric.window.event);for(var b=a.target||("unknown"!==typeof a.srcElement?a.srcElement:null),d=fabric.document.body||{scrollLeft:0,scrollTop:0},e=fabric.document.documentElement,g=b,f=0,h=0,k;b&&b.parentNode&&
!k;)b=b.parentNode,b!==fabric.document&&"fixed"===fabric.util.getElementStyle(b,"position")&&(k=b),b!==fabric.document&&g!==c&&"absolute"===fabric.util.getElementStyle(b,"position")?h=f=0:b===fabric.document?(f=d.scrollLeft||e.scrollLeft||0,h=d.scrollTop||e.scrollTop||0):(f+=b.scrollLeft||0,h+=b.scrollTop||0);return{x:m(a)+f,y:n(a)+h}};fabric.util.object.extend(fabric.util,fabric.Observable)})();
(function(){var a=fabric.document.createElement("div"),b="string"===typeof a.style.filter,c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,f=function(a){return a};"string"===typeof a.style.opacity?f=function(a,c){a.style.opacity=c;return a}:b&&(f=function(a,b){var e=a.style;a.currentStyle&&!a.currentStyle.hasLayout&&(e.zoom=1);c.test(e.filter)?e.filter=e.filter.replace(c,0.9999<=b?"":"alpha(opacity="+100*b+")"):e.filter+=" alpha(opacity="+100*b+")";return a});fabric.util.setStyle=function(a,c){var b=a.style;
if(!b)return a;if("string"===typeof c)return a.style.cssText+=";"+c,-1<c.indexOf("opacity")?f(a,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var h in c)"opacity"===h?f(a,c[h]):b["float"===h||"cssFloat"===h?"undefined"===typeof b.styleFloat?"cssFloat":"styleFloat":h]=c[h];return a}})();
(function(){function a(a,c){var b=fabric.document.createElement(a),d;for(d in c)"class"===d?b.className=c[d]:"for"===d?b.htmlFor=c[d]:b.setAttribute(d,c[d]);return b}function b(a,c){a.style||(a.style={});if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle)return fabric.document.defaultView.getComputedStyle(a,null)[c];var b=a.style[c];!b&&a.currentStyle&&(b=a.currentStyle[c]);return b}var c=Array.prototype.slice,f=function(a){return c.call(a,0)},d;try{d=f(fabric.document.childNodes)instanceof
Array}catch(g){}d||(f=function(a){for(var c=Array(a.length),b=a.length;b--;)c[b]=a[b];return c});(function(){var a=fabric.document.documentElement.style,c="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=fabric.util.falseFunction);c?a.style[c]="none":"string"===typeof a.unselectable&&(a.unselectable=
"on");return a};fabric.util.makeElementSelectable=function(a){"undefined"!==typeof a.onselectstart&&(a.onselectstart=null);c?a.style[c]="":"string"===typeof a.unselectable&&(a.unselectable="");return a}})();(function(){fabric.util.getScript=function(a,c){var b=fabric.document.getElementsByTagName("head")[0],d=fabric.document.createElement("script"),g=!0;d.onload=d.onreadystatechange=function(a){!g||"string"===typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(g=!1,
c(a||fabric.window.event),d=d.onload=d.onreadystatechange=null)};d.src=a;b.appendChild(d)}})();fabric.util.getById=function(a){return"string"===typeof a?fabric.document.getElementById(a):a};fabric.util.toArray=f;fabric.util.makeElement=a;fabric.util.addClass=function(a,c){-1===(" "+a.className+" ").indexOf(" "+c+" ")&&(a.className+=(a.className?" ":"")+c)};fabric.util.wrapElement=function(c,b,d){"string"===typeof b&&(b=a(b,d));c.parentNode&&c.parentNode.replaceChild(b,c);b.appendChild(c);return b};
fabric.util.getElementOffset=function(a){var c,d={left:0,top:0},g=a&&a.ownerDocument,f={left:0,top:0};c={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!g)return{left:0,top:0};for(var n in c)f[c[n]]+=parseInt(b(a,n),10)||0;c=g.documentElement;"undefined"!==typeof a.getBoundingClientRect&&(d=a.getBoundingClientRect());a=null!=g&&g===g.window?g:9===g.nodeType&&(g.defaultView||g.parentWindow);return{left:d.left+(a.pageXOffset||c.scrollLeft)-(c.clientLeft||0)+f.left,
top:d.top+(a.pageYOffset||c.scrollTop)-(c.clientTop||0)+f.top}};fabric.util.getElementStyle=b})();
(function(){function a(){}var b=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],b=a.length;b--;)try{if(a[b]())return a[b]}catch(d){}}();fabric.util.request=function(c,f){f||(f={});var d=f.method?f.method.toUpperCase():"GET",g=f.onComplete||function(){},e=b(),h;e.onreadystatechange=function(){4===e.readyState&&(g(e),
e.onreadystatechange=a)};"GET"===d&&(h=null,"string"===typeof f.parameters&&(c=c+(/\?/.test(c)?"&":"?")+f.parameters));e.open(d,c,!0);"POST"!==d&&"PUT"!==d||e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send(h);return e}})();
(function(){function a(a,f,d,g){return d-b(g-a,0,d,g)+f}function b(a,b,d,g){return(a/=g)<1/2.75?d*7.5625*a*a+b:a<2/2.75?d*(7.5625*(a-=1.5/2.75)*a+0.75)+b:a<2.5/2.75?d*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:d*(7.5625*(a-=2.625/2.75)*a+0.984375)+b}fabric.util.ease={easeInQuad:function(a,b,d,g){return d*(a/=g)*a+b},easeOutQuad:function(a,b,d,g){return-d*(a/=g)*(a-2)+b},easeInOutQuad:function(a,b,d,g){a/=g/2;return 1>a?d/2*a*a+b:-d/2*(--a*(a-2)-1)+b},easeInCubic:function(a,b,d,g){return d*(a/=g)*a*a+b},easeOutCubic:function(a,
b,d,g){return d*((a=a/g-1)*a*a+1)+b},easeInOutCubic:function(a,b,d,g){a/=g/2;return 1>a?d/2*a*a*a+b:d/2*((a-=2)*a*a+2)+b},easeInQuart:function(a,b,d,g){return d*(a/=g)*a*a*a+b},easeOutQuart:function(a,b,d,g){return-d*((a=a/g-1)*a*a*a-1)+b},easeInOutQuart:function(a,b,d,g){a/=g/2;return 1>a?d/2*a*a*a*a+b:-d/2*((a-=2)*a*a*a-2)+b},easeInQuint:function(a,b,d,g){return d*(a/=g)*a*a*a*a+b},easeOutQuint:function(a,b,d,g){return d*((a=a/g-1)*a*a*a*a+1)+b},easeInOutQuint:function(a,b,d,g){a/=g/2;return 1>
a?d/2*a*a*a*a*a+b:d/2*((a-=2)*a*a*a*a+2)+b},easeInSine:function(a,b,d,g){return-d*Math.cos(a/g*(Math.PI/2))+d+b},easeOutSine:function(a,b,d,g){return d*Math.sin(a/g*(Math.PI/2))+b},easeInOutSine:function(a,b,d,g){return-d/2*(Math.cos(Math.PI*a/g)-1)+b},easeInExpo:function(a,b,d,g){return 0===a?b:d*Math.pow(2,10*(a/g-1))+b},easeOutExpo:function(a,b,d,g){return a===g?b+d:d*(-Math.pow(2,-10*a/g)+1)+b},easeInOutExpo:function(a,b,d,g){if(0===a)return b;if(a===g)return b+d;a/=g/2;return 1>a?d/2*Math.pow(2,
10*(a-1))+b:d/2*(-Math.pow(2,-10*--a)+2)+b},easeInCirc:function(a,b,d,g){return-d*(Math.sqrt(1-(a/=g)*a)-1)+b},easeOutCirc:function(a,b,d,g){return d*Math.sqrt(1-(a=a/g-1)*a)+b},easeInOutCirc:function(a,b,d,g){a/=g/2;return 1>a?-d/2*(Math.sqrt(1-a*a)-1)+b:d/2*(Math.sqrt(1-(a-=2)*a)+1)+b},easeInElastic:function(a,b,d,g){var e=1.70158,h=0,k=d;if(0===a)return b;a/=g;if(1===a)return b+d;h||(h=0.3*g);k<Math.abs(d)?(k=d,e=h/4):e=h/(2*Math.PI)*Math.asin(d/k);return-(k*Math.pow(2,10*(a-=1))*Math.sin((a*g-
e)*2*Math.PI/h))+b},easeOutElastic:function(a,b,d,g){var e=1.70158,h=0,k=d;if(0===a)return b;a/=g;if(1===a)return b+d;h||(h=0.3*g);k<Math.abs(d)?(k=d,e=h/4):e=h/(2*Math.PI)*Math.asin(d/k);return k*Math.pow(2,-10*a)*Math.sin((a*g-e)*2*Math.PI/h)+d+b},easeInOutElastic:function(a,b,d,g){var e=1.70158,h=0,k=d;if(0===a)return b;a/=g/2;if(2===a)return b+d;h||(h=g*0.3*1.5);k<Math.abs(d)?(k=d,e=h/4):e=h/(2*Math.PI)*Math.asin(d/k);return 1>a?-0.5*k*Math.pow(2,10*(a-=1))*Math.sin((a*g-e)*2*Math.PI/h)+b:0.5*
k*Math.pow(2,-10*(a-=1))*Math.sin((a*g-e)*2*Math.PI/h)+d+b},easeInBack:function(a,b,d,g,e){void 0===e&&(e=1.70158);return d*(a/=g)*a*((e+1)*a-e)+b},easeOutBack:function(a,b,d,g,e){void 0===e&&(e=1.70158);return d*((a=a/g-1)*a*((e+1)*a+e)+1)+b},easeInOutBack:function(a,b,d,g,e){void 0===e&&(e=1.70158);a/=g/2;return 1>a?d/2*a*a*(((e*=1.525)+1)*a-e)+b:d/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b},easeInBounce:a,easeOutBounce:b,easeInOutBounce:function(c,f,d,g){return c<g/2?0.5*a(2*c,0,d,g)+f:0.5*b(2*c-g,
0,d,g)+0.5*d+f}}})();
(function(a){function b(a){return a in y?y[a]:a}function c(a,c,b){"fill"!==a&&"stroke"!==a||"none"!==c?"fillRule"===a?c="evenodd"===c?"destination-over":c:"strokeDashArray"===a?c=c.replace(/,/g," ").split(/\s+/):"transformMatrix"===a&&(c=b&&b.transformMatrix?u(b.transformMatrix,l.parseTransformAttribute(c)):l.parseTransformAttribute(c)):c="";b=(a="[object Array]"===Object.prototype.toString.call(c))?c.map(parseFloat):parseFloat(c);return!a&&isNaN(b)?c:b}function f(a){for(var c in x)if(a[c]&&"undefined"!==
typeof a[x[c]]){var b=new l.Color(a[c]);a[c]=b.setAlpha(q(b.getAlpha()*a[x[c]],2)).toRgba();delete a[x[c]]}return a}function d(a,c){var b=a.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(b){var d=b[1],e=b[3],g=b[4],f=b[5],b=b[6];d&&(c.fontStyle=d);e&&(c.fontSize=isNaN(parseFloat(e))?e:parseFloat(e));g&&(c.fontSize=parseFloat(g));b&&(c.fontFamily=b);f&&(c.lineHeight="normal"===f?1:f)}}function g(a){for(var c=
a.length;c--;){var b=a[c].get("fill");/^url\(/.test(b)&&(b=b.slice(5,b.length-1),l.gradientDefs[b]&&a[c].set("fill",l.Gradient.fromElement(l.gradientDefs[b],a[c])))}}function e(a){a=a.getElementsByTagName("style");for(var c={},b,d=0,e=a.length;d<e;d++)b=a[0].textContent,b=b.replace(/\/\*[\s\S]*?\*\//g,""),b=b.match(/[^{]*\{[\s\S]*?\}/g),b=b.map(function(a){return a.trim()}),b.forEach(function(a){var b=a.match(/([\s\S]*?)\s*\{([^}]*)\}/);a=b[1];b=b[2].trim().replace(/;$/,"").split(/\s*;\s*/);c[a]||
(c[a]={});for(var d=0,e=b.length;d<e;d++){var g=b[d].split(/\s*:\s*/);c[a][g[0]]=g[1]}});return c}function h(a){var c=a.nodeName,b=a.getAttribute("class");a=a.getAttribute("id");var d={},e;for(e in l.cssRules)if(b&&RegExp("^\\."+b).test(e)||a&&RegExp("^#"+a).test(e)||RegExp("^"+c).test(e))for(var g in l.cssRules[e])d[g]=l.cssRules[e][g];return d}function k(a){var c=a.objects;a=a.options;c=c.map(function(a){return l[n(a.type)].fromObject(a)});return{objects:c,options:a}}var l=a.fabric||(a.fabric={}),
m=l.util.object.extend,n=l.util.string.capitalize,p=l.util.object.clone,q=l.util.toFixed,u=l.util.multiplyTransformMatrices;l.SHARED_ATTRIBUTES="transform fill fill-opacity fill-rule opacity stroke stroke-dasharray stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width".split(" ");var y={"fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight",cx:"left",x:"left",r:"radius","stroke-dasharray":"strokeDashArray",
"stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration",cy:"top",y:"top",transform:"transformMatrix"},x={stroke:"strokeOpacity",fill:"fillOpacity"};l.parseTransformAttribute=function(){function a(c,b){var d=b[0];c[0]=Math.cos(d);c[1]=Math.sin(d);c[2]=-Math.sin(d);c[3]=Math.cos(d)}function c(a,b){var d=2===b.length?b[1]:b[0];a[0]=b[0];a[3]=d}function b(a,
c){a[4]=c[0];2===c.length&&(a[5]=c[1])}var d=[1,0,0,1,0,0],e=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
g=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))",
"g");return function(f){var h=d.concat(),k=[];if(!f||f&&!e.test(f))return h;f.replace(g,function(e){var g=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(e).filter(function(a){return""!==
a&&null!=a});e=g[1];g=g.slice(2).map(parseFloat);switch(e){case "translate":b(h,g);break;case "rotate":a(h,g);break;case "scale":c(h,g);break;case "skewX":h[2]=g[0];break;case "skewY":h[1]=g[0];break;case "matrix":h=g}k.push(h.concat());h=d.concat()});for(f=k[0];1<k.length;)k.shift(),f=l.util.multiplyTransformMatrices(f,k[0]);return f}}();l.parseSVGDocument=function(){var a=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,c=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(b,d,g){if(b){var f=new Date,h=l.util.toArray(b.getElementsByTagName("*"));if(0===h.length){for(var h=b.selectNodes("//*[name(.)!='svg']"),k=[],m=0,n=h.length;m<n;m++)k[m]=h[m];h=k}if((h=h.filter(function(c){var b;if(b=a.test(c.tagName)){a:{for(b=/^(?:pattern|defs)$/;c&&(c=c.parentNode);)if(b.test(c.nodeName)){c=!0;break a}c=!1}b=!c}return b}))&&(!h||h.length)){var k=b.getAttribute("viewBox"),m=b.getAttribute("width"),n=b.getAttribute("height"),q=null,u=null;k&&(k=k.match(c))&&(parseInt(k[1],
10),parseInt(k[2],10),q=parseInt(k[3],10),u=parseInt(k[4],10));var q=m?parseFloat(m):q,u=n?parseFloat(n):u,y={width:q,height:u};l.gradientDefs=l.getGradientDefs(b);l.cssRules=e(b);l.parseElements(h,function(a){l.documentParsingTime=new Date-f;d&&d(a,y)},p(y),g)}}}}();var w={has:function(a,c){c(!1)},get:function(){},set:function(){}};m(l,{parseAttributes:function(a,d){if(a){var e,g={};a.parentNode&&/^g$/i.test(a.parentNode.nodeName)&&(g=l.parseAttributes(a.parentNode,d));var k=d.reduce(function(d,
f){if(e=a.getAttribute(f))f=b(f),e=c(f,e,g),d[f]=e;return d},{}),k=m(k,m(h(a),l.parseStyleAttribute(a)));return f(m(g,k))}},parseElements:function(a,c,b,d){function e(){0===--h&&(f=f.filter(function(a){return null!=a}),g(f),c(f))}for(var f=Array(a.length),h=a.length,k=0,m,p=a.length;k<p;k++){m=a[k];var q=l[n(m.tagName)];if(q&&q.fromElement)try{if(q.async)q.fromElement(m,function(a,c){return function(b){d&&d(c,b);f.splice(a,0,b);e()}}(k,m),b);else{var u=q.fromElement(m,b);d&&d(m,u);f.splice(k,0,u);
e()}}catch(y){l.log(y)}else e()}},parseStyleAttribute:function(a){var e={};a=a.getAttribute("style");var g,f;if(!a)return e;if("string"===typeof a)a.replace(/;$/,"").split(";").forEach(function(a){a=a.split(":");g=b(a[0].trim().toLowerCase());f=c(g,a[1].trim());"font"===g?d(f,e):e[g]=f});else for(var h in a)"undefined"!==typeof a[h]&&(g=b(h.toLowerCase()),f=c(g,a[h]),"font"===g?d(f,e):e[g]=f);return e},parsePointsAttribute:function(a){if(!a)return null;a=a.trim();var c=-1<a.indexOf(",");a=a.split(/\s+/);
var b=[],d;if(c)for(c=0,d=a.length;c<d;c++){var e=a[c].split(",");b.push({x:parseFloat(e[0]),y:parseFloat(e[1])})}else for(c=0,d=a.length;c<d;c+=2)b.push({x:parseFloat(a[c]),y:parseFloat(a[c+1])});return b},getCSSRules:e,loadSVGFromURL:function(a,c,b){function d(e){var g=e.responseXML;!g.documentElement&&(l.window.ActiveXObject&&e.responseText)&&(g=new ActiveXObject("Microsoft.XMLDOM"),g.async="false",g.loadXML(e.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));g.documentElement&&l.parseSVGDocument(g.documentElement,
function(b,d){w.set(a,{objects:l.util.array.invoke(b,"toObject"),options:d});c(b,d)},b)}a=a.replace(/^\n\s*/,"").trim();w.has(a,function(b){b?w.get(a,function(a){a=k(a);c(a.objects,a.options)}):new l.util.request(a,{method:"get",onComplete:d})})},loadSVGFromString:function(a,c,b){a=a.trim();var d;if("undefined"!==typeof DOMParser){var e=new DOMParser;e&&e.parseFromString&&(d=e.parseFromString(a,"text/xml"))}else l.window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(a.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,
"")));l.parseSVGDocument(d.documentElement,function(a,b){c(a,b)},b)},createSVGFontFacesMarkup:function(a){for(var c="",b=0,d=a.length;b<d;b++)"text"===a[b].type&&a[b].path&&(c+=["@font-face {font-family: ",a[b].fontFamily,"; src: url('",a[b].path,"')}"].join(""));c&&(c=['<style type="text/css"><![CDATA[',c,"]]\x3e</style>"].join(""));return c},createSVGRefElementsMarkup:function(a){var c="";a.backgroundColor&&a.backgroundColor.source&&(c=['<pattern x="0" y="0" id="backgroundColorPattern" width="',
a.backgroundColor.source.width,'" height="',a.backgroundColor.source.height,'" patternUnits="userSpaceOnUse"><image x="0" y="0" width="',a.backgroundColor.source.width,'" height="',a.backgroundColor.source.height,'" xlink:href="',a.backgroundColor.source.src,'"></image></pattern>'].join(""));return c},getGradientDefs:function(a){var c=a.getElementsByTagName("linearGradient");a=a.getElementsByTagName("radialGradient");var b,d,e={};for(d=c.length;d--;)b=c[d],e[b.getAttribute("id")]=b;for(d=a.length;d--;)b=
a[d],e[b.getAttribute("id")]=b;return e}})})("undefined"!==typeof exports?exports:this);
(function(a){function b(a,b){this.x=a;this.y=b}a=a.fabric||(a.fabric={});a.Point?a.warn("fabric.Point is already defined"):(a.Point=b,b.prototype={constructor:b,add:function(a){return new b(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y;return this},scalarAdd:function(a){return new b(this.x+a,this.y+a)},scalarAddEquals:function(a){this.x+=a;this.y+=a;return this},subtract:function(a){return new b(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y;return this},
scalarSubtract:function(a){return new b(this.x-a,this.y-a)},scalarSubtractEquals:function(a){this.x-=a;this.y-=a;return this},multiply:function(a){return new b(this.x*a,this.y*a)},multiplyEquals:function(a){this.x*=a;this.y*=a;return this},divide:function(a){return new b(this.x/a,this.y/a)},divideEquals:function(a){this.x/=a;this.y/=a;return this},eq:function(a){return this.x===a.x&&this.y===a.y},lt:function(a){return this.x<a.x&&this.y<a.y},lte:function(a){return this.x<=a.x&&this.y<=a.y},gt:function(a){return this.x>
a.x&&this.y>a.y},gte:function(a){return this.x>=a.x&&this.y>=a.y},lerp:function(a,f){return new b(this.x+(a.x-this.x)*f,this.y+(a.y-this.y)*f)},distanceFrom:function(a){var b=this.x-a.x;a=this.y-a.y;return Math.sqrt(b*b+a*a)},midPointFrom:function(a){return new b(this.x+(a.x-this.x)/2,this.y+(a.y-this.y)/2)},min:function(a){return new b(Math.min(this.x,a.x),Math.min(this.y,a.y))},max:function(a){return new b(Math.max(this.x,a.x),Math.max(this.y,a.y))},toString:function(){return this.x+","+this.y},
setXY:function(a,b){this.x=a;this.y=b},setFromPoint:function(a){this.x=a.x;this.y=a.y},swap:function(a){var b=this.x,d=this.y;this.x=a.x;this.y=a.y;a.x=b;a.y=d}})})("undefined"!==typeof exports?exports:this);
(function(a){function b(a){this.status=a;this.points=[]}var c=a.fabric||(a.fabric={});c.Intersection?c.warn("fabric.Intersection is already defined"):(c.Intersection=b,c.Intersection.prototype={appendPoint:function(a){this.points.push(a)},appendPoints:function(a){this.points=this.points.concat(a)}},c.Intersection.intersectLineLine=function(a,d,g,e){var h,k=(e.x-g.x)*(a.y-g.y)-(e.y-g.y)*(a.x-g.x);h=(d.x-a.x)*(a.y-g.y)-(d.y-a.y)*(a.x-g.x);g=(e.y-g.y)*(d.x-a.x)-(e.x-g.x)*(d.y-a.y);0!==g?(k/=g,h/=g,0<=
k&&1>=k&&0<=h&&1>=h?(h=new b("Intersection"),h.points.push(new c.Point(a.x+k*(d.x-a.x),a.y+k*(d.y-a.y)))):h=new b):h=0===k||0===h?new b("Coincident"):new b("Parallel");return h},c.Intersection.intersectLinePolygon=function(a,c,g){for(var e=new b,h=g.length,k=0;k<h;k++){var l=b.intersectLineLine(a,c,g[k],g[(k+1)%h]);e.appendPoints(l.points)}0<e.points.length&&(e.status="Intersection");return e},c.Intersection.intersectPolygonPolygon=function(a,c){for(var g=new b,e=a.length,h=0;h<e;h++){var k=b.intersectLinePolygon(a[h],
a[(h+1)%e],c);g.appendPoints(k.points)}0<g.points.length&&(g.status="Intersection");return g},c.Intersection.intersectPolygonRectangle=function(a,d,g){var e=d.min(g),h=d.max(g);g=new c.Point(h.x,e.y);var k=new c.Point(e.x,h.y);d=b.intersectLinePolygon(e,g,a);g=b.intersectLinePolygon(g,h,a);h=b.intersectLinePolygon(h,k,a);a=b.intersectLinePolygon(k,e,a);e=new b;e.appendPoints(d.points);e.appendPoints(g.points);e.appendPoints(h.points);e.appendPoints(a.points);0<e.points.length&&(e.status="Intersection");
return e})})("undefined"!==typeof exports?exports:this);
(function(a){function b(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function c(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a}var f=a.fabric||(a.fabric={});f.Color?f.warn("fabric.Color is already defined."):(f.Color=b,f.Color.prototype={_tryParsingColor:function(a){var c;a in b.colorNameMap&&(a=b.colorNameMap[a]);(c=b.sourceFromHex(a))||(c=b.sourceFromRgb(a));c||(c=b.sourceFromHsl(a));c&&this.setSource(c)},_rgbToHsl:function(a,c,b){a/=255;c/=
255;b/=255;var h,k,l,m=f.util.array.max([a,c,b]);k=f.util.array.min([a,c,b]);l=(m+k)/2;if(m===k)h=k=0;else{var n=m-k;k=0.5<l?n/(2-m-k):n/(m+k);switch(m){case a:h=(c-b)/n+(c<b?6:0);break;case c:h=(b-a)/n+2;break;case b:h=(a-c)/n+4}h/=6}return[Math.round(360*h),Math.round(100*k),Math.round(100*l)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+
a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),a=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var a=this.getSource(),c=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+c[0]+","+c[1]+"%,"+c[2]+"%,"+a[3]+")"},toHex:function(){var a=this.getSource(),c=a[0].toString(16),c=1===c.length?"0"+c:c,b=a[1].toString(16),b=1===b.length?"0"+b:b,a=a[2].toString(16),a=1===a.length?"0"+a:a;return c.toUpperCase()+b.toUpperCase()+a.toUpperCase()},
getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var c=this.getSource();c[3]=a;this.setSource(c);return this},toGrayscale:function(){var a=this.getSource(),c=parseInt((0.3*a[0]+0.59*a[1]+0.11*a[2]).toFixed(0),10);this.setSource([c,c,c,a[3]]);return this},toBlackWhite:function(a){var c=this.getSource(),b=(0.3*c[0]+0.59*c[1]+0.11*c[2]).toFixed(0),c=c[3],b=Number(b)<Number(a||127)?0:255;this.setSource([b,b,b,c]);return this},overlayWith:function(a){a instanceof b||(a=new b(a));var c=
[],e=this.getAlpha(),f=this.getSource();a=a.getSource();for(var k=0;3>k;k++)c.push(Math.round(0.5*f[k]+0.5*a[k]));c[3]=e;this.setSource(c);return this}},f.Color.reRGBa=/^rgba?\(\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*,\s*(\d{1,3}\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,f.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,f.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,f.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",
gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},f.Color.fromRgb=function(a){return b.fromSource(b.sourceFromRgb(a))},f.Color.sourceFromRgb=function(a){if(a=a.match(b.reRGBa)){var c=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),e=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),f=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*
(/%$/.test(a[3])?255:1);return[parseInt(c,10),parseInt(e,10),parseInt(f,10),a[4]?parseFloat(a[4]):1]}},f.Color.fromRgba=b.fromRgb,f.Color.fromHsl=function(a){return b.fromSource(b.sourceFromHsl(a))},f.Color.sourceFromHsl=function(a){if(a=a.match(b.reHSLa)){var g=(parseFloat(a[1])%360+360)%360/360,e=parseFloat(a[2])/(/%$/.test(a[2])?100:1),f=parseFloat(a[3])/(/%$/.test(a[3])?100:1);if(0===e)f=e=g=f;else var k=0.5>=f?f*(e+1):f+e-f*e,l=2*f-k,f=c(l,k,g+1/3),e=c(l,k,g),g=c(l,k,g-1/3);return[Math.round(255*
f),Math.round(255*e),Math.round(255*g),a[4]?parseFloat(a[4]):1]}},f.Color.fromHsla=b.fromHsl,f.Color.fromHex=function(a){return b.fromSource(b.sourceFromHex(a))},f.Color.sourceFromHex=function(a){if(a.match(b.reHex)){var c=a.slice(a.indexOf("#")+1),e=3===c.length;a=e?c.charAt(0)+c.charAt(0):c.substring(0,2);var f=e?c.charAt(1)+c.charAt(1):c.substring(2,4),c=e?c.charAt(2)+c.charAt(2):c.substring(4,6);return[parseInt(a,16),parseInt(f,16),parseInt(c,16),1]}},f.Color.fromSource=function(a){var c=new b;
c.setSource(a);return c})})("undefined"!==typeof exports?exports:this);
(function(){function a(a){var c=a.getAttribute("style"),b=a.getAttribute("offset"),e,h,b=parseFloat(b)/(/%$/.test(b)?100:1);if(c){c=c.split(/\s*;\s*/);""===c[c.length-1]&&c.pop();for(var k=c.length;k--;){var l=c[k].split(/\s*:\s*/),m=l[0].trim(),l=l[1].trim();"stop-color"===m?e=l:"stop-opacity"===m&&(h=l)}}e||(e=a.getAttribute("stop-color")||"rgb(0,0,0)");h||(h=a.getAttribute("stop-opacity"));e=(new fabric.Color(e)).toRgb();return{offset:b,color:e,opacity:isNaN(parseFloat(h))?1:parseFloat(h)}}function b(a,
c){for(var b in c){if("string"===typeof c[b]&&/^\d+%$/.test(c[b])){var e=parseFloat(c[b],10);if("x1"===b||"x2"===b||"r2"===b)c[b]=fabric.util.toFixed(a.width*e/100,2);else if("y1"===b||"y2"===b)c[b]=fabric.util.toFixed(a.height*e/100,2)}if("x1"===b||"x2"===b)c[b]-=fabric.util.toFixed(a.width/2,2);else if("y1"===b||"y2"===b)c[b]-=fabric.util.toFixed(a.height/2,2)}}function c(a,c){for(var b in c){if("x1"===b||"x2"===b)c[b]+=fabric.util.toFixed(a.width/2,2);else if("y1"===b||"y2"===b)c[b]+=fabric.util.toFixed(a.height/
2,2);if("x1"===b||"x2"===b||"r2"===b)c[b]=fabric.util.toFixed(100*(c[b]/a.width),2)+"%";else if("y1"===b||"y2"===b)c[b]=fabric.util.toFixed(100*(c[b]/a.height),2)+"%"}}fabric.Gradient=fabric.util.createClass({initialize:function(a){a||(a={});var c={};this.id=fabric.Object.__uid++;this.type=a.type||"linear";c={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0};"radial"===this.type&&(c.r1=a.coords.r1||0,c.r2=a.coords.r2||0);this.coords=c;this.gradientUnits=a.gradientUnits||"objectBoundingBox";
this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var c in a){var b=new fabric.Color(a[c]);this.colorStops.push({offset:c,color:b.toRgb(),opacity:b.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(a,b){var g=fabric.util.object.clone(this.coords),e;this.colorStops.sort(function(a,c){return a.offset-c.offset});b&&"userSpaceOnUse"===this.gradientUnits?(g.x1+=a.width/2,g.y1+=
a.height/2,g.x2+=a.width/2,g.y2+=a.height/2):"objectBoundingBox"===this.gradientUnits&&c(a,g);"linear"===this.type?e=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',g.x1,'" y1="',g.y1,'" x2="',g.x2,'" y2="',g.y2,'">']:"radial"===this.type&&(e=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',g.x2,'" cy="',g.y2,'" r="',g.r2,'" fx="',g.x1,'" fy="',g.y1,'">']);for(g=0;g<this.colorStops.length;g++)e.push("<stop ",'offset="',
100*this.colorStops[g].offset+"%",'" style="stop-color:',this.colorStops[g].color,this.colorStops[g].opacity?";stop-opacity: "+this.colorStops[g].opacity:";",'"/>');e.push("linear"===this.type?"</linearGradient>":"</radialGradient>");return e.join("")},toLive:function(a){var c;if(this.type){"linear"===this.type?c=a.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):"radial"===this.type&&(c=a.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,
this.coords.y2,this.coords.r2));a=0;for(var b=this.colorStops.length;a<b;a++){var e=this.colorStops[a].color,h=this.colorStops[a].opacity,k=this.colorStops[a].offset;"undefined"!==typeof h&&(e=(new fabric.Color(e)).setAlpha(h).toRgba());c.addColorStop(parseFloat(k),e)}return c}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(c,d){var g=c.getElementsByTagName("stop"),e="linearGradient"===c.nodeName?"linear":"radial",h=c.getAttribute("gradientUnits")||"objectBoundingBox",k=[],l={};
"linear"===e?l={x1:c.getAttribute("x1")||0,y1:c.getAttribute("y1")||0,x2:c.getAttribute("x2")||"100%",y2:c.getAttribute("y2")||0}:"radial"===e&&(l={x1:c.getAttribute("fx")||c.getAttribute("cx")||"50%",y1:c.getAttribute("fy")||c.getAttribute("cy")||"50%",r1:0,x2:c.getAttribute("cx")||"50%",y2:c.getAttribute("cy")||"50%",r2:c.getAttribute("r")||"50%"});for(var m=g.length;m--;)k.push(a(g[m]));b(d,l);return new fabric.Gradient({type:e,coords:l,gradientUnits:h,colorStops:k})},forObject:function(a,c){c||
(c={});b(a,c);return new fabric.Gradient(c)}})})();
fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){a||(a={});this.id=fabric.Object.__uid++;if(a.source)if("string"===typeof a.source)if("undefined"!==typeof fabric.util.getFunctionBody(a.source))this.source=new Function(fabric.util.getFunctionBody(a.source));else{var b=this;this.source=fabric.util.createImage();fabric.util.loadImage(a.source,function(a){b.source=a})}else this.source=a.source;a.repeat&&(this.repeat=a.repeat);a.offsetX&&(this.offsetX=
a.offsetX);a.offsetY&&(this.offsetY=a.offsetY)},toObject:function(){var a;"function"===typeof this.source?a=String(this.source):"string"===typeof this.source.src&&(a=this.source.src);return{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(a){var b="function"===typeof this.source?this.source():this.source,c=b.width/a.getWidth();a=b.height/a.getHeight();var f="";b.src?f=b.src:b.toDataURL&&(f=b.toDataURL());return'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+
'" y="'+this.offsetY+'" width="'+c+'" height="'+a+'"><image x="0" y="0" width="'+c+'" height="'+a+'" xlink:href="'+f+'"></image></pattern>'},toLive:function(a){var b="function"===typeof this.source?this.source():this.source;return a.createPattern(b,this.repeat)}});
fabric.Shadow=fabric.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,initialize:function(a){for(var b in a)this[b]=a[b]},toSVG:function(){},toObject:function(){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}});
(function(){if(fabric.StaticCanvas)fabric.warn("fabric.StaticCanvas is already defined.");else{var a=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,f=fabric.util.removeListener,d=Error("Could not initialize `canvas` element");fabric.StaticCanvas=function(a,c){c||(c={});this._initStatic(a,c);fabric.StaticCanvas.activeInstance=this};a(fabric.StaticCanvas.prototype,fabric.Observable);a(fabric.StaticCanvas.prototype,fabric.Collection);a(fabric.StaticCanvas.prototype,
fabric.DataURLExporter);a(fabric.StaticCanvas.prototype,{backgroundColor:"",backgroundImage:"",backgroundImageOpacity:1,backgroundImageStretch:!0,overlayImage:"",overlayImageLeft:0,overlayImageTop:0,includeDefaultValues:!0,stateful:!0,renderOnAddition:!0,clipTo:null,controlsAboveOverlay:!1,onBeforeScaleRotate:function(){},_initStatic:function(a,c){this._objects=[];this._createLowerCanvas(a);this._initOptions(c);c.overlayImage&&this.setOverlayImage(c.overlayImage,this.renderAll.bind(this));c.backgroundImage&&
this.setBackgroundImage(c.backgroundImage,this.renderAll.bind(this));c.backgroundColor&&this.setBackgroundColor(c.backgroundColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){this._offset=b(this.lowerCanvasEl);return this},setOverlayImage:function(a,c,b){fabric.util.loadImage(a,function(a){this.overlayImage=a;b&&"overlayImageLeft"in b&&(this.overlayImageLeft=b.overlayImageLeft);b&&"overlayImageTop"in b&&(this.overlayImageTop=b.overlayImageTop);c&&c()},this);return this},setBackgroundImage:function(a,
c,b){fabric.util.loadImage(a,function(a){this.backgroundImage=a;b&&"backgroundImageOpacity"in b&&(this.backgroundImageOpacity=b.backgroundImageOpacity);b&&"backgroundImageStretch"in b&&(this.backgroundImageStretch=b.backgroundImageStretch);c&&c()},this);return this},setBackgroundColor:function(a,c){if(a.source){var b=this;fabric.util.loadImage(a.source,function(d){b.backgroundColor=new fabric.Pattern({source:d,repeat:a.repeat});c&&c()})}else this.backgroundColor=a,c&&c();return this},_createCanvasElement:function(){var a=
fabric.document.createElement("canvas");a.style||(a.style={});if(!a)throw d;this._initCanvasElement(a);return a},_initCanvasElement:function(a){fabric.util.createCanvasElement(a);if("undefined"===typeof a.getContext)throw d;},_initOptions:function(a){for(var c in a)this[c]=a[c];this.width=parseInt(this.lowerCanvasEl.width,10)||0;this.height=parseInt(this.lowerCanvasEl.height,10)||0;this.lowerCanvasEl.style&&(this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+
"px")},_createLowerCanvas:function(a){this.lowerCanvasEl=fabric.util.getById(a)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a){return this._setDimension("width",a)},setHeight:function(a){return this._setDimension("height",
a)},setDimensions:function(a){for(var c in a)this._setDimension(c,a[c]);return this},_setDimension:function(a,c){this.lowerCanvasEl[a]=c;this.lowerCanvasEl.style[a]=c+"px";this.upperCanvasEl&&(this.upperCanvasEl[a]=c,this.upperCanvasEl.style[a]=c+"px");this.cacheCanvasEl&&(this.cacheCanvasEl[a]=c);this.wrapperEl&&(this.wrapperEl.style[a]=c+"px");this[a]=c;this.calcOffset();this.renderAll();return this},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},
_draw:function(a,c){if(c)if(this.controlsAboveOverlay){var b=c.hasBorders,d=c.hasControls;c.hasBorders=c.hasControls=!1;c.render(a);c.hasBorders=b;c.hasControls=d}else c.render(a)},_onObjectAdded:function(a){this.stateful&&a.setupState();a.setCoords();a.canvas=this;this.fire("object:added",{target:a});a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a});a.fire("removed")},getObjects:function(){return this._objects},clearContext:function(a){a.clearRect(0,0,this.width,
this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;this.discardActiveGroup&&this.discardActiveGroup();this.discardActiveObject&&this.discardActiveObject();this.clearContext(this.contextContainer);this.contextTop&&this.clearContext(this.contextTop);this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(a){var c=this[!0===a&&this.interactive?"contextTop":"contextContainer"];this.contextTop&&(this.selection&&!this._groupSelector)&&
this.clearContext(this.contextTop);a||this.clearContext(c);this.fire("before:render");this.clipTo&&fabric.util.clipContext(this,c);this.backgroundColor&&(c.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(c):this.backgroundColor,c.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));"object"===typeof this.backgroundImage&&this._drawBackroundImage(c);var b=this.getActiveGroup();a=0;for(var d=this._objects.length;a<d;++a)(!b||b&&this._objects[a]&&
!b.contains(this._objects[a]))&&this._draw(c,this._objects[a]);if(b){var f=[];this.forEachObject(function(a){b.contains(a)&&f.push(a)});b._set("objects",f);this._draw(c,b)}this.clipTo&&c.restore();this.overlayImage&&c.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop);this.controlsAboveOverlay&&this.interactive&&this.drawControls(c);this.fire("after:render");return this},_drawBackroundImage:function(a){a.save();a.globalAlpha=this.backgroundImageOpacity;this.backgroundImageStretch?
a.drawImage(this.backgroundImage,0,0,this.width,this.height):a.drawImage(this.backgroundImage,0,0);a.restore()},renderTop:function(){var a=this.contextTop||this.contextContainer;this.clearContext(a);this.selection&&this._groupSelector&&this._drawSelection();var c=this.getActiveGroup();c&&c.render(a);this.overlayImage&&a.drawImage(this.overlayImage,this.overlayImageLeft,this.overlayImageTop);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/
2}},centerObjectH:function(a){a.set("left",this.getCenter().left);this.renderAll();return this},centerObjectV:function(a){a.set("top",this.getCenter().top);this.renderAll();return this},centerObject:function(a){return this.centerObjectH(a).centerObjectV(a)},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,c){var b=this.getActiveGroup();
b&&this.discardActiveGroup();var d={objects:this.getObjects().map(function(b){var d;this.includeDefaultValues||(d=b.includeDefaultValues,b.includeDefaultValues=!1);var f=b[a](c);this.includeDefaultValues||(b.includeDefaultValues=d);return f},this),background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};this.backgroundImage&&(d.backgroundImage=this.backgroundImage.src,d.backgroundImageOpacity=this.backgroundImageOpacity,d.backgroundImageStretch=
this.backgroundImageStretch);this.overlayImage&&(d.overlayImage=this.overlayImage.src,d.overlayImageLeft=this.overlayImageLeft,d.overlayImageTop=this.overlayImageTop);fabric.util.populateWithProperties(this,d,c);b&&(this.setActiveGroup(new fabric.Group(b.getObjects())),b.forEachObject(function(a){a.set("active",!0)}));return d},toSVG:function(a){a||(a={});var c=[];a.suppressPreamble||c.push('<?xml version="1.0" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n');
c.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',a.viewBox?a.viewBox.width:this.width,'" ','height="',a.viewBox?a.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.source?'style="background-color: '+this.backgroundColor+'" ':null,a.viewBox?'viewBox="'+a.viewBox.x+" "+a.viewBox.y+" "+a.viewBox.width+" "+a.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,
"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>");this.backgroundColor&&this.backgroundColor.source&&c.push('<rect x="0" y="0" ','width="',"repeat-y"===this.backgroundColor.repeat||"no-repeat"===this.backgroundColor.repeat?this.backgroundColor.source.width:this.width,'" height="',"repeat-x"===this.backgroundColor.repeat||"no-repeat"===this.backgroundColor.repeat?this.backgroundColor.source.height:this.height,'" fill="url(#backgroundColorPattern)"',
"></rect>");this.backgroundImage&&c.push('<image x="0" y="0" ','width="',this.backgroundImageStretch?this.width:this.backgroundImage.width,'" height="',this.backgroundImageStretch?this.height:this.backgroundImage.height,'" preserveAspectRatio="',this.backgroundImageStretch?"none":"defer",'" xlink:href="',this.backgroundImage.src,'" style="opacity:',this.backgroundImageOpacity,'"></image>');this.overlayImage&&c.push('<image x="',this.overlayImageLeft,'" y="',this.overlayImageTop,'" width="',this.overlayImage.width,
'" height="',this.overlayImage.height,'" xlink:href="',this.overlayImage.src,'"></image>');(a=this.getActiveGroup())&&this.discardActiveGroup();for(var b=0,d=this.getObjects(),f=d.length;b<f;b++)c.push(d[b].toSVG());a&&(this.setActiveGroup(new fabric.Group(a.getObjects())),a.forEachObject(function(a){a.set("active",!0)}));c.push("</svg>");return c.join("")},remove:function(a){this.getActiveObject()===a&&(this.fire("before:selection:cleared",{target:a}),this.discardActiveObject(),this.fire("selection:cleared"));
return fabric.Collection.remove.call(this,a)},sendToBack:function(a){c(this._objects,a);this._objects.unshift(a);return this.renderAll&&this.renderAll()},bringToFront:function(a){c(this._objects,a);this._objects.push(a);return this.renderAll&&this.renderAll()},sendBackwards:function(a,b){var d=this._objects.indexOf(a);if(0!==d){var f;if(b)for(f=d,d-=1;0<=d;--d){if(a.intersectsWithObject(this._objects[d])||a.isContainedWithinObject(this._objects[d])||this._objects[d].isContainedWithinObject(a)){f=
d;break}}else f=d-1;c(this._objects,a);this._objects.splice(f,0,a);this.renderAll&&this.renderAll()}return this},bringForward:function(a,b){var d=this._objects.indexOf(a);if(d!==this._objects.length-1){var f;if(b)for(f=d,d+=1;d<this._objects.length;++d){if(a.intersectsWithObject(this._objects[d])||a.isContainedWithinObject(this._objects[d])||this._objects[d].isContainedWithinObject(a)){f=d;break}}else f=d+1;c(this._objects,a);this._objects.splice(f,0,a);this.renderAll&&this.renderAll()}return this},
moveTo:function(a,b){c(this._objects,a);this._objects.splice(b,0,a);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();if(!this.interactive)return this;fabric.isTouchSupported?(f(this.upperCanvasEl,"touchstart",this._onMouseDown),f(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!==typeof Event&&"remove"in Event&&Event.remove(this.upperCanvasEl,"gesture",this._onGesture)):(f(this.upperCanvasEl,"mousedown",this._onMouseDown),f(this.upperCanvasEl,"mousemove",this._onMouseMove),
f(fabric.window,"resize",this._onResize));return this}});fabric.StaticCanvas.prototype.toString=function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};a(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(a){var c=a.getContext("2d");a=c.getImageData(0,0,a.width,a.height);var b=a.data,d=a.width,f=a.height,m,n,p,q;for(p=0;p<d;p++)for(q=0;q<f;q++)m=4*p*f+4*q,n=(b[m]+b[m+1]+b[m+2])/3,b[m]=n,b[m+1]=n,b[m+2]=n;c.putImageData(a,
0,0)},supports:function(a){var c=fabric.util.createCanvasElement();if(!c||!c.getContext)return null;var b=c.getContext("2d");if(!b)return null;switch(a){case "getImageData":return"undefined"!==typeof b.getImageData;case "setLineDash":return"undefined"!==typeof b.setLineDash;case "toDataURL":return"undefined"!==typeof c.toDataURL;case "toDataURLWithQuality":try{return c.toDataURL("image/jpeg",0),!0}catch(d){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}})();
fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadowBlur:0,shadowColor:"",shadowOffsetX:0,shadowOffsetY:0,strokeLineCap:"round",strokeLineJoin:"round",setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color;a.lineWidth=this.width;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin},setShadowStyles:function(){var a=this.canvas.contextTop;a.shadowBlur=this.shadowBlur;a.shadowColor=this.shadowColor||this.color;a.shadowOffsetX=this.shadowOffsetX;
a.shadowOffsetY=this.shadowOffsetY},removeShadowStyles:function(){var a=this.canvas.contextTop;a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}});
(function(){var a=fabric.util.array.min,b=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(a){this.canvas=a;this._points=[]},onMouseDown:function(a){this._prepareForDrawing(a);this._captureDrawingPath(a)},onMouseMove:function(a){this._captureDrawingPath(a);this.canvas.clearContext(this.canvas.contextTop);this._render(this.canvas.contextTop)},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(a){a=new fabric.Point(a.x,
a.y);this._reset();this._addPoint(a);this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(a){this._points.push(a)},_reset:function(){this._points.length=0;this.setBrushStyles();this.setShadowStyles()},_captureDrawingPath:function(a){a=new fabric.Point(a.x,a.y);this._addPoint(a)},_render:function(){var a=this.canvas.contextTop;a.beginPath();var b=this._points[0],d=this._points[1];a.moveTo(b.x,b.y);for(var g=1,e=this._points.length;g<e;g++)d=b.midPointFrom(d),a.quadraticCurveTo(b.x,b.y,d.x,d.y),
b=this._points[g],d=this._points[g+1];a.lineTo(b.x,b.y);a.stroke()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minx,this.box.maxx,this.box.miny,this.box.maxy)},getPathBoundingBox:function(c){for(var f=[],d=[],g=c[0],e=c[1],h=g,k=1,l=c.length;k<l;k++){var m=g.midPointFrom(e);f.push(h.x);f.push(m.x);d.push(h.y);d.push(m.y);g=c[k];e=c[k+1];h=m}f.push(g.x);d.push(g.y);return{minx:a(f),miny:a(d),maxx:b(f),maxy:b(d)}},
convertPointsToSVGPath:function(a,b,d,g){d=[];var e=new fabric.Point(a[0].x-b,a[0].y-g),h=new fabric.Point(a[1].x-b,a[1].y-g);d.push("M ",a[0].x-b," ",a[0].y-g," ");for(var k=1,l=a.length;k<l;k++){var m=e.midPointFrom(h);d.push("Q ",e.x," ",e.y," ",m.x," ",m.y," ");e=new fabric.Point(a[k].x-b,a[k].y-g);k+1<a.length&&(h=new fabric.Point(a[k+1].x-b,a[k+1].y-g))}d.push("L ",e.x," ",e.y," ");return d},createPath:function(a){a=new fabric.Path(a);a.fill=null;a.stroke=this.color;a.strokeWidth=this.width;
a.strokeLineCap=this.strokeLineCap;a.strokeLineJoin=this.strokeLineJoin;a.setShadow({color:this.shadowColor||this.color,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY,affectStroke:!0});return a},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath();var a=this._getSVGPathData().join("");if("M 0 0 Q 0 0 0 0 L 0 0"===a)this.canvas.renderAll();else{var b=this.box.minx+(this.box.maxx-this.box.minx)/2,d=this.box.miny+(this.box.maxy-this.box.miny)/2;this.canvas.contextTop.arc(b,
d,3,0,2*Math.PI,!1);a=this.createPath(a);a.set({left:b,top:d});this.canvas.add(a);a.setCoords();this.canvas.clearContext(this.canvas.contextTop);this.removeShadowStyles();this.canvas.renderAll();this.canvas.fire("path:created",{path:a})}}})})();
fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a;this.points=[]},onMouseDown:function(){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this.setShadowStyles()},onMouseMove:function(a){a=this.addPoint(a);var b=this.canvas.contextTop;b.fillStyle=a.fill;b.beginPath();b.arc(a.x,a.y,a.radius,0,2*Math.PI,!1);b.closePath();b.fill()},onMouseUp:function(){var a=this.canvas.renderOnAddition;this.canvas.renderOnAddition=!1;for(var b=
0,c=this.points.length;b<c;b++){var f=this.points[b],f=new fabric.Circle({radius:f.radius,left:f.x,top:f.y,fill:f.fill,shadow:{color:this.shadowColor||this.color,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY}});this.canvas.add(f);this.canvas.fire("path:created",{path:f})}this.canvas.clearContext(this.canvas.contextTop);this.removeShadowStyles();this.canvas.renderOnAddition=a;this.canvas.renderAll()},addPoint:function(a){a=new fabric.Point(a.x,a.y);var b=fabric.util.getRandomInt(Math.max(0,
this.width-20),this.width+20)/2,c=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();a.radius=b;a.fill=c;this.points.push(a);return a}});
fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,initialize:function(a){this.canvas=a;this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this.setShadowStyles();this.addSprayChunk(a);this.render()},onMouseMove:function(a){this.addSprayChunk(a);this.render()},onMouseUp:function(){var a=this.canvas.renderOnAddition;this.canvas.renderOnAddition=!1;for(var b=
0,c=this.sprayChunks.length;b<c;b++)for(var f=this.sprayChunks[b],d=0,g=f.length;d<g;d++){var e=new fabric.Rect({width:f[d].width,height:f[d].width,left:f[d].x+1,top:f[d].y+1,fill:this.color,shadow:{color:this.shadowColor||this.color,blur:this.shadowBlur,offsetX:this.shadowOffsetX,offsetY:this.shadowOffsetY}});this.canvas.add(e);this.canvas.fire("path:created",{path:e})}this.canvas.clearContext(this.canvas.contextTop);this.removeShadowStyles();this.canvas.renderOnAddition=a;this.canvas.renderAll()},
render:function(){var a=this.canvas.contextTop;a.fillStyle=this.color;a.save();for(var b=0,c=this.sprayChunkPoints.length;b<c;b++){var f=this.sprayChunkPoints[b];"undefined"!==typeof f.opacity&&(a.globalAlpha=f.opacity);a.fillRect(f.x,f.y,f.width,f.width)}a.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];for(var b,c,f,d=this.width/2,g=0;g<this.density;g++)b=fabric.util.getRandomInt(a.x-d,a.x+d),c=fabric.util.getRandomInt(a.y-d,a.y+d),f=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,
this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,b={x:b,y:c,width:f},this.randomOpacity&&(b.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(b);this.sprayChunks.push(this.sprayChunkPoints)}});
fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var a=fabric.document.createElement("canvas"),b=a.getContext("2d");a.width=a.height=25;b.fillStyle=this.color;b.beginPath();b.arc(10,10,10,0,2*Math.PI,!1);b.closePath();b.fill();return a},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},setBrushStyles:function(){this.callSuper("setBrushStyles");
this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(a){a=this.callSuper("createPath",a);a.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return a}});
(function(){function a(){}var b=fabric.util.object.extend,c=fabric.util.getPointer,f=fabric.util.degreesToRadians,d=fabric.util.radiansToDegrees,g=Math.atan2,e=Math.abs,h=Math.min,k=Math.max;fabric.Canvas=function(a,c){c||(c={});this._initStatic(a,c);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this};a.prototype=fabric.StaticCanvas.prototype;fabric.Canvas.prototype=new a;fabric.Canvas.prototype.toString=fabric.StaticCanvas.prototype.toString;b(fabric.Canvas.prototype,
{uniScaleTransform:!1,centerTransform:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,_initInteractive:function(){this._groupSelector=this._currentTransform=null;this._initWrapperElement();
this._createUpperCanvas();this._initEvents();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(a){var c=this._currentTransform;c.target.set("scaleX",c.original.scaleX);c.target.set("scaleY",c.original.scaleY);c.target.set("left",c.original.left);c.target.set("top",c.original.top);a.altKey||this.centerTransform||c.target.centerTransform?("center"!==c.originX&&(c.mouseXSign="right"===c.originX?-1:1),"center"!==c.originY&&(c.mouseYSign=
"bottom"===c.originY?-1:1),c.originX="center",c.originY="center"):(c.originX=c.original.originX,c.originY=c.original.originY)},containsPoint:function(a,c){var b=this.getPointer(a),b=this._normalizePointer(c,b);return c.containsPoint(b)||c._findTargetCorner(a,this._offset)},_normalizePointer:function(a,c){var b=this.getActiveGroup(),d=c.x,e=c.y;b&&("group"!==a.type&&b.contains(a))&&(d-=b.left,e-=b.top);return{x:d,y:e}},isTargetTransparent:function(a,c,b){var d=this.contextCache,e=a.hasBorders,g=a.transparentCorners;
a.hasBorders=a.transparentCorners=!1;this._draw(d,a);a.hasBorders=e;a.transparentCorners=g;0<this.targetFindTolerance&&(c=c>this.targetFindTolerance?c-this.targetFindTolerance:0,b=b>this.targetFindTolerance?b-this.targetFindTolerance:0);a=!0;c=d.getImageData(c,b,2*this.targetFindTolerance||1,2*this.targetFindTolerance||1);b=3;for(e=c.data.length;b<e&&(a=0>=c.data[b],!1!==a);b+=4);this.clearContext(d);return a},_shouldClearSelection:function(a,c){var b=this.getActiveGroup();return!c||c&&b&&!b.contains(c)&&
b!==c&&!a.shiftKey||c&&!c.selectable},_setupCurrentTransform:function(a,b){if(b){var d="drag",e,g=c(a,b.canvas.upperCanvasEl);(e=b._findTargetCorner(a,this._offset))&&(d="ml"===e||"mr"===e?"scaleX":"mt"===e||"mb"===e?"scaleY":"mtr"===e?"rotate":"scale");var h="center",k="center";if("ml"===e||"tl"===e||"bl"===e)h="right";else if("mr"===e||"tr"===e||"br"===e)h="left";if("tl"===e||"mt"===e||"tr"===e)k="bottom";else if("bl"===e||"mb"===e||"br"===e)k="top";"mtr"===e&&(k=h="center");this._currentTransform=
{target:b,action:d,scaleX:b.scaleX,scaleY:b.scaleY,offsetX:g.x-b.left,offsetY:g.y-b.top,originX:h,originY:k,ex:g.x,ey:g.y,left:b.left,top:b.top,theta:f(b.angle),width:b.width*b.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:b.left,top:b.top,scaleX:b.scaleX,scaleY:b.scaleY,originX:h,originY:k};this._resetCurrentTransform(a)}},_shouldHandleGroupLogic:function(a,c){var b=this.getActiveObject();return a.shiftKey&&(this.getActiveGroup()||b&&b!==c)&&this.selection},_handleGroupLogic:function(a,
c){if(c===this.getActiveGroup()&&(c=this.findTarget(a,!0),!c||c.isType("group")))return;var b=this.getActiveGroup();b?(b.contains(c)?(b.removeWithUpdate(c),this._resetObjectTransform(b),c.set("active",!1),1===b.size()&&this.discardActiveGroup()):(b.addWithUpdate(c),this._resetObjectTransform(b)),this.fire("selection:created",{target:b,e:a}),b.set("active",!0)):(this._activeObject&&c!==this._activeObject&&(b=this.getObjects(),b=b.indexOf(this._activeObject)<b.indexOf(c),b=new fabric.Group(b?[c,this._activeObject]:
[this._activeObject,c]),this.setActiveGroup(b),b=this.getActiveGroup(),this.fire("selection:created",{target:b,e:a})),c.set("active",!0));b&&b.saveCoords()},_translateObject:function(a,c){var b=this._currentTransform.target;b.get("lockMovementX")||b.set("left",a-this._currentTransform.offsetX);b.get("lockMovementY")||b.set("top",c-this._currentTransform.offsetY)},_scaleObject:function(a,c,b){var d=this._currentTransform,g=this._offset,f=d.target,h=f.get("lockScalingX"),k=f.get("lockScalingY");if(!h||
!k){var l=f.translateToOriginPoint(f.getCenterPoint(),d.originX,d.originY);c=f.toLocalPoint(new fabric.Point(a-g.left,c-g.top),d.originX,d.originY);"right"===d.originX?c.x*=-1:"center"===d.originX&&(c.x*=2*d.mouseXSign,0>c.x&&(d.mouseXSign=-d.mouseXSign));"bottom"===d.originY?c.y*=-1:"center"===d.originY&&(c.y*=2*d.mouseYSign,0>c.y&&(d.mouseYSign=-d.mouseYSign));e(c.x)>f.padding?c.x=0>c.x?c.x+f.padding:c.x-f.padding:c.x=0;e(c.y)>f.padding?c.y=0>c.y?c.y+f.padding:c.y-f.padding:c.y=0;a=f.scaleX;g=f.scaleY;
"equally"!==b||h||k?b?"x"!==b||f.get("lockUniScaling")?"y"!==b||f.get("lockUniScaling")||(g=c.y/(f.height+f.strokeWidth),k||f.set("scaleY",g)):(a=c.x/(f.width+f.strokeWidth),h||f.set("scaleX",a)):(a=c.x/(f.width+f.strokeWidth),g=c.y/(f.height+f.strokeWidth),h||f.set("scaleX",a),k||f.set("scaleY",g)):(b=c.y+c.x,h=(f.height+f.strokeWidth)*d.original.scaleY+(f.width+f.strokeWidth)*d.original.scaleX,a=d.original.scaleX*b/h,g=d.original.scaleY*b/h,f.set("scaleX",a),f.set("scaleY",g));0>a&&("left"===d.originX?
d.originX="right":"right"===d.originX&&(d.originX="left"));0>g&&("top"===d.originY?d.originY="bottom":"bottom"===d.originY&&(d.originY="top"));f.setPositionByOrigin(l,d.originX,d.originY)}},_rotateObject:function(a,c){var b=this._currentTransform,e=this._offset;if(!b.target.get("lockRotation")){var f=g(b.ey-b.top-e.top,b.ex-b.left-e.left),e=g(c-b.top-e.top,a-b.left-e.left),f=d(e-f+b.theta);0>f&&(f=360+f);b.target.angle=f}},_setCursor:function(a){this.upperCanvasEl.style.cursor=a},_resetObjectTransform:function(a){a.scaleX=
1;a.scaleY=1;a.setAngle(0)},_drawSelection:function(){var a=this.contextTop,c=this._groupSelector,b=c.left,d=c.top,g=e(b),f=e(d);a.fillStyle=this.selectionColor;a.fillRect(c.ex-(0<b?0:-b),c.ey-(0<d?0:-d),g,f);a.lineWidth=this.selectionLineWidth;a.strokeStyle=this.selectionBorderColor;1<this.selectionDashArray.length?(b=c.ex+0.5-(0<b?0:g),c=c.ey+0.5-(0<d?0:f),a.beginPath(),fabric.util.drawDashedLine(a,b,c,b+g,c,this.selectionDashArray),fabric.util.drawDashedLine(a,b,c+f-1,b+g,c+f-1,this.selectionDashArray),
fabric.util.drawDashedLine(a,b,c,b,c+f,this.selectionDashArray),fabric.util.drawDashedLine(a,b+g-1,c,b+g-1,c+f,this.selectionDashArray),a.closePath(),a.stroke()):a.strokeRect(c.ex+0.5-(0<b?0:g),c.ey+0.5-(0<d?0:f),g,f)},_findSelectedObjects:function(a){for(var c=[],b=this._groupSelector.ex,d=this._groupSelector.ey,e=b+this._groupSelector.left,g=d+this._groupSelector.top,f=new fabric.Point(h(b,e),h(d,g)),l=new fabric.Point(k(b,e),k(d,g)),d=b===e&&d===g,e=this._objects.length;e--&&!((b=this._objects[e])&&
((b.intersectsWithRect(f,l)||b.isContainedWithinRect(f,l)||b.containsPoint(f)||b.containsPoint(l))&&this.selection&&b.selectable)&&(b.set("active",!0),c.push(b),d)););1===c.length?this.setActiveObject(c[0],a):1<c.length&&(c=new fabric.Group(c.reverse()),this.setActiveGroup(c),c.saveCoords(),this.fire("selection:created",{target:c}),this.renderAll())},findTarget:function(a,c){var b,d=this.getPointer(a);if(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&
this.containsPoint(a,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(a,this._offset))return b=this.lastRenderedObjectWithControlsAboveOverlay;var e=this.getActiveGroup();if(e&&!c&&this.containsPoint(a,e))return e;e=[];for(d=this._objects.length;d--;)if(this._objects[d]&&this._objects[d].visible&&this.containsPoint(a,this._objects[d]))if(this.perPixelTargetFind||this._objects[d].perPixelTargetFind)e[e.length]=this._objects[d];else{this.relatedTarget=
b=this._objects[d];break}for(var g=0,f=e.length;g<f;g++)if(d=this.getPointer(a),!this.isTargetTransparent(e[g],d.x,d.y)){this.relatedTarget=b=e[g];break}return b},getPointer:function(a){a=c(a,this.upperCanvasEl);return{x:a.x-this._offset.left,y:a.y-this._offset.top}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+a);this.wrapperEl.appendChild(this.upperCanvasEl);
this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});
fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var c=this.getWidth()||a.width,b=this.getHeight()||a.height;fabric.util.setStyle(a,{position:"absolute",width:c+"px",height:b+"px",left:0,top:0});a.width=c;a.height=b;fabric.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,c){c.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},
getSelectionElement:function(){return this.upperCanvasEl},setActiveObject:function(a,c){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=a;a.set("active",!0);this.renderAll();this.fire("object:selected",{target:a,e:c});a.fire("selected",{e:c});return this},getActiveObject:function(){return this._activeObject},discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null;return this},setActiveGroup:function(a){if(this._activeGroup=
a)a.canvas=this,a.set("active",!0);return this},getActiveGroup:function(){return this._activeGroup},discardActiveGroup:function(){var a=this.getActiveGroup();a&&a.destroy();return this.setActiveGroup(null)},deactivateAll:function(){for(var a=this.getObjects(),c=0,b=a.length;c<b;c++)a[c].set("active",!1);this.discardActiveGroup();this.discardActiveObject();return this},deactivateAllWithDispatch:function(){var a=this.getActiveGroup()||this.getActiveObject();a&&this.fire("before:selection:cleared",{target:a});
this.deactivateAll();a&&this.fire("selection:cleared");return this},drawControls:function(a){var c=this.getActiveGroup();if(c)a.save(),fabric.Group.prototype.transform.call(c,a),c.drawBorders(a).drawControls(a),a.restore();else for(var c=0,b=this._objects.length;c<b;++c)this._objects[c]&&this._objects[c].active&&(a.save(),fabric.Object.prototype.transform.call(this._objects[c],a),this._objects[c].drawBorders(a).drawControls(a),a.restore(),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[c])}});
for(var l in fabric.StaticCanvas)"prototype"!==l&&(fabric.Canvas[l]=fabric.StaticCanvas[l]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas})();
(function(){var a="n-resize ne-resize e-resize se-resize s-resize sw-resize w-resize nw-resize".split(" "),b={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},c=fabric.util.addListener,f=fabric.util.removeListener,d=fabric.util.getPointer;fabric.util.object.extend(fabric.Canvas.prototype,{_initEvents:function(){var a=this;this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=
function(c,b){a.__onTransformGesture(c,b)};c(fabric.window,"resize",this._onResize);fabric.isTouchSupported?(c(this.upperCanvasEl,"touchstart",this._onMouseDown),c(this.upperCanvasEl,"touchmove",this._onMouseMove),"undefined"!==typeof Event&&"add"in Event&&Event.add(this.upperCanvasEl,"gesture",this._onGesture)):(c(this.upperCanvasEl,"mousedown",this._onMouseDown),c(this.upperCanvasEl,"mousemove",this._onMouseMove))},_onMouseDown:function(a){this.__onMouseDown(a);!fabric.isTouchSupported&&c(fabric.document,
"mouseup",this._onMouseUp);fabric.isTouchSupported&&c(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&c(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&c(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&f(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&f(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseUp:function(a){this.__onMouseUp(a);!fabric.isTouchSupported&&f(fabric.document,"mouseup",this._onMouseUp);
fabric.isTouchSupported&&f(fabric.document,"touchend",this._onMouseUp);!fabric.isTouchSupported&&f(fabric.document,"mousemove",this._onMouseMove);fabric.isTouchSupported&&f(fabric.document,"touchmove",this._onMouseMove);!fabric.isTouchSupported&&c(this.upperCanvasEl,"mousemove",this._onMouseMove);fabric.isTouchSupported&&c(this.upperCanvasEl,"touchmove",this._onMouseMove)},_onMouseMove:function(a){a.preventDefault&&a.preventDefault();this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},
__onMouseUp:function(a){var c;if(this.isDrawingMode&&this._isCurrentlyDrawing)this._isCurrentlyDrawing=!1,this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:a});else{this._currentTransform&&(c=this._currentTransform.target,c._scaling&&(c._scaling=!1),c.isMoving=!1,c.setCoords(),this.stateful&&c.hasStateChanged()&&(this.fire("object:modified",{target:c}),c.fire("modified")),this._previousOriginX&&(this._currentTransform.target.adjustPosition(this._previousOriginX),this._previousOriginX=null));
this._currentTransform=null;this.selection&&this._groupSelector&&this._findSelectedObjects(a);var b=this.getActiveGroup();b&&(b.setObjectsCoords(),b.set("isMoving",!1),this._setCursor(this.defaultCursor));this._groupSelector=null;this.renderAll();this._setCursorFromEvent(a,c);this._setCursor("");var d=this;setTimeout(function(){d._setCursorFromEvent(a,c)},50);this.fire("mouse:up",{target:c,e:a});c&&c.fire("mouseup",{e:a})}},__onMouseDown:function(a){var c;if(("which"in a?1===a.which:1===a.button)||
fabric.isTouchSupported)if(this.isDrawingMode)c=this.getPointer(a),this._isCurrentlyDrawing=!0,this.discardActiveObject().renderAll(),this.freeDrawingBrush.onMouseDown(c),this.fire("mouse:down",{e:a});else if(!this._currentTransform){var b=this.findTarget(a),d;c=this.getPointer(a);if(this._shouldClearSelection(a,b))this._groupSelector={ex:c.x,ey:c.y,top:0,left:0},this.deactivateAllWithDispatch(),b&&b.selectable&&this.setActiveObject(b,a);else if(this._shouldHandleGroupLogic(a,b))this._handleGroupLogic(a,
b),b=this.getActiveGroup();else{this.stateful&&b.saveState();if(d=b._findTargetCorner(a,this._offset))this.onBeforeScaleRotate(b);b!==this.getActiveGroup()&&b!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(b,a));this._setupCurrentTransform(a,b)}this.renderAll();this.fire("mouse:down",{target:b,e:a});b&&b.fire("mousedown",{e:a});"mtr"===d&&(this._previousOriginX=this._currentTransform.target.originX,this._currentTransform.target.adjustPosition("center"),this._currentTransform.left=
this._currentTransform.target.left,this._currentTransform.top=this._currentTransform.target.top)}},__onMouseMove:function(a){var c,b;if(this.isDrawingMode)this._isCurrentlyDrawing&&(b=this.getPointer(a),this.freeDrawingBrush.onMouseMove(b)),this.upperCanvasEl.style.cursor=this.freeDrawingCursor,this.fire("mouse:move",{e:a});else{var f=this._groupSelector;if(f)b=d(a,this.upperCanvasEl),f.left=b.x-this._offset.left-f.ex,f.top=b.y-this._offset.top-f.ey,this.renderTop();else if(this._currentTransform){b=
d(a,this.upperCanvasEl);f=b.x;b=b.y;var l=!1,m=this._currentTransform;c=m.target;c.isMoving=!0;"scale"!==m.action&&"scaleX"!==m.action&&"scaleY"!==m.action||(!a.altKey||"center"===m.originX&&"center"===m.originY)&&(a.altKey||"center"!==m.originX||"center"!==m.originY)||(this._resetCurrentTransform(a),l=!0);"rotate"===m.action?(this._rotateObject(f,b),this.fire("object:rotating",{target:c,e:a}),c.fire("rotating",{e:a})):"scale"===m.action?(!a.shiftKey&&!this.uniScaleTransform||c.get("lockUniScaling")?
(l||"scale"!==m.currentAction||this._resetCurrentTransform(a),m.currentAction="scaleEqually",this._scaleObject(f,b,"equally")):(m.currentAction="scale",this._scaleObject(f,b)),this.fire("object:scaling",{target:c,e:a}),c.fire("scaling",{e:a})):"scaleX"===m.action?(this._scaleObject(f,b,"x"),this.fire("object:scaling",{target:c,e:a}),c.fire("scaling",{e:a})):"scaleY"===m.action?(this._scaleObject(f,b,"y"),this.fire("object:scaling",{target:c,e:a}),c.fire("scaling",{e:a})):(this._translateObject(f,
b),this.fire("object:moving",{target:c,e:a}),c.fire("moving",{e:a}),this._setCursor(this.moveCursor));this.renderAll()}else if(f=this.upperCanvasEl.style,c=this.findTarget(a),!c||c&&!c.selectable){for(b=this._objects.length;b--;)this._objects[b]&&!this._objects[b].active&&this._objects[b].set("active",!1);f.cursor=this.defaultCursor}else this._setCursorFromEvent(a,c);this.fire("mouse:move",{target:c,e:a});c&&c.fire("mousemove",{e:a})}},_setCursorFromEvent:function(c,d){var f=this.upperCanvasEl.style;
if(d){var k=this.getActiveGroup();if(k=d._findTargetCorner&&(!k||!k.contains(d))&&d._findTargetCorner(c,this._offset))if(k in b){var l=Math.round(d.getAngle()%360/45);0>l&&(l+=8);l+=b[k];f.cursor=a[l%8]}else if("mtr"===k&&d.hasRotatingPoint)f.cursor=this.rotationCursor;else return f.cursor=this.defaultCursor,!1;else f.cursor=this.hoverCursor}else return f.cursor=this.defaultCursor,!1;return!0}})})();
fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,b){b=b||{};var c=function(){},f=b.onComplete||c,d=b.onChange||c,g=this;fabric.util.animate({startValue:a.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(c){a.set("left",c);g.renderAll();d()},onComplete:function(){a.setCoords();f()}});return this},fxCenterObjectV:function(a,b){b=b||{};var c=function(){},f=b.onComplete||c,d=b.onChange||c,g=this;fabric.util.animate({startValue:a.get("top"),
endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(c){a.set("top",c);g.renderAll();d()},onComplete:function(){a.setCoords();f()}});return this},fxRemove:function(a,b){b=b||{};var c=function(){},f=b.onComplete||c,d=b.onChange||c,g=this;fabric.util.animate({startValue:a.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){a.set("active",!1)},onChange:function(c){a.set("opacity",c);g.renderAll();d()},onComplete:function(){g.remove(a);f()}});return this}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",c=a.quality||1;a=a.multiplier||1;return 1!==a?this.__toDataURLWithMultiplier(b,c,a):this.__toDataURL(b,c)},__toDataURL:function(a,b){this.renderAll(!0);var c=this.upperCanvasEl||this.lowerCanvasEl,c=fabric.StaticCanvas.supports("toDataURLWithQuality")?c.toDataURL("image/"+a,b):c.toDataURL("image/"+a);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return c},__toDataURLWithMultiplier:function(a,
b,c){var f=this.getWidth(),d=this.getHeight(),g=f*c,e=d*c,h=this.getActiveObject(),k=this.getActiveGroup(),l=this.contextTop||this.contextContainer;this.setWidth(g).setHeight(e);l.scale(c,c);k?this._tempRemoveBordersControlsFromGroup(k):h&&this.deactivateAll&&this.deactivateAll();this.width=f;this.height=d;this.renderAll(!0);a=this.__toDataURL(a,b);l.scale(1/c,1/c);this.setWidth(f).setHeight(d);k?this._restoreBordersControlsOnGroup(k):h&&this.setActiveObject&&this.setActiveObject(h);this.contextTop&&
this.clearContext(this.contextTop);this.renderAll();return a},toDataURLWithMultiplier:function(a,b,c){return this.toDataURL({format:a,multiplier:b,quality:c})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls;a.origBorderColor=a.borderColor;a.hasControls=!0;a.borderColor="rgba(0,0,0,0)";a.forEachObject(function(a){a.origBorderColor=a.borderColor;a.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls;a.borderColor=
a.origBorderColor;a.forEachObject(function(a){a.borderColor=a.origBorderColor;delete a.origBorderColor})}});
fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(a,b){return this.loadFromJSON(a,b)},loadFromJSON:function(a,b){if(a){var c="string"===typeof a?JSON.parse(a):a;this.clear();var f=this;this._enlivenObjects(c.objects,function(){f._setBgOverlayImages(c,b)});return this}},_setBgOverlayImages:function(a,b){var c=this,f,d,g,e=function(){b&&d&&g&&f&&b()};a.backgroundImage?this.setBackgroundImage(a.backgroundImage,function(){c.backgroundImageOpacity=a.backgroundImageOpacity;
c.backgroundImageStretch=a.backgroundImageStretch;c.renderAll();d=!0;e()}):d=!0;a.overlayImage?this.setOverlayImage(a.overlayImage,function(){c.overlayImageLeft=a.overlayImageLeft||0;c.overlayImageTop=a.overlayImageTop||0;c.renderAll();g=!0;e()}):g=!0;a.background?this.setBackgroundColor(a.background,function(){c.renderAll();f=!0;e()}):f=!0;a.backgroundImage||(a.overlayImage||a.background)||b&&b()},_enlivenObjects:function(a,b){var c=this;0===a.length&&b&&b();var f=this.renderOnAddition;this.renderOnAddition=
!1;fabric.util.enlivenObjects(a,function(a){a.forEach(function(a,b){c.insertAt(a,b,!0)});c.renderOnAddition=f;b&&b()})},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,b,c){this.clone(function(f){c(f.toDataURLWithMultiplier(a,b))})},clone:function(a){var b=JSON.stringify(this);this.cloneWithoutData(function(c){c.loadFromJSON(b,function(){a&&a(c)})})},cloneWithoutData:function(a){var b=fabric.document.createElement("canvas");b.width=this.getWidth();
b.height=this.getHeight();var c=new fabric.Canvas(b);c.clipTo=this.clipTo;this.backgroundImage?(c.setBackgroundImage(this.backgroundImage.src,function(){c.renderAll();a&&a(c)}),c.backgroundImageOpacity=this.backgroundImageOpacity,c.backgroundImageStretch=this.backgroundImageStretch):a&&a(c)}});
(function(a){var b=a.fabric||(a.fabric={});a=b.util.object.extend;var c=b.util.toFixed,f=b.util.string.capitalize,d=b.util.degreesToRadians,g=b.StaticCanvas.supports("setLineDash");b.Object||(b.Object=b.util.createClass({type:"object",originX:"center",originY:"center",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centerTransform:!1,fill:"rgb(0,0,0)",
fillRule:"source-over",overlayFill:null,stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,
stateProperties:"top left width height scaleX scaleY flipX flipY angle opacity cornerSize fill overlayFill originX originY stroke strokeWidth strokeDashArray fillRule borderScaleFactor transformMatrix selectable shadow visible".split(" "),initialize:function(a){a&&this.setOptions(a)},_initGradient:function(a){!a.fill||(!a.fill.colorStops||a.fill instanceof b.Gradient)||this.set("fill",new b.Gradient(a.fill))},_initPattern:function(a){!a.fill||(!a.fill.source||a.fill instanceof b.Pattern)||this.set("fill",
new b.Pattern(a.fill));!a.stroke||(!a.stroke.source||a.stroke instanceof b.Pattern)||this.set("stroke",new b.Pattern(a.stroke))},_initShadow:function(a){!a.shadow||a.shadow instanceof b.Shadow||this.setShadow(a.shadow)},_initClipping:function(a){a.clipTo&&"string"===typeof a.clipTo&&(a=b.util.getFunctionBody(a.clipTo),"undefined"!==typeof a&&(this.clipTo=new Function("ctx",a)))},setOptions:function(a){for(var c in a)this.set(c,a[c]);this._initGradient(a);this._initPattern(a);this._initShadow(a);this._initClipping(a)},
transform:function(a,c){a.globalAlpha=this.opacity;var b=c?this._getLeftTopCoords():this.getCenterPoint();a.translate(b.x,b.y);a.rotate(d(this.angle));a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(a){var d=b.Object.NUM_FRACTION_DIGITS,d={type:this.type,originX:this.originX,originY:this.originY,left:c(this.left,d),top:c(this.top,d),width:c(this.width,d),height:c(this.height,d),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,overlayFill:this.overlayFill,
stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:c(this.strokeWidth,d),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:c(this.strokeMiterLimit,d),scaleX:c(this.scaleX,d),scaleY:c(this.scaleY,d),angle:c(this.getAngle(),d),flipX:this.flipX,flipY:this.flipY,opacity:c(this.opacity,d),selectable:this.selectable,hasControls:this.hasControls,hasBorders:this.hasBorders,hasRotatingPoint:this.hasRotatingPoint,
transparentCorners:this.transparentCorners,perPixelTargetFind:this.perPixelTargetFind,shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo)};this.includeDefaultValues||(d=this._removeDefaultValues(d));b.util.populateWithProperties(this,d,a);return d},toDatalessObject:function(a){return this.toObject(a)},getSvgStyles:function(){var a=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",c=this.stroke?
this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",b=this.strokeWidth?this.strokeWidth:"0",d=this.strokeDashArray?this.strokeDashArray.join(" "):"";return["stroke: ",c,"; stroke-width: ",b,"; stroke-dasharray: ",d,"; stroke-linecap: ",this.strokeLineCap?this.strokeLineCap:"butt","; stroke-linejoin: ",this.strokeLineJoin?this.strokeLineJoin:"miter","; stroke-miterlimit: ",this.strokeMiterLimit?this.strokeMiterLimit:"4","; fill: ",a,"; opacity: ","undefined"!==typeof this.opacity?
this.opacity:"1",";",this.visible?"":" visibility: hidden;"].join("")},getSvgTransform:function(){var a=this.getAngle(),d=this.getCenterPoint(),f=b.Object.NUM_FRACTION_DIGITS,d="translate("+c(d.x,f)+" "+c(d.y,f)+")",a=0!==a?" rotate("+c(a,f)+")":"",f=1===this.scaleX&&1===this.scaleY?"":" scale("+c(this.scaleX,f)+" "+c(this.scaleY,f)+")";return[d,a,f,this.flipX?"matrix(-1 0 0 1 0 0) ":"",this.flipY?"matrix(1 0 0 -1 0 0)":""].join("")},_removeDefaultValues:function(a){var c=b.Object.prototype.options;
c&&this.stateProperties.forEach(function(b){a[b]===c[b]&&delete a[b]});return a},toString:function(){return"#<fabric."+f(this.type)+">"},get:function(a){return this[a]},set:function(a,c){if("object"===typeof a)for(var b in a)this._set(b,a[b]);else"function"===typeof c&&"clipTo"!==a?this._set(a,c(this.get(a))):this._set(a,c);return this},_set:function(a,b){if("scaleX"===a||"scaleY"===a)b=this._constrainScale(b);if("scaleX"===a&&0>b)this.flipX=!this.flipX,b*=-1;else if("scaleY"===a&&0>b)this.flipY=
!this.flipY,b*=-1;else if("width"===a||"height"===a)this.minScaleLimit=c(Math.min(0.1,1/Math.max(this.width,this.height)),2);this[a]=b;return this},toggle:function(a){var c=this.get(a);"boolean"===typeof c&&this.set(a,!c);return this},setSourcePath:function(a){this.sourcePath=a;return this},render:function(a,c){if(0!==this.width&&0!==this.height&&this.visible){a.save();var d=this.transformMatrix;d&&!this.group&&a.setTransform(d[0],d[1],d[2],d[3],d[4],d[5]);c||this.transform(a);this.stroke&&(a.lineWidth=
this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke);this.overlayFill?a.fillStyle=this.overlayFill:this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill);d&&this.group&&(a.translate(-this.group.width/2,-this.group.height/2),a.transform(d[0],d[1],d[2],d[3],d[4],d[5]));this._setShadow(a);this.clipTo&&b.util.clipContext(this,a);this._render(a,c);this.clipTo&&
a.restore();this._removeShadow(a);this.active&&!c&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_setShadow:function(a){this.shadow&&(a.shadowColor=this.shadow.color,a.shadowBlur=this.shadow.blur,a.shadowOffsetX=this.shadow.offsetX,a.shadowOffsetY=this.shadow.offsetY)},_removeShadow:function(a){a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_renderFill:function(a){this.fill&&(this.fill.toLive&&(a.save(),a.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||
0)),a.fill(),this.fill.toLive&&a.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a))},_renderStroke:function(a){this.stroke&&(a.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g?(a.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(a)):this._renderDashedStroke&&this._renderDashedStroke(a),a.stroke()):this._stroke?this._stroke(a):a.stroke(),this._removeShadow(a),a.restore())},clone:function(a,
c){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(c),a):new b.Object(this.toObject(c))},cloneAsImage:function(a){var c=this.toDataURL();b.util.loadImage(c,function(c){a&&a(new b.Image(c))});return this},toDataURL:function(a){a||(a={});var c=b.util.createCanvasElement();c.width=this.getBoundingRectWidth();c.height=this.getBoundingRectHeight();b.util.wrapElement(c,"div");var d=new b.Canvas(c);"jpeg"===a.format&&(d.backgroundColor="#fff");var f={active:this.get("active"),
left:this.getLeft(),top:this.getTop()};this.set({active:!1,left:c.width/2,top:c.height/2});d.add(this);a=d.toDataURL(a);this.set(f).setCoords();d.dispose();return a},isType:function(a){return this.type===a},toGrayscale:function(){var a=this.get("fill");a&&this.set("overlayFill",(new b.Color(a)).toGrayscale().toRgb());return this},complexity:function(){return 0},toJSON:function(a){return this.toObject(a)},setGradient:function(a,c){c||(c={});var d={colorStops:[]};d.type=c.type||(c.r1||c.r2?"radial":
"linear");d.coords={x1:c.x1,y1:c.y1,x2:c.x2,y2:c.y2};if(c.r1||c.r2)d.coords.r1=c.r1,d.coords.r2=c.r2;for(var f in c.colorStops){var g=new b.Color(c.colorStops[f]);d.colorStops.push({offset:f,color:g.toRgb(),opacity:g.getAlpha()})}this.set(a,b.Gradient.forObject(this,d))},setPatternFill:function(a){return this.set("fill",new b.Pattern(a))},setShadow:function(a){return this.set("shadow",new b.Shadow(a))},animate:function(){if(arguments[0]&&"object"===typeof arguments[0]){var a=[],c,b;for(c in arguments[0])a.push(c);
for(var d=0,f=a.length;d<f;d++)c=a[d],b=d!==f-1,this._animate(c,arguments[0][c],arguments[1],b)}else this._animate.apply(this,arguments);return this},_animate:function(a,c,d,f){var g=this,n;c=c.toString();d=d?b.util.object.clone(d):{};~a.indexOf(".")&&(n=a.split("."));var p=n?this.get(n[0])[n[1]]:this.get(a);"from"in d||(d.from=p);c=~c.indexOf("=")?p+parseFloat(c.replace("=","")):parseFloat(c);b.util.animate({startValue:d.from,endValue:c,byValue:d.by,easing:d.easing,duration:d.duration,onChange:function(c){n?
g[n[0]][n[1]]=c:g.set(a,c);f||d.onChange&&d.onChange()},onComplete:function(){f||(g.setCoords(),d.onComplete&&d.onComplete())}})},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){return this.centerH().centerV()},remove:function(){return this.canvas.remove(this)},sendToBack:function(){this.group?b.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this);return this},bringToFront:function(){this.group?
b.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this);return this},sendBackwards:function(a){this.group?b.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas.sendBackwards(this,a);return this},bringForward:function(a){this.group?b.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas.bringForward(this,a);return this},moveTo:function(a){this.group?b.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas.moveTo(this,
a);return this}}),b.util.createAccessors(b.Object),b.Object.prototype.rotate=b.Object.prototype.setAngle,a(b.Object.prototype,b.Observable),b.Object.NUM_FRACTION_DIGITS=2,b.Object.__uid=0)})("undefined"!==typeof exports?exports:this);
(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(b,c,f){var d=b.x,g=b.y;"left"===c?d=b.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2:"right"===c&&(d=b.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2);"top"===f?g=b.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2:"bottom"===f&&(g=b.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(d,g),b,a(this.angle))},translateToOriginPoint:function(b,
c,f){var d=b.x,g=b.y;"left"===c?d=b.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2:"right"===c&&(d=b.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2);"top"===f?g=b.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2:"bottom"===f&&(g=b.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2);return fabric.util.rotatePoint(new fabric.Point(d,g),b,a(this.angle))},getCenterPoint:function(){return this.translateToCenterPoint(new fabric.Point(this.left,this.top),this.originX,this.originY)},toLocalPoint:function(b,
c,f){var d=this.getCenterPoint();void 0!==c&&void 0!==f?(c="left"===c?d.x-(this.getWidth()+this.strokeWidth*this.scaleX)/2:"right"===c?d.x+(this.getWidth()+this.strokeWidth*this.scaleX)/2:d.x,f="top"===f?d.y-(this.getHeight()+this.strokeWidth*this.scaleY)/2:"bottom"===f?d.y+(this.getHeight()+this.strokeWidth*this.scaleY)/2:d.y):(c=this.left,f=this.top);return fabric.util.rotatePoint(new fabric.Point(b.x,b.y),d,-a(this.angle)).subtractEquals(new fabric.Point(c,f))},setPositionByOrigin:function(a,c,
f){a=this.translateToCenterPoint(a,c,f);a=this.translateToOriginPoint(a,this.originX,this.originY);this.set("left",a.x);this.set("top",a.y)},adjustPosition:function(b){var c=a(this.angle),f=this.getWidth()/2,d=Math.cos(c)*f,f=Math.sin(c)*f,g=this.getWidth(),e=Math.cos(c)*g,c=Math.sin(c)*g;"center"===this.originX&&"left"===b||"right"===this.originX&&"center"===b?(this.left-=d,this.top-=f):"left"===this.originX&&"center"===b||"center"===this.originX&&"right"===b?(this.left+=d,this.top+=f):"left"===
this.originX&&"right"===b?(this.left+=e,this.top+=c):"right"===this.originX&&"left"===b&&(this.left-=e,this.top-=c);this.setCoords();this.originX=b},_getLeftTopCoords:function(){var b=a(this.angle),c=this.getWidth()/2,f=Math.cos(b)*c,b=Math.sin(b)*c,c=this.left,d=this.top;if("center"===this.originX||"right"===this.originX)c-=f;if("center"===this.originY||"bottom"===this.originY)d-=b;return{x:c,y:d}}})})();
(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{intersectsWithRect:function(a,c){var f=this.oCoords,d=new fabric.Point(f.tl.x,f.tl.y),g=new fabric.Point(f.tr.x,f.tr.y),e=new fabric.Point(f.bl.x,f.bl.y),f=new fabric.Point(f.br.x,f.br.y);return"Intersection"===fabric.Intersection.intersectPolygonRectangle([d,g,f,e],a,c).status},intersectsWithObject:function(a){function c(a){return{tl:new fabric.Point(a.tl.x,a.tl.y),tr:new fabric.Point(a.tr.x,a.tr.y),
bl:new fabric.Point(a.bl.x,a.bl.y),br:new fabric.Point(a.br.x,a.br.y)}}var f=c(this.oCoords);a=c(a.oCoords);return"Intersection"===fabric.Intersection.intersectPolygonPolygon([f.tl,f.tr,f.br,f.bl],[a.tl,a.tr,a.br,a.bl]).status},isContainedWithinObject:function(a){var c=a.getBoundingRect();a=new fabric.Point(c.left,c.top);c=new fabric.Point(c.left+c.width,c.top+c.height);return this.isContainedWithinRect(a,c)},isContainedWithinRect:function(a,c){var f=this.getBoundingRect();return f.left>a.x&&f.left+
f.width<c.x&&f.top>a.y&&f.top+f.height<c.y},containsPoint:function(a){var c=this._getImageLines(this.oCoords);a=this._findCrossPoints(a,c);return 0!==a&&1===a%2},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,c){var f,d,g,e=0,h;for(h in c)if(g=c[h],!(g.o.y<a.y&&g.d.y<a.y||g.o.y>=a.y&&g.d.y>=a.y)&&(g.o.x===g.d.x&&g.o.x>=a.x?f=g.o.x:(f=(g.d.y-g.o.y)/(g.d.x-g.o.x),d=a.y-0*a.x,g=g.o.y-
f*g.o.x,f=-(d-g)/(0-f)),f>=a.x&&(e+=1),2===e))break;return e},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var a=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],c=fabric.util.array.min(a),a=fabric.util.array.max(a),a=Math.abs(c-a),f=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],d=fabric.util.array.min(f),
f=fabric.util.array.max(f),f=Math.abs(d-f);return{left:c,top:d,width:a,height:f}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?0>a?-this.minScaleLimit:this.minScaleLimit:a},scale:function(a){a=this._constrainScale(a);0>a&&(this.flipX=!this.flipX,this.flipY=!this.flipY,a*=-1);this.scaleY=this.scaleX=a;this.setCoords();return this},scaleToWidth:function(a){var c=this.getBoundingRectWidth()/
this.getWidth();return this.scale(a/this.width/c)},scaleToHeight:function(a){var c=this.getBoundingRectHeight()/this.getHeight();return this.scale(a/this.height/c)},setCoords:function(){var b=1<this.strokeWidth?this.strokeWidth:0,c=this.padding,f=a(this.angle);this.currentWidth=(this.width+b)*this.scaleX+2*c;this.currentHeight=(this.height+b)*this.scaleY+2*c;0>this.currentWidth&&(this.currentWidth=Math.abs(this.currentWidth));var b=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/
2,2)),d=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),c=Math.cos(d+f)*b,d=Math.sin(d+f)*b,b=Math.sin(f),f=Math.cos(f),g=this.getCenterPoint(),c={x:g.x-c,y:g.y-d},d={x:c.x+this.currentWidth*f,y:c.y+this.currentWidth*b},g={x:c.x-this.currentHeight*b,y:c.y+this.currentHeight*f},e={x:c.x+this.currentWidth/2*f,y:c.y+this.currentWidth/2*b};this.oCoords={tl:c,tr:d,br:{x:d.x-this.currentHeight*b,y:d.y+this.currentHeight*f},bl:g,ml:{x:c.x-this.currentHeight/
2*b,y:c.y+this.currentHeight/2*f},mt:e,mr:{x:d.x-this.currentHeight/2*b,y:d.y+this.currentHeight/2*f},mb:{x:g.x+this.currentWidth/2*f,y:g.y+this.currentWidth/2*b},mtr:{x:e.x,y:e.y}};this._setCornerCoords&&this._setCornerCoords();return this}})})();
fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(a){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);a&&a.stateProperties&&a.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},setupState:function(){this.originalState={};this.saveState();return this}});
(function(){var a=fabric.util.getPointer,b=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_findTargetCorner:function(c,b){if(!this.hasControls||!this.active)return!1;var d=a(c,this.canvas.upperCanvasEl),g=d.x-b.left,d=d.y-b.top,e,h;for(h in this.oCoords)if("mtr"!==h||this.hasRotatingPoint)if(!this.get("lockUniScaling")||"mt"!==h&&"mr"!==h&&"mb"!==h&&"ml"!==h)if(e=this._getImageLines(this.oCoords[h].corner),e=this._findCrossPoints({x:g,y:d},e),0!==e&&1===e%2)return this.__corner=
h;return!1},_setCornerCoords:function(){var a=this.oCoords,f=b(this.angle),d=b(45-this.angle),g=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,e=g*Math.cos(d),d=g*Math.sin(d),g=Math.sin(f),f=Math.cos(f);a.tl.corner={tl:{x:a.tl.x-d,y:a.tl.y-e},tr:{x:a.tl.x+e,y:a.tl.y-d},bl:{x:a.tl.x-e,y:a.tl.y+d},br:{x:a.tl.x+d,y:a.tl.y+e}};a.tr.corner={tl:{x:a.tr.x-d,y:a.tr.y-e},tr:{x:a.tr.x+e,y:a.tr.y-d},br:{x:a.tr.x+d,y:a.tr.y+e},bl:{x:a.tr.x-e,y:a.tr.y+d}};a.bl.corner={tl:{x:a.bl.x-d,y:a.bl.y-e},bl:{x:a.bl.x-e,y:a.bl.y+
d},br:{x:a.bl.x+d,y:a.bl.y+e},tr:{x:a.bl.x+e,y:a.bl.y-d}};a.br.corner={tr:{x:a.br.x+e,y:a.br.y-d},bl:{x:a.br.x-e,y:a.br.y+d},br:{x:a.br.x+d,y:a.br.y+e},tl:{x:a.br.x-d,y:a.br.y-e}};a.ml.corner={tl:{x:a.ml.x-d,y:a.ml.y-e},tr:{x:a.ml.x+e,y:a.ml.y-d},bl:{x:a.ml.x-e,y:a.ml.y+d},br:{x:a.ml.x+d,y:a.ml.y+e}};a.mt.corner={tl:{x:a.mt.x-d,y:a.mt.y-e},tr:{x:a.mt.x+e,y:a.mt.y-d},bl:{x:a.mt.x-e,y:a.mt.y+d},br:{x:a.mt.x+d,y:a.mt.y+e}};a.mr.corner={tl:{x:a.mr.x-d,y:a.mr.y-e},tr:{x:a.mr.x+e,y:a.mr.y-d},bl:{x:a.mr.x-
e,y:a.mr.y+d},br:{x:a.mr.x+d,y:a.mr.y+e}};a.mb.corner={tl:{x:a.mb.x-d,y:a.mb.y-e},tr:{x:a.mb.x+e,y:a.mb.y-d},bl:{x:a.mb.x-e,y:a.mb.y+d},br:{x:a.mb.x+d,y:a.mb.y+e}};a.mtr.corner={tl:{x:a.mtr.x-d+g*this.rotatingPointOffset,y:a.mtr.y-e-f*this.rotatingPointOffset},tr:{x:a.mtr.x+e+g*this.rotatingPointOffset,y:a.mtr.y-d-f*this.rotatingPointOffset},bl:{x:a.mtr.x-e+g*this.rotatingPointOffset,y:a.mtr.y+d-f*this.rotatingPointOffset},br:{x:a.mtr.x+d+g*this.rotatingPointOffset,y:a.mtr.y+e-f*this.rotatingPointOffset}}},
drawBorders:function(a){if(!this.hasBorders)return this;var b=this.padding,d=2*b,g=1<this.strokeWidth?this.strokeWidth:0;a.save();a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=this.borderColor;var e=1/this._constrainScale(this.scaleX),h=1/this._constrainScale(this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(e,h);e=this.getWidth();h=this.getHeight();a.strokeRect(~~(-(e/2)-b-g/2*this.scaleX)+0.5,~~(-(h/2)-b-g/2*this.scaleY)+0.5,~~(e+d+g*this.scaleX),~~(h+d+g*this.scaleY));
this.hasRotatingPoint&&(!this.get("lockRotation")&&this.hasControls)&&(b=(this.flipY?h+g*this.scaleY+2*b:-h-g*this.scaleY-2*b)/2,a.beginPath(),a.moveTo(0,b),a.lineTo(0,b+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),a.closePath(),a.stroke());a.restore();return this},drawControls:function(a){if(!this.hasControls)return this;var b=this.cornerSize,d=b/2,g=1<this.strokeWidth?this.strokeWidth/2:0,e=-(this.width/2),h=-(this.height/2),k=b/this.scaleX,l=b/this.scaleY,m=this.padding/this.scaleX,
n=this.padding/this.scaleY,p=d/this.scaleY,q=d/this.scaleX,u=(d-b)/this.scaleX,y=(d-b)/this.scaleY,x=this.height,w=this.width,A=this.transparentCorners?"strokeRect":"fillRect",t=this.transparentCorners,z="undefined"!==typeof G_vmlCanvasManager;a.save();a.lineWidth=1/Math.max(this.scaleX,this.scaleY);a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;a.strokeStyle=a.fillStyle=this.cornerColor;b=e-q-g-m;d=h-p-g-n;z||t||a.clearRect(b,d,k,l);a[A](b,d,k,l);b=e+w-q+g+m;d=h-p-g-n;z||t||a.clearRect(b,
d,k,l);a[A](b,d,k,l);b=e-q-g-m;d=h+x+y+g+n;z||t||a.clearRect(b,d,k,l);a[A](b,d,k,l);b=e+w+u+g+m;d=h+x+y+g+n;z||t||a.clearRect(b,d,k,l);a[A](b,d,k,l);this.get("lockUniScaling")||(b=e+w/2-q,d=h-p-g-n,z||t||a.clearRect(b,d,k,l),a[A](b,d,k,l),b=e+w/2-q,d=h+x+y+g+n,z||t||a.clearRect(b,d,k,l),a[A](b,d,k,l),b=e+w+u+g+m,d=h+x/2-p,z||t||a.clearRect(b,d,k,l),a[A](b,d,k,l),b=e-q-g-m,d=h+x/2-p,z||t||a.clearRect(b,d,k,l),a[A](b,d,k,l));this.hasRotatingPoint&&(b=e+w/2-q,d=this.flipY?h+x+this.rotatingPointOffset/
this.scaleY-l/2+g+n:h-this.rotatingPointOffset/this.scaleY-l/2-g-n,z||t||a.clearRect(b,d,k,l),a[A](b,d,k,l));a.restore();return this}})})();
(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend,f={x1:1,x2:1,y1:1,y2:1},d=b.StaticCanvas.supports("setLineDash");b.Line?b.warn("fabric.Line is already defined"):(b.Line=b.util.createClass(b.Object,{type:"line",initialize:function(a,b){b=b||{};a||(a=[0,0,0,0]);this.callSuper("initialize",b);this.set("x1",a[0]);this.set("y1",a[1]);this.set("x2",a[2]);this.set("y2",a[3]);this._setWidthHeight(b)},_setWidthHeight:function(a){a||(a={});this.set("width",Math.abs(this.x2-this.x1)||1);this.set("height",
Math.abs(this.y2-this.y1)||1);this.set("left","left"in a?a.left:Math.min(this.x1,this.x2)+this.width/2);this.set("top","top"in a?a.top:Math.min(this.y1,this.y2)+this.height/2)},_set:function(a,b){this[a]=b;a in f&&this._setWidthHeight();return this},_render:function(a){a.beginPath();this.group&&"group"!==this.group.type&&!this.transformMatrix&&a.translate(-this.group.width/2+this.left,-this.group.height/2+this.top);if(!this.strokeDashArray||this.strokeDashArray&&d){var b=this.x1<=this.x2?-1:1,c=this.y1<=
this.y2?-1:1;a.moveTo(1===this.width?0:b*this.width/2,1===this.height?0:c*this.height/2);a.lineTo(1===this.width?0:-1*b*this.width/2,1===this.height?0:-1*c*this.height/2)}a.lineWidth=this.strokeWidth;b=a.strokeStyle;a.strokeStyle=this.stroke||a.fillStyle;this._renderStroke(a);a.strokeStyle=b},_renderDashedStroke:function(a){var c=this.x1<=this.x2?-1:1,d=this.y1<=this.y2?-1:1,c=1===this.width?0:c*this.width/2,d=1===this.height?0:d*this.height/2;a.beginPath();b.util.drawDashedLine(a,c,d,-c,-d,this.strokeDashArray);
a.closePath()},toObject:function(a){return c(this.callSuper("toObject",a),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(){var a=[];this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!0));a.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return a.join("")},complexity:function(){return 1}}),b.Line.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["x1",
"y1","x2","y2"]),b.Line.fromElement=function(a,d){var f=b.parseAttributes(a,b.Line.ATTRIBUTE_NAMES);return new b.Line([f.x1||0,f.y1||0,f.x2||0,f.y2||0],c(f,d))},b.Line.fromObject=function(a){return new b.Line([a.x1,a.y1,a.x2,a.y2],a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),c=2*Math.PI,f=b.util.object.extend;b.Circle?b.warn("fabric.Circle is already defined."):(b.Circle=b.util.createClass(b.Object,{type:"circle",initialize:function(a){a=a||{};this.set("radius",a.radius||0);this.callSuper("initialize",a);a=2*this.get("radius");this.set("width",a).set("height",a)},toObject:function(a){return f(this.callSuper("toObject",a),{radius:this.get("radius")})},toSVG:function(){var a=[];this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,
!1));this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1));a.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a.join("")},_render:function(a,b){a.beginPath();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;a.arc(b?this.left:0,b?this.top:0,this.radius,0,c,!1);a.closePath();this._renderFill(a);this._renderStroke(a)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},
getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(a){this.radius=a;this.set("width",2*a).set("height",2*a)},complexity:function(){return 1}}),b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","r"]),b.Circle.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Circle.ATTRIBUTE_NAMES);if(!("radius"in e&&0<e.radius))throw Error("value of `r` attribute is required and can not be negative");"left"in e&&(e.left-=c.width/2||0);"top"in e&&(e.top-=
c.height/2||0);e=new b.Circle(f(e,c));e.cx=parseFloat(a.getAttribute("cx"))||0;e.cy=parseFloat(a.getAttribute("cy"))||0;return e},b.Circle.fromObject=function(a){return new b.Circle(a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={});b.Triangle?b.warn("fabric.Triangle is already defined"):(b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("width",a.width||100).set("height",a.height||100)},_render:function(a){var b=this.width/2,d=this.height/2;a.beginPath();a.moveTo(-b,d);a.lineTo(0,-d);a.lineTo(b,d);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var f=this.width/2,d=
this.height/2;a.beginPath();b.util.drawDashedLine(a,-f,d,0,-d,this.strokeDashArray);b.util.drawDashedLine(a,0,-d,f,d,this.strokeDashArray);b.util.drawDashedLine(a,f,d,-f,d,this.strokeDashArray);a.closePath()},toSVG:function(){var a=[],b=this.width/2,d=this.height/2,b=[-b+" "+d,"0 "+-d,b+" "+d].join();this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!0));this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!0));a.push("<polygon ",'points="',b,'" style="',this.getSvgStyles(),'" transform="',
this.getSvgTransform(),'"/>');return a.join("")},complexity:function(){return 1}}),b.Triangle.fromObject=function(a){return new b.Triangle(a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),c=2*Math.PI,f=b.util.object.extend;b.Ellipse?b.warn("fabric.Ellipse is already defined."):(b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(a){a=a||{};this.callSuper("initialize",a);this.set("rx",a.rx||0);this.set("ry",a.ry||0);this.set("width",2*this.get("rx"));this.set("height",2*this.get("ry"))},toObject:function(a){return f(this.callSuper("toObject",a),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(){var a=[];
this.fill&&this.fill.toLive&&a.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1));a.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a.join("")},render:function(a,b){if(0!==this.rx&&0!==this.ry)return this.callSuper("render",a,b)},_render:function(a,b){a.beginPath();a.save();a.globalAlpha=this.group?a.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&
this.group&&a.translate(this.cx,this.cy);a.transform(1,0,0,this.ry/this.rx,0,0);a.arc(b?this.left:0,b?this.top:0,this.rx,0,c,!1);this._renderFill(a);this._renderStroke(a);a.restore()},complexity:function(){return 1}}),b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(["cx","cy","rx","ry"]),b.Ellipse.fromElement=function(a,c){c||(c={});var e=b.parseAttributes(a,b.Ellipse.ATTRIBUTE_NAMES),h=e.left,k=e.top;"left"in e&&(e.left-=c.width/2||0);"top"in e&&(e.top-=c.height/2||0);e=new b.Ellipse(f(e,c));
e.cx=h||0;e.cy=k||0;return e},b.Ellipse.fromObject=function(a){return new b.Ellipse(a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Rect?console.warn("fabric.Rect is already defined"):(b.Rect=b.util.createClass(b.Object,{type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(a){a=a||{};this._initStateProperties();this.callSuper("initialize",a);this._initRxRy();this.x=a.x||0;this.y=a.y||0},_initStateProperties:function(){this.stateProperties=this.stateProperties.concat(["rx","ry"])},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&
(this.rx=this.ry)},_render:function(a){var b=this.rx||0,c=this.ry||0,e=-this.width/2,h=-this.height/2,k=this.width,l=this.height,m=this.group&&"group"!==this.group.type;a.beginPath();a.globalAlpha=m?a.globalAlpha*this.opacity:this.opacity;this.transformMatrix&&m&&a.translate(this.width/2+this.x,this.height/2+this.y);!this.transformMatrix&&m&&a.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y);m=0!==b||0!==c;a.moveTo(e+b,h);a.lineTo(e+k-b,h);m&&a.quadraticCurveTo(e+
k,h,e+k,h+c,e+k,h+c);a.lineTo(e+k,h+l-c);m&&a.quadraticCurveTo(e+k,h+l,e+k-b,h+l,e+k-b,h+l);a.lineTo(e+b,h+l);m&&a.quadraticCurveTo(e,h+l,e,h+l-c,e,h+l-c);a.lineTo(e,h+c);m&&a.quadraticCurveTo(e,h,e+b,h,e+b,h);a.closePath();this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var c=-this.width/2,g=-this.height/2,e=this.width,h=this.height;a.beginPath();b.util.drawDashedLine(a,c,g,c+e,g,this.strokeDashArray);b.util.drawDashedLine(a,c+e,g,c+e,g+h,this.strokeDashArray);b.util.drawDashedLine(a,
c+e,g+h,c,g+h,this.strokeDashArray);b.util.drawDashedLine(a,c,g+h,c,g,this.strokeDashArray);a.closePath()},_normalizeLeftTopProperties:function(a){"left"in a&&this.set("left",a.left+this.getWidth()/2);this.set("x",a.left||0);"top"in a&&this.set("top",a.top+this.getHeight()/2);this.set("y",a.top||0);return this},toObject:function(a){return c(this.callSuper("toObject",a),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")})},toSVG:function(){var a=[];this.fill&&this.fill.toLive&&
a.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&a.push(this.stroke.toSVG(this,!1));a.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return a.join("")},complexity:function(){return 1}}),b.Rect.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),b.Rect.fromElement=function(a,
d){if(!a)return null;var g=b.parseAttributes(a,b.Rect.ATTRIBUTE_NAMES);g.left=g.left||0;g.top=g.top||0;var e=new b.Rect(c(d?b.util.object.clone(d):{},g));e._normalizeLeftTopProperties(g);return e},b.Rect.fromObject=function(a){return new b.Rect(a)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),c=b.util.toFixed,f=b.util.array.min;b.Polyline?b.warn("fabric.Polyline is already defined"):(b.Polyline=b.util.createClass(b.Object,{type:"polyline",initialize:function(a,b,c){b=b||{};this.set("points",a);this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(a){return b.Polygon.prototype._calcDimensions.call(this,a)},toObject:function(a){return b.Polygon.prototype.toObject.call(this,a)},toSVG:function(){for(var a=[],b=[],e=0,f=
this.points.length;e<f;e++)a.push(c(this.points[e].x,2),",",c(this.points[e].y,2)," ");this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!1));b.push("<polyline ",'points="',a.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return b.join("")},_render:function(a){var b;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,f=this.points.length;c<f;c++)b=this.points[c],a.lineTo(b.x,
b.y);this._renderFill(a);this._renderStroke(a)},_renderDashedStroke:function(a){var c,e;a.beginPath();for(var f=0,k=this.points.length;f<k;f++)c=this.points[f],e=this.points[f+1]||c,b.util.drawDashedLine(a,c.x,c.y,e.x,e.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),b.Polyline.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polyline.fromElement=function(a,c){if(!a)return null;c||(c={});for(var e=b.parsePointsAttribute(a.getAttribute("points")),h=b.parseAttributes(a,
b.Polyline.ATTRIBUTE_NAMES),k=f(e,"x"),l=f(e,"y"),k=0>k?k:0,l=0>k?l:0,m=0,n=e.length;m<n;m++)e[m].x-=c.width/2+k||0,e[m].y-=c.height/2+l||0;return new b.Polyline(e,b.util.object.extend(h,c),!0)},b.Polyline.fromObject=function(a){return new b.Polyline(a.points,a,!0)})})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend,f=b.util.array.min,d=b.util.array.max,g=b.util.toFixed;b.Polygon?b.warn("fabric.Polygon is already defined"):(b.Polygon=b.util.createClass(b.Object,{type:"polygon",initialize:function(a,b,c){b=b||{};this.points=a;this.callSuper("initialize",b);this._calcDimensions(c)},_calcDimensions:function(a){var b=this.points,c=f(b,"x"),g=f(b,"y"),m=d(b,"x"),b=d(b,"y");this.width=m-c||1;this.height=b-g||1;this.minX=c;this.minY=g;if(!a){var n=this.width/
2+this.minX,p=this.height/2+this.minY;this.points.forEach(function(a){a.x-=n;a.y-=p},this)}},toObject:function(a){return c(this.callSuper("toObject",a),{points:this.points.concat()})},toSVG:function(){for(var a=[],b=[],c=0,d=this.points.length;c<d;c++)a.push(g(this.points[c].x,2),",",g(this.points[c].y,2)," ");this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!1));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!1));b.push("<polygon ",'points="',a.join(""),'" style="',this.getSvgStyles(),
'" transform="',this.getSvgTransform(),'"/>');return b.join("")},_render:function(a){var b;a.beginPath();a.moveTo(this.points[0].x,this.points[0].y);for(var c=0,d=this.points.length;c<d;c++)b=this.points[c],a.lineTo(b.x,b.y);this._renderFill(a);if(this.stroke||this.strokeDashArray)a.closePath(),this._renderStroke(a)},_renderDashedStroke:function(a){var c,d;a.beginPath();for(var f=0,g=this.points.length;f<g;f++)c=this.points[f],d=this.points[f+1]||this.points[0],b.util.drawDashedLine(a,c.x,c.y,d.x,
d.y,this.strokeDashArray);a.closePath()},complexity:function(){return this.points.length}}),b.Polygon.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat(),b.Polygon.fromElement=function(a,d){if(!a)return null;d||(d={});for(var g=b.parsePointsAttribute(a.getAttribute("points")),l=b.parseAttributes(a,b.Polygon.ATTRIBUTE_NAMES),m=f(g,"x"),n=f(g,"y"),m=0>m?m:0,n=0>m?n:0,p=0,q=g.length;p<q;p++)g[p].x-=d.width/2+m||0,g[p].y-=d.height/2+n||0;return new b.Polygon(g,c(l,d),!0)},b.Polygon.fromObject=function(a){return new b.Polygon(a.points,
a,!0)})})("undefined"!==typeof exports?exports:this);
(function(a){function b(a){return"H"===a[0]?a[1]:a[a.length-2]}function c(a){return"V"===a[0]?a[1]:a[a.length-1]}var f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7};"use strict";var d=a.fabric||(a.fabric={}),g=d.util.array.min,e=d.util.array.max,h=d.util.object.extend,k=Object.prototype.toString,l=d.util.drawArc;d.Path?d.warn("fabric.Path is already defined"):(d.Path=d.util.createClass(d.Object,{type:"path",initialize:function(a,b){b=b||{};this.setOptions(b);if(!a)throw Error("`path` argument is required");
var c="[object Array]"===k.call(a);if(this.path=c?a:a.match&&a.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi))c||(this.path=this._parsePath()),this._initializePath(b),b.sourcePath&&this.setSourcePath(b.sourcePath)},_initializePath:function(a){var b="width"in a&&null!=a.width,c="height"in a&&null!=a.width,d="left"in a,e="top"in a,f=d?this.left:0,g=e?this.top:0;b&&c?(e||(this.top=this.height/2),d||(this.left=this.width/2)):(h(this,this._parseDimensions()),b&&(this.width=a.width),c&&(this.height=a.height));this.pathOffset=
this.pathOffset||this._calculatePathOffset(f,g)},_calculatePathOffset:function(a,b){return{x:this.left-a-this.width/2,y:this.top-b-this.height/2}},_render:function(a){for(var b,c=null,d=0,e=0,f=0,g=0,h,k,t,z,r=-(this.width/2+this.pathOffset.x),s=-(this.height/2+this.pathOffset.y),B=0,C=this.path.length;B<C;++B){b=this.path[B];switch(b[0]){case "l":d+=b[1];e+=b[2];a.lineTo(d+r,e+s);break;case "L":d=b[1];e=b[2];a.lineTo(d+r,e+s);break;case "h":d+=b[1];a.lineTo(d+r,e+s);break;case "H":d=b[1];a.lineTo(d+
r,e+s);break;case "v":e+=b[1];a.lineTo(d+r,e+s);break;case "V":e=b[1];a.lineTo(d+r,e+s);break;case "m":d+=b[1];e+=b[2];a[!c||"m"!==c[0]&&"M"!==c[0]?"moveTo":"lineTo"](d+r,e+s);break;case "M":d=b[1];e=b[2];a[!c||"m"!==c[0]&&"M"!==c[0]?"moveTo":"lineTo"](d+r,e+s);break;case "c":h=d+b[5];k=e+b[6];f=d+b[3];g=e+b[4];a.bezierCurveTo(d+b[1]+r,e+b[2]+s,f+r,g+s,h+r,k+s);d=h;e=k;break;case "C":d=b[5];e=b[6];f=b[3];g=b[4];a.bezierCurveTo(b[1]+r,b[2]+s,f+r,g+s,d+r,e+s);break;case "s":h=d+b[3];k=e+b[4];f=f?2*
d-f:d;g=g?2*e-g:e;a.bezierCurveTo(f+r,g+s,d+b[1]+r,e+b[2]+s,h+r,k+s);f=d+b[1];g=e+b[2];d=h;e=k;break;case "S":h=b[3];k=b[4];f=2*d-f;g=2*e-g;a.bezierCurveTo(f+r,g+s,b[1]+r,b[2]+s,h+r,k+s);d=h;e=k;f=b[1];g=b[2];break;case "q":h=d+b[3];k=e+b[4];f=d+b[1];g=e+b[2];a.quadraticCurveTo(f+r,g+s,h+r,k+s);d=h;e=k;break;case "Q":h=b[3];k=b[4];a.quadraticCurveTo(b[1]+r,b[2]+s,h+r,k+s);d=h;e=k;f=b[1];g=b[2];break;case "t":h=d+b[1];k=e+b[2];null===c[0].match(/[QqTt]/)?(f=d,g=e):"t"===c[0]?(f=2*d-t,g=2*e-z):"q"===
c[0]&&(f=2*d-f,g=2*e-g);t=f;z=g;a.quadraticCurveTo(f+r,g+s,h+r,k+s);d=h;e=k;f=d+b[1];g=e+b[2];break;case "T":h=b[1];k=b[2];f=2*d-f;g=2*e-g;a.quadraticCurveTo(f+r,g+s,h+r,k+s);d=h;e=k;break;case "a":l(a,d+r,e+s,[b[1],b[2],b[3],b[4],b[5],b[6]+d+r,b[7]+e+s]);d+=b[6];e+=b[7];break;case "A":l(a,d+r,e+s,[b[1],b[2],b[3],b[4],b[5],b[6]+r,b[7]+s]);d=b[6];e=b[7];break;case "z":case "Z":a.closePath()}c=b}},render:function(a,b){if(this.visible){a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],
c[3],c[4],c[5]);b||this.transform(a);this.overlayFill?a.fillStyle=this.overlayFill:this.fill&&(a.fillStyle=this.fill.toLive?this.fill.toLive(a):this.fill);this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke);this._setShadow(a);this.clipTo&&d.util.clipContext(this,a);a.beginPath();this._render(a);this._renderFill(a);this._renderStroke(a);this.clipTo&&
a.restore();this._removeShadow(a);!b&&this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(a){a=h(this.callSuper("toObject",a),{path:this.path,pathOffset:this.pathOffset});this.sourcePath&&(a.sourcePath=this.sourcePath);this.transformMatrix&&(a.transformMatrix=this.transformMatrix);return a},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&
(a.path=this.sourcePath);delete a.sourcePath;return a},toSVG:function(){for(var a=[],b=[],c=0,d=this.path.length;c<d;c++)a.push(this.path[c].join(" "));a=a.join(" ");this.fill&&this.fill.toLive&&b.push(this.fill.toSVG(this,!0));this.stroke&&this.stroke.toLive&&b.push(this.stroke.toSVG(this,!0));b.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',a,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',
"/>","</g>");return b.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var a=[],b=[],c,d,e=/(-?\.\d+)|(-?\d+(\.\d+)?)/g,g,h=0,k=this.path.length;h<k;h++){c=this.path[h];g=c.slice(1).trim();for(b.length=0;d=e.exec(g);)b.push(d[0]);c=[c.charAt(0)];g=0;for(var l=b.length;g<l;g++)d=parseFloat(b[g]),isNaN(d)||c.push(d);d=c[0].toLowerCase();d=f[d];if(c.length-1>d)for(g=1,l=c.length;g<l;g+=d)a.push([c[0]].concat(c.slice(g,g+d)));else a.push(c)}return a},_parseDimensions:function(){var a=
[],d=[],f,h,k=!1,l,x;this.path.forEach(function(e,g){"H"!==e[0]&&(f=0===g?b(e):b(this.path[g-1]));"V"!==e[0]&&(h=0===g?c(e):c(this.path[g-1]));e[0]===e[0].toLowerCase()&&(k=!0);l=k?f+b(e):"V"===e[0]?f:b(e);x=k?h+c(e):"H"===e[0]?h:c(e);var t=parseInt(l,10);isNaN(t)||a.push(t);t=parseInt(x,10);isNaN(t)||d.push(t)},this);var w=g(a),A=g(d),t=e(a),z=e(d),t=t-w,z=z-A;return{left:this.left+(w+t/2),top:this.top+(A+z/2),width:t,height:z}}}),d.Path.fromObject=function(a,b){"string"===typeof a.path?d.loadSVGFromURL(a.path,
function(c){c=c[0];var e=a.path;delete a.path;d.util.object.extend(c,a);c.setSourcePath(e);b(c)}):b(new d.Path(a.path,a))},d.Path.ATTRIBUTE_NAMES=d.SHARED_ATTRIBUTES.concat(["d"]),d.Path.fromElement=function(a,b,c){a=d.parseAttributes(a,d.Path.ATTRIBUTE_NAMES);b&&b(new d.Path(a.d,h(a,c)))},d.Path.async=!0)})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend,f=b.util.array.invoke,d=b.Object.prototype.toObject;b.PathGroup?b.warn("fabric.PathGroup is already defined"):(b.PathGroup=b.util.createClass(b.Path,{type:"path-group",fill:"",initialize:function(a,b){b=b||{};this.paths=a||[];for(var c=this.paths.length;c--;)this.paths[c].group=this;this.setOptions(b);this.setCoords();b.sourcePath&&this.setSourcePath(b.sourcePath)},render:function(a){if(this.visible){a.save();var c=this.transformMatrix;
c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(a);this._setShadow(a);this.clipTo&&b.util.clipContext(this,a);for(var c=0,d=this.paths.length;c<d;++c)this.paths[c].render(a,!0);this.clipTo&&a.restore();this._removeShadow(a);this.active&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_set:function(a,b){if(("fill"===a||"overlayFill"===a)&&b&&this.isSameColor())for(var c=this.paths.length;c--;)this.paths[c]._set(a,b);return this.callSuper("_set",a,b)},toObject:function(a){return c(d.call(this,
a),{paths:f(this.getObjects(),"toObject",a),sourcePath:this.sourcePath})},toDatalessObject:function(a){a=this.toObject(a);this.sourcePath&&(a.paths=this.sourcePath);return a},toSVG:function(){for(var a=this.getObjects(),b=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"],c=0,d=a.length;c<d;c++)b.push(a[c].toSVG());b.push("</g>");return b.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},
isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(b){return b.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,b){return a+(b&&b.complexity?b.complexity():0)},0)},toGrayscale:function(){for(var a=this.paths.length;a--;)this.paths[a].toGrayscale();return this},getObjects:function(){return this.paths}}),b.PathGroup.fromObject=function(a,c){"string"===typeof a.paths?b.loadSVGFromURL(a.paths,function(d){var f=a.paths;delete a.paths;
d=b.util.groupSVGElements(d,a,f);c(d)}):b.util.enlivenObjects(a.paths,function(d){delete a.paths;c(new b.PathGroup(d,a))})},b.PathGroup.async=!0)})("undefined"!==typeof exports?exports:this);
(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend,f=b.util.array.min,d=b.util.array.max,g=b.util.array.invoke;if(!b.Group){var e={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};b.Group=b.util.createClass(b.Object,b.Collection,{type:"group",initialize:function(a,b){b=b||{};this._objects=a||[];for(var d=this._objects.length;d--;)this._objects[d].group=this;this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();
b&&c(this,b);this._setOpacityIfSame();this.setCoords(!0);this.saveCoords()},_updateObjectsCoords:function(){var a=this.left,b=this.top;this.forEachObject(function(c){var d=c.get("left"),e=c.get("top");c.set("originalLeft",d);c.set("originalTop",e);c.set("left",d-a);c.set("top",e-b);c.setCoords();c.__origHasControls=c.hasControls;c.hasControls=!1},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this._objects},addWithUpdate:function(a){this._restoreObjectsState();
this._objects.push(a);a.group=this;this.forEachObject(function(a){a.set("active",!0);a.group=this},this);this._calcBounds();this._updateObjectsCoords();return this},removeWithUpdate:function(a){this._restoreObjectsState();this.forEachObject(function(a){a.set("active",!0);a.group=this},this);this.remove(a);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(a){a.group=this},_onObjectRemoved:function(a){delete a.group;a.set("active",!1)},delegatedProperties:{fill:!0,
opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textShadow:!0,textAlign:!0,backgroundColor:!0},_set:function(a,b){if(a in this.delegatedProperties){var c=this._objects.length;for(this[a]=b;c--;)this._objects[c].set(a,b)}else this[a]=b},toObject:function(a){return c(this.callSuper("toObject",a),{objects:g(this._objects,"toObject",a)})},render:function(a,c){if(this.visible){a.save();this.transform(a);var d=Math.max(this.scaleX,this.scaleY);this.clipTo&&
b.util.clipContext(this,a);for(var e=0,f=this._objects.length;e<f;e++){var g=this._objects[e],q=g.borderScaleFactor,u=g.hasRotatingPoint;g.visible&&(g.borderScaleFactor=d,g.hasRotatingPoint=!1,g.render(a),g.borderScaleFactor=q,g.hasRotatingPoint=u)}this.clipTo&&a.restore();!c&&this.active&&(this.drawBorders(a),this.drawControls(a));a.restore();this.setCoords()}},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_restoreObjectState:function(a){var b=
this.get("left"),c=this.get("top"),d=this.getAngle()*(Math.PI/180),e=Math.cos(d)*a.get("top")*this.get("scaleY")+Math.sin(d)*a.get("left")*this.get("scaleX"),d=-Math.sin(d)*a.get("top")*this.get("scaleY")+Math.cos(d)*a.get("left")*this.get("scaleX");a.setAngle(a.getAngle()+this.getAngle());a.set("left",b+d);a.set("top",c+e);a.set("scaleX",a.get("scaleX")*this.get("scaleX"));a.set("scaleY",a.get("scaleY")*this.get("scaleY"));a.setCoords();a.hasControls=a.__origHasControls;delete a.__origHasControls;
a.set("active",!1);a.setCoords();delete a.group;return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(a){a.setCoords()});return this},_setOpacityIfSame:function(){var a=this.getObjects(),b=a[0]?a[0].get("opacity"):1;a.every(function(a){return a.get("opacity")===
b})&&(this.opacity=b)},_calcBounds:function(){var a=[],b=[],c,e;e=0;for(var g=this._objects.length;e<g;++e){c=this._objects[e];c.setCoords();for(var p in c.oCoords)a.push(c.oCoords[p].x),b.push(c.oCoords[p].y)}c=f(a);e=d(a);a=f(b);b=d(b);e=e-c||0;b=b-a||0;this.width=e;this.height=b;this.left=c+e/2||0;this.top=a+b/2||0},toSVG:function(){for(var a=[],b=this._objects.length;b--;)a.push(this._objects[b].toSVG());return'<g transform="'+this.getSvgTransform()+'">'+a.join("")+"</g>"},get:function(a){if(a in
e){if(this[a])return this[a];for(var b=0,c=this._objects.length;b<c;b++)if(this._objects[b][a])return!0;return!1}return a in this.delegatedProperties?this._objects[0]&&this._objects[0].get(a):this[a]}});b.Group.fromObject=function(a,c){b.util.enlivenObjects(a.objects,function(d){delete a.objects;c&&c(new b.Group(d,a))})};b.Group.async=!0}})("undefined"!==typeof exports?exports:this);
(function(a){var b=fabric.util.object.extend;a.fabric||(a.fabric={});a.fabric.Image?fabric.warn("fabric.Image is already defined."):(fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",initialize:function(a,b){b||(b={});this.callSuper("initialize",b);this._initElement(a);this._originalImage=this.getElement();this._initConfig(b);this.filters=[];b.filters&&(this.filters=b.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(a){this._element=a;this._initConfig();
return this},getOriginalSize:function(){var a=this.getElement();return{width:a.width,height:a.height}},render:function(a,b){if(this.visible){a.save();var d=this.transformMatrix;this.group&&"group"!==this.group.type&&a.translate(-this.group.width/2+this.width/2,-this.group.height/2+this.height/2);d&&a.transform(d[0],d[1],d[2],d[3],d[4],d[5]);b||this.transform(a);a.save();this._setShadow(a);this.clipTo&&fabric.util.clipContext(this,a);this._render(a);this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a);
this._renderStroke(a);this.clipTo&&a.restore();a.restore();this.active&&!b&&(this.drawBorders(a),this.drawControls(a));a.restore()}},_stroke:function(a){a.save();a.lineWidth=this.strokeWidth;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin;a.miterLimit=this.strokeMiterLimit;a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke;a.beginPath();a.strokeRect(-this.width/2,-this.height/2,this.width,this.height);a.closePath();a.restore()},_renderDashedStroke:function(a){var b=-this.width/
2,d=-this.height/2,g=this.width,e=this.height;a.save();a.lineWidth=this.strokeWidth;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin;a.miterLimit=this.strokeMiterLimit;a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke;a.beginPath();fabric.util.drawDashedLine(a,b,d,b+g,d,this.strokeDashArray);fabric.util.drawDashedLine(a,b+g,d,b+g,d+e,this.strokeDashArray);fabric.util.drawDashedLine(a,b+g,d+e,b,d+e,this.strokeDashArray);fabric.util.drawDashedLine(a,b,d+e,b,d,this.strokeDashArray);
a.closePath();a.restore()},toObject:function(a){return b(this.callSuper("toObject",a),{src:this._originalImage.src||this._originalImage._src,filters:this.filters.concat()})},toSVG:function(){var a=[];a.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+-this.width/2+" "+-this.height/2+")",'" width="',this.width,'" height="',this.height,'"></image>');if(this.stroke||this.strokeDashArray){var b=this.fill;
this.fill=null;a.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>');this.fill=b}a.push("</g>");return a.join("")},getSrc:function(){return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(a,b){this.constructor.fromObject(this.toObject(b),a)},applyFilters:function(a){if(0===this.filters.length)this.setElement(this._originalImage),
a&&a();else{var b=this._originalImage,d=fabric.util.createCanvasElement(),g=fabric.util.createImage(),e=this;d.width=b.width;d.height=b.height;d.getContext("2d").drawImage(b,0,0,b.width,b.height);this.filters.forEach(function(a){a&&a.applyTo(d)});g.width=b.width;g.height=b.height;if(fabric.isLikelyNode){var h=d.toDataURL("image/png").substring(22);g.src=new Buffer(h,"base64");e._element=g;a&&a()}else g.onload=function(){e._element=g;a&&a();g.onload=d=b=null},g.src=d.toDataURL("image/png");return this}},
_render:function(a){a.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var a=this.getElement();this.set("width",a.width);this.set("height",a.height)},_initElement:function(a){this.setElement(fabric.util.getById(a));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={});this.setOptions(a);this._setWidthHeight(a)},_initFilters:function(a){a.filters&&a.filters.length&&(this.filters=a.filters.map(function(a){return a&&
fabric.Image.filters[a.type].fromObject(a)}))},_setWidthHeight:function(a){this.width="width"in a?a.width:this.getElement().width||0;this.height="height"in a?a.height:this.getElement().height||0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(a,b){var d=fabric.document.createElement("img"),g=a.src;a.width&&(d.width=a.width);a.height&&(d.height=a.height);d.onload=function(){fabric.Image.prototype._initFilters.call(a,
a);var e=new fabric.Image(d,a);b&&b(e);d=d.onload=d.onerror=null};d.onerror=function(){fabric.log("Error loading "+d.src);b&&b(null,!0);d=d.onload=d.onerror=null};d.src=g},fabric.Image.fromURL=function(a,b,d){fabric.util.loadImage(a,function(a){b(new fabric.Image(a,d))})},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat(["x","y","width","height","xlink:href"]),fabric.Image.fromElement=function(a,f,d){a=fabric.parseAttributes(a,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(a["xlink:href"],
f,b(d?fabric.util.object.clone(d):{},a))},fabric.Image.async=!0)})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;return 0<a?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(a){a=a||{};var b=function(){},c=a.onComplete||b,f=a.onChange||b,d=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){d.setAngle(a);
f()},onComplete:function(){d.setCoords();c()},onStart:function(){d.set("active",!1)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){a.straighten();this.renderAll();return this},fxStraightenObject:function(a){a.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.Brightness=fabric.util.createClass({type:"Brightness",initialize:function(a){a=a||{};this.brightness=a.brightness||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.brightness,d=0,g=c.length;d<g;d+=4)c[d]+=f,c[d+1]+=f,c[d+2]+=f;b.putImageData(a,0,0)},toJSON:function(){return{type:this.type,brightness:this.brightness}}});fabric.Image.filters.Brightness.fromObject=function(a){return new fabric.Image.filters.Brightness(a)};
fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.Convolute=fabric.util.createClass({type:"Convolute",initialize:function(a){a=a||{};this.opaque=a.opaque;this.matrix=a.matrix||[0,0,0,0,1,0,0,0,0];this.tmpCtx=fabric.util.createCanvasElement().getContext("2d")},_createImageData:function(a,b){return this.tmpCtx.createImageData(a,b)},applyTo:function(a){var b=this.matrix,c=a.getContext("2d"),f=c.getImageData(0,0,a.width,a.height);a=Math.round(Math.sqrt(b.length));for(var d=Math.floor(a/2),g=f.data,e=f.width,f=f.height,h=this._createImageData(e,
f),k=h.data,l=this.opaque?1:0,m=0;m<f;m++)for(var n=0;n<e;n++){for(var p=m,q=n,u=4*(m*e+n),y=0,x=0,w=0,A=0,t=0;t<a;t++)for(var z=0;z<a;z++){var r=p+t-d,s=q+z-d;0<=r&&(r<f&&0<=s&&s<e)&&(r=4*(r*e+s),s=b[t*a+z],y+=g[r]*s,x+=g[r+1]*s,w+=g[r+2]*s,A+=g[r+3]*s)}k[u]=y;k[u+1]=x;k[u+2]=w;k[u+3]=A+l*(255-A)}c.putImageData(h,0,0)},toJSON:function(){return{type:this.type,opaque:this.opaque,matrix:this.matrix}}});fabric.Image.filters.Convolute.fromObject=function(a){return new fabric.Image.filters.Convolute(a)};
fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.GradientTransparency=fabric.util.createClass({type:"GradientTransparency",initialize:function(a){a=a||{};this.threshold=a.threshold||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.threshold,d=c.length,g=0,e=c.length;g<e;g+=4)c[g+3]=f+255*(d-g)/d;b.putImageData(a,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold}}});
fabric.Image.filters.GradientTransparency.fromObject=function(a){return new fabric.Image.filters.GradientTransparency(a)};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.Grayscale=fabric.util.createClass({type:"Grayscale",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=4*a.width*a.height,d=0,g;d<f;)g=(c[d]+c[d+1]+c[d+2])/3,c[d]=g,c[d+1]=g,c[d+2]=g,d+=4;b.putImageData(a,0,0)},toJSON:function(){return{type:this.type}}});
fabric.Image.filters.Grayscale.fromObject=function(){return new fabric.Image.filters.Grayscale};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.Invert=fabric.util.createClass({type:"Invert",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,f=c.length,d;for(d=0;d<f;d+=4)c[d]=255-c[d],c[d+1]=255-c[d+1],c[d+2]=255-c[d+2];b.putImageData(a,0,0)},toJSON:function(){return{type:this.type}}});fabric.Image.filters.Invert.fromObject=function(){return new fabric.Image.filters.Invert};
fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.Noise=fabric.util.createClass({type:"Noise",initialize:function(a){a=a||{};this.noise=a.noise||100},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.noise,d,g=0,e=c.length;g<e;g+=4)d=(0.5-Math.random())*f,c[g]+=d,c[g+1]+=d,c[g+2]+=d;b.putImageData(a,0,0)},toJSON:function(){return{type:this.type,noise:this.noise}}});fabric.Image.filters.Noise.fromObject=function(a){return new fabric.Image.filters.Noise(a)};
fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.Pixelate=fabric.util.createClass({type:"Pixelate",initialize:function(a){a=a||{};this.blocksize=a.blocksize||4},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,f=a.height,d=a.width,g,e,h,k,l,m,n;for(e=0;e<f;e+=this.blocksize)for(h=0;h<d;h+=this.blocksize){g=4*e*d+4*h;k=c[g];l=c[g+1];m=c[g+2];n=c[g+3];for(var p=e,q=e+this.blocksize;p<q;p++)for(var u=h,y=h+this.blocksize;u<y;u++)g=4*p*d+4*u,c[g]=k,c[g+1]=l,c[g+2]=m,c[g+3]=n}b.putImageData(a,
0,0)},toJSON:function(){return{type:this.type,blocksize:this.blocksize}}});fabric.Image.filters.Pixelate.fromObject=function(a){return new fabric.Image.filters.Pixelate(a)};fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.RemoveWhite=fabric.util.createClass({type:"RemoveWhite",initialize:function(a){a=a||{};this.threshold=a.threshold||30;this.distance=a.distance||20},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);for(var c=a.data,f=this.distance,d=255-this.threshold,g=Math.abs,e,h,k,l=0,m=c.length;l<m;l+=4)e=c[l],h=c[l+1],k=c[l+2],e>d&&(h>d&&k>d&&g(e-h)<f&&g(e-k)<f&&g(h-k)<f)&&(c[l+3]=1);b.putImageData(a,0,0)},toJSON:function(){return{type:this.type,threshold:this.threshold,
distance:this.distance}}});fabric.Image.filters.RemoveWhite.fromObject=function(a){return new fabric.Image.filters.RemoveWhite(a)};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.Sepia=fabric.util.createClass({type:"Sepia",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,f=c.length,d,g;for(d=0;d<f;d+=4)g=0.3*c[d]+0.59*c[d+1]+0.11*c[d+2],c[d]=g+100,c[d+1]=g+50,c[d+2]=g+255;b.putImageData(a,0,0)},toJSON:function(){return{type:this.type}}});
fabric.Image.filters.Sepia.fromObject=function(){return new fabric.Image.filters.Sepia};fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.Sepia2=fabric.util.createClass({type:"Sepia2",applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,f=c.length,d,g,e,h;for(d=0;d<f;d+=4)g=c[d],e=c[d+1],h=c[d+2],c[d]=(0.393*g+0.769*e+0.189*h)/1.351,c[d+1]=(0.349*g+0.686*e+0.168*h)/1.203,c[d+2]=(0.272*g+0.534*e+0.131*h)/2.14;b.putImageData(a,0,0)},toJSON:function(){return{type:this.type}}});
fabric.Image.filters.Sepia2.fromObject=function(){return new fabric.Image.filters.Sepia2};fabric.Image.filters=fabric.Image.filters||{};
fabric.Image.filters.Tint=fabric.util.createClass({type:"Tint",initialize:function(a){a=a||{};this.color=a.color||0},applyTo:function(a){var b=a.getContext("2d");a=b.getImageData(0,0,a.width,a.height);var c=a.data,f=c.length,d,g;d=parseInt(this.color,10).toString(16);var e=parseInt("0x"+d.substr(0,2),16),h=parseInt("0x"+d.substr(2,2),16),k=parseInt("0x"+d.substr(4,2),16);for(d=0;d<f;d+=4)g=c[d+3],0<g&&(c[d]=e,c[d+1]=h,c[d+2]=k);b.putImageData(a,0,0)},toJSON:function(){return{type:this.type,color:this.color}}});
fabric.Image.filters.Tint.fromObject=function(a){return new fabric.Image.filters.Tint(a)};
(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend,f=b.util.object.clone,d=b.util.toFixed,g=b.StaticCanvas.supports("setLineDash");b.Text?b.warn("fabric.Text is already defined"):(a=b.Object.prototype.stateProperties.concat(),a.push("fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","backgroundColor","textBackgroundColor","useNative"),b.Text=b.util.createClass(b.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,
fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,backgroundColor:"",textBackgroundColor:"",path:null,useNative:!0,stateProperties:a,initialize:function(a,b){b=b||{};this.text=a;this.__skipDimension=!0;this.setOptions(b);this.__skipDimension=!1;this._initDimensions();this.setCoords()},_initDimensions:function(){if(!this.__skipDimension){var a=
b.util.createCanvasElement();this._render(a.getContext("2d"))}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(a){var b=this.group&&"group"!==this.group.type;b&&!this.transformMatrix?a.translate(-this.group.width/2+this.left,-this.group.height/2+this.top):b&&this.transformMatrix&&a.translate(-this.group.width/2,-this.group.height/2);"undefined"===typeof Cufon||!0===this.useNative?this._renderViaNative(a):
this._renderViaCufon(a)},_renderViaNative:function(a){this.transform(a,b.isLikelyNode);this._setTextStyles(a);var c=this.text.split(/\r?\n/);this.width=this._getTextWidth(a,c);this.height=this._getTextHeight(a,c);this.clipTo&&b.util.clipContext(this,a);this._renderTextBackground(a,c);"left"!==this.textAlign&&"justify"!==this.textAlign&&(a.save(),a.translate("center"===this.textAlign?this.width/2:this.width,0));a.save();this._setTextShadow(a);this._renderTextFill(a,c);this._renderTextStroke(a,c);this.textShadow&&
a.restore();a.restore();"left"!==this.textAlign&&"justify"!==this.textAlign&&a.restore();this._renderTextDecoration(a,c);this.clipTo&&a.restore();this._setBoundaries(a,c);this._totalLineHeight=0;this.setCoords()},_setBoundaries:function(a,b){this._boundaries=[];for(var c=0,d=b.length;c<d;c++){var f=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(f);this._boundaries.push({height:this.fontSize*this.lineHeight,width:f,left:g})}},_setTextStyles:function(a){this.fill&&(a.fillStyle=this.fill.toLive?
this.fill.toLive(a):this.fill);this.stroke&&(a.lineWidth=this.strokeWidth,a.lineCap=this.strokeLineCap,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,a.strokeStyle=this.stroke.toLive?this.stroke.toLive(a):this.stroke);a.textBaseline="alphabetic";a.textAlign=this.textAlign;a.font=this._getFontDeclaration()},_getTextHeight:function(a,b){return this.fontSize*b.length*this.lineHeight},_getTextWidth:function(a,b){for(var c=a.measureText(b[0]).width,d=1,f=b.length;d<f;d++){var g=a.measureText(b[d]).width;
g>c&&(c=g)}return c},_setTextShadow:function(a){if(this.textShadow){var b=/\s+(-?\d+)(?:px)?\s+(-?\d+)(?:px)?\s+(\d+)(?:px)?\s*/,c=this.textShadow,d=b.exec(this.textShadow),b=c.replace(b,"");a.save();a.shadowColor=b;a.shadowOffsetX=parseInt(d[1],10);a.shadowOffsetY=parseInt(d[2],10);a.shadowBlur=parseInt(d[3],10);this._shadows=[{blur:a.shadowBlur,color:a.shadowColor,offX:a.shadowOffsetX,offY:a.shadowOffsetY}];this._shadowOffsets=[[parseInt(a.shadowOffsetX,10),parseInt(a.shadowOffsetY,10)]]}},_drawTextLine:function(a,
b,c,d,f){if("justify"!==this.textAlign)b[a](c,d,f);else{var g=b.measureText(c).width,p=this.width;if(p>g){g=c.split(/\s+/);c=b.measureText(c.replace(/\s+/g,"")).width;for(var p=(p-c)/(g.length-1),q=c=0,u=g.length;q<u;q++)b[a](g[q],d+c,f),c+=b.measureText(g[q]).width+p}else b[a](c,d,f)}},_getLeftOffset:function(){return!b.isLikelyNode||"left"!==this.originX&&"center"!==this.originX?-this.width/2:0},_getTopOffset:function(){return b.isLikelyNode?"center"===this.originY?-this.height/2:"bottom"===this.originY?
-this.height:0:-this.height/2},_renderTextFill:function(a,b){if(this.fill){this._boundaries=[];for(var c=0,d=b.length;c<d;c++)this._drawTextLine("fillText",a,b[c],this._getLeftOffset(),this._getTopOffset()+c*this.fontSize*this.lineHeight+this.fontSize)}},_renderTextStroke:function(a,b){if(this.stroke){a.save();this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),g&&a.setLineDash(this.strokeDashArray));a.beginPath();for(var c=
0,d=b.length;c<d;c++)this._drawTextLine("strokeText",a,b[c],this._getLeftOffset(),this._getTopOffset()+c*this.fontSize*this.lineHeight+this.fontSize);a.closePath();a.restore()}},_renderTextBackground:function(a,b){this._renderTextBoxBackground(a);this._renderTextLinesBackground(a,b)},_renderTextBoxBackground:function(a){this.backgroundColor&&(a.save(),a.fillStyle=this.backgroundColor,a.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),a.restore())},_renderTextLinesBackground:function(a,
b){if(this.textBackgroundColor){a.save();a.fillStyle=this.textBackgroundColor;for(var c=0,d=b.length;c<d;c++)if(""!==b[c]){var f=this._getLineWidth(a,b[c]),g=this._getLineLeftOffset(f);a.fillRect(this._getLeftOffset()+g,this._getTopOffset()+c*this.fontSize*this.lineHeight,f,this.fontSize*this.lineHeight)}a.restore()}},_getLineLeftOffset:function(a){return"center"===this.textAlign?(this.width-a)/2:"right"===this.textAlign?this.width-a:0},_getLineWidth:function(a,b){return"justify"===this.textAlign?
this.width:a.measureText(b).width},_renderTextDecoration:function(a,b){function c(g){for(var k=0,q=b.length;k<q;k++){var u=f._getLineWidth(a,b[k]),y=f._getLineLeftOffset(u);a.fillRect(f._getLeftOffset()+y,g+k*f.fontSize*f.lineHeight-d,u,1)}}if(this.textDecoration){var d="top"===this.originY?0:this._getTextHeight(a,b)/2,f=this;-1<this.textDecoration.indexOf("underline")&&c(this.fontSize);-1<this.textDecoration.indexOf("line-through")&&c(this.fontSize/2);-1<this.textDecoration.indexOf("overline")&&
c(0)}},_getFontDeclaration:function(){return[b.isLikelyNode?this.fontWeight:this.fontStyle,b.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",b.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(a,b){this.visible&&(a.save(),this._render(a),!b&&this.active&&(this.drawBorders(a),this.drawControls(a)),a.restore())},toObject:function(a){return c(this.callSuper("toObject",a),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,
fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,path:this.path,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative})},toSVG:function(){var a=this.text.split(/\r?\n/),b=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,c=-(this.width/2),f=this.useNative?this.fontSize-1:this.height/2-a.length*this.fontSize-this._totalLineHeight,
g=this._getSVGTextAndBg(b,c,a),a=this._getSVGShadows(b,a),f=f+(this._fontAscent?this._fontAscent/5*this.lineHeight:0);return['<g transform="',this.getSvgTransform(),'">',g.textBgRects.join(""),"<text ",this.fontFamily?"font-family=\"'"+this.fontFamily+"'\" ":"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),
'" transform="translate(',d(c,2)," ",d(f,2),')">',a.join(""),g.textSpans.join(""),"</text></g>"].join("")},_getSVGShadows:function(a,c){var f=[],g,m,n,p,q=1;if(!this._shadows||!this._boundaries)return f;g=0;for(n=this._shadows.length;g<n;g++)for(m=0,p=c.length;m<p;m++)""!==c[m]?(f.push('<tspan x="',d((this._boundaries&&this._boundaries[m]?this._boundaries[m].left:0)+q+this._shadowOffsets[g][0],2),0===m||this.useNative?'" y':'" dy','="',d(this.useNative?a*m-this.height/2+this._shadowOffsets[g][1]:
a+(0===m?this._shadowOffsets[g][1]:0),2),'" ',this._getFillAttributes(this._shadows[g].color),">",b.util.string.escapeXml(c[m]),"</tspan>"),q=1):q++;return f},_getSVGTextAndBg:function(a,c,f){var g=[],m=[],n,p,q,u=1;this.backgroundColor&&this._boundaries&&m.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',d(-this.width/2,2),'" y="',d(-this.height/2,2),'" width="',d(this.width,2),'" height="',d(this.height,2),'"></rect>');n=0;for(q=f.length;n<q;n++)""!==f[n]?(p=this._boundaries&&
this._boundaries[n]?d(this._boundaries[n].left,2):0,g.push('<tspan x="',p,'" ',0===n||this.useNative?"y":"dy",'="',d(this.useNative?a*n-this.height/2:a*u,2),'" ',this._getFillAttributes(this.fill),">",b.util.string.escapeXml(f[n]),"</tspan>"),u=1):u++,this.textBackgroundColor&&this._boundaries&&m.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',d(c+this._boundaries[n].left,2),'" y="',d(a*n-this.height/2,2),'" width="',d(this._boundaries[n].width,2),'" height="',d(this._boundaries[n].height,
2),'"></rect>');return{textSpans:g,textBgRects:m}},_getFillAttributes:function(a){var c=a&&"string"===typeof a?new b.Color(a):"";return c&&c.getSource()&&1!==c.getAlpha()?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},setColor:function(a){this.set("fill",a);return this},getText:function(){return this.text},_set:function(a,b){"fontFamily"===a&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+b+"$3"));this.callSuper("_set",a,b);a in this._dimensionAffectingProps&&
(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),b.Text.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("x y font-family font-style font-weight font-size text-decoration".split(" ")),b.Text.fromElement=function(a,c){if(!a)return null;var d=b.parseAttributes(a,b.Text.ATTRIBUTE_NAMES);c=b.util.object.extend(c?b.util.object.clone(c):{},d);d=new b.Text(a.textContent,c);d.set({left:d.getLeft()+d.getWidth()/2,top:d.getTop()-d.getHeight()/2});return d},b.Text.fromObject=function(a){return new b.Text(a.text,
f(a))},b.util.createAccessors(b.Text))})("undefined"!==typeof exports?exports:this);
fabric.util.object.extend(fabric.Text.prototype,{_renderViaCufon:function(a){var b=Cufon.textOptions||(Cufon.textOptions={});b.left=this.left;b.top=this.top;b.context=a;b.color=this.fill;var c=this._initDummyElementForCufon();this.transform(a);Cufon.replaceElement(c,{engine:"canvas",separate:"none",fontFamily:this.fontFamily,fontWeight:this.fontWeight,textDecoration:this.textDecoration,textShadow:this.textShadow,textAlign:this.textAlign,fontStyle:this.fontStyle,lineHeight:this.lineHeight,stroke:this.stroke,
strokeWidth:this.strokeWidth,backgroundColor:this.backgroundColor,textBackgroundColor:this.textBackgroundColor});this.width=b.width;this.height=b.height;this._totalLineHeight=b.totalLineHeight;this._fontAscent=b.fontAscent;this._boundaries=b.boundaries;this._shadowOffsets=b.shadowOffsets;this._shadows=b.shadows||[];this.setCoords()},_initDummyElementForCufon:function(){var a=fabric.document.createElement("pre");fabric.document.createElement("div").appendChild(a);"undefined"===typeof G_vmlCanvasManager?
a.innerHTML=this.text:a.innerText=this.text.replace(/\r?\n/gi,"\r");a.style.fontSize=this.fontSize+"px";a.style.letterSpacing="normal";return a}});
(function(){function a(a,b,c){var e=f.parse(a);e.port||(e.port=0===e.protocol.indexOf("https:")?443:80);a=(443===e.port?g:d).request({hostname:e.hostname,port:e.port,path:e.path,method:"GET"},function(a){var d="";b&&a.setEncoding(b);a.on("end",function(){c(d)});a.on("data",function(b){200===a.statusCode&&(d+=b)})});a.on("error",function(a){a.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+e.hostname+":"+e.port):fabric.log(a.message)});a.end()}function b(a,b){var c=require("fs").createReadStream(a),
d="";c.on("data",function(a){d+=a});c.on("end",function(){b(d)})}if("undefined"===typeof document||"undefined"===typeof window){var c=(new require("xmldom")).DOMParser,f=require("url"),d=require("http"),g=require("https"),e=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(c,d,e){var f=function(a){g.src=new Buffer(a,"binary");g._src=c;d&&d.call(e,g)},g=new h;c&&(c instanceof Buffer||0===c.indexOf("data"))?(g.src=g._src=c,d&&d.call(e,g)):c&&0!==c.indexOf("http")?b(c,f):c&&
a(c,"binary",f)};fabric.loadSVGFromURL=function(c,d){c=c.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();0!==c.indexOf("http")?b(c,function(a){fabric.loadSVGFromString(a,d)}):a(c,"",function(a){fabric.loadSVGFromString(a,d)})};fabric.loadSVGFromString=function(a,b){var d=(new c).parseFromString(a);fabric.parseSVGDocument(d.documentElement,function(a,c){b(a,c)})};fabric.util.getScript=function(b,c){a(b,"",function(a){eval(a);c&&c()})};fabric.Image.fromObject=function(a,b){fabric.util.loadImage(a.src,
function(c){c=new fabric.Image(c);c._initConfig(a);c._initFilters(a);b(c)})};fabric.createCanvasForNode=function(a,b){var c=fabric.document.createElement("canvas"),d=new e(a||600,b||600);c.style={};c.width=d.width;c.height=d.height;c=new (fabric.Canvas||fabric.StaticCanvas)(c);c.contextContainer=d.getContext("2d");c.nodeCanvas=d;c.Font=e.Font;return c};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=
function(a){return this.nodeCanvas.createJPEGStream(a)};var k=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(a){k.call(this,a);this.nodeCanvas.width=a;return this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var l=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(a){l.call(this,a);this.nodeCanvas.height=a;return this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}})();Event.Publisher=Class.create({eventTargets:null,eventSourceId:null,getEventSourceId:function(){return"function"==typeof this.eventSourceId?this.eventSourceId():this.eventSourceId},getEventTarget:function(a){this.eventTargets=this.eventTargets||[];this.eventTargets[a]||document.body.appendChild(this.eventTargets[a]=document.createElement("A"));return this.eventTargets[a]},addEventListener:function(a,b,c){Event.observe(this.getEventTarget(a),"click",b)},removeEventListener:function(a,b,c){Event.stopObserving(this.getEventTarget(a),
"click",b)},dispatchEvent:function(a,b,c,f){Event.create({eventName:a,eventTarget:this,data:b?b:null},c||!1,f||!1,!0,this.getEventTarget(a))}});
Event.Listener=Class.create({listens:null,getEventHandlerName:function(a){a=a.split(/[ _]/).join("-").camelize();return"on"+a.charAt(0).toUpperCase()+a.substr(1)},listenForEvent:function(a,b,c,f){f=f||this.getEventHandlerName(b);this.listens=this.listens||[];var d=this[f].bindAsEventListener(this);this.listens.push([a,b,c,f,d]);a.addEventListener(b,d,c)},stopListeningForEvent:function(a,b,c,f){if(!this.listens)return!1;f=f||this.getEventHandlerName(b);var d=-1,g=this.listens.detect(function(e,g){return e[0]==
a&&e[1]==b&&e[2]==c&&e[3]==f?(d=g,!0):!1});return 0<=d?(this.listens.splice(d,1),a.removeEventListener(b,g[4],c),!0):!1}});
Object.extend(Event,{create:function(a,b,c,f,d){var g;document.createEvent?(b=b||!1,c=c||!1,/Konqueror|Safari|KHTML/.test(navigator.userAgent)?(g=document.createEvent("HTMLEvents"),g.initEvent("click",b,c)):(g=document.createEvent("MouseEvents"),g.initMouseEvent("click",b,c,window,0,0,0,0,0,!1,!1,!1,!1,0,null))):(g=document.createEventObject(),g.eventType="onclick");g.eventData=a;f&&Event.dispatch(d,g);return g},dispatch:function(a,b){return document.createEvent?a.dispatchEvent(b):a.fireEvent("undefined"!=
typeof b.eventType?b.eventType:"onclick",b)}});
Event.Broker=Class.create({listeners:null,publishers:null,initListenerType:function(a){null==this.listeners&&(this.listeners={});"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[])},initPublisherType:function(a){null==this.publishers&&(this.publishers={});void 0==this.publishers[a]&&(this.publishers[a]=[])},registerEventsPublisher:function(a,b){"object"!=typeof a&&(a=[a]);a.each(function(a){this.initPublisherType(a);this.publishers[a].push(b);this.initListenerType(a);this.listeners[a].each(function(f){b.addEventListener(a,
f.listener,f.useCapture)})}.bind(this))},unregisterEventsPublisher:function(a,b){"object"!=typeof a&&(a=[a]);a.each(function(a){this.listeners[a].each(function(d){b.removeEventListener(a,d.listener,d.useCapture)});var f=this.publishers[a].indexOf(b);-1<f&&this.publishers[a].splice(f,1)}.bind(this))},addEventListener:function(a,b,c){this.initListenerType(a);this.listeners[a].push({listener:b,useCapture:c});this.initPublisherType(a);this.publishers[a].each(function(f){f.addEventListener(a,b,c)})},removeEventListener:function(a,
b,c){this.publishers[a].each(function(d){d.removeEventListener(a,b,c)});var f=-1;this.listeners[a].each(function(a,b){f=b;throw $break;});-1<f&&this.listeners[a].splice(f,1)}});/*
    Copyright (c)  Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
"undefined"==typeof window.Speroteck&&(window.Speroteck={});
Speroteck.QuadNode=Class.create({objects:[],nodes:[],parent:void 0,left:0,eLeft:void 0,right:0,eRight:void 0,bottom:0,eBottom:void 0,top:0,eTop:void 0,width:0,eWidth:void 0,height:0,eHeight:void 0,maxObjects:16,f:2,initialize:function(a){a=a||{};this.canvas=a.canvas;this.left=a.left||0;this.eLeft=void 0;this.right=a.right||0;this.eRight=void 0;this.top=a.top||0;this.eTop=void 0;this.bottom=a.bottom||0;this.eBottom=void 0;this.parent=a.parent||void 0;this.nodes=a.nodes||[];this.objects=a.objects||
[];this.height=a.height||this.bottom-this.top;this.eWidth=void 0;this.width=a.width||this.right-this.left;this.eHeight=void 0;this.maxObjects=a.max||this.maxObjects},split:function(){var a=this.height/2,b=this.width/2;this.nodes.push(new Speroteck.QuadNode({top:this.top,left:this.left,bottom:this.top+a,right:this.left+b,parent:this,width:b,height:a,canvas:this.canvas,max:2*this.maxObjects}));this.nodes.push(new Speroteck.QuadNode({top:this.top,left:this.left+b,bottom:this.top+a,right:this.right,parent:this,
width:b,height:a,canvas:this.canvas,max:2*this.maxObjects}));this.nodes.push(new Speroteck.QuadNode({top:this.top+a,left:this.left,bottom:this.bottom,right:this.left+b,parent:this,width:b,height:a,canvas:this.canvas,max:this.maxObjects}));this.nodes.push(new Speroteck.QuadNode({top:this.top+a,left:this.left+b,bottom:this.bottom,right:this.right,parent:this,width:b,height:a,canvas:this.canvas,max:2*this.maxObjects}));for(a=0;a<this.objects.length;a+=1){for(b=0;b<this.nodes.length;b+=1)this.nodes[b].isInsideExtended(this.objects[a][0])&&
this.nodes[b].objects.push([this.objects[a][0],this.objects[a][1]]);this.objects.splice(a,1);a=-1}return this},add:function(a,b){var c;if(!this.isInsideExtended(a))return this;if(this.objects.length<this.maxObjects&&!this.nodes.length)this.objects.push([a,b]);else for(this.nodes.length||this.split(),c=0;c<this.nodes.length;c+=1)this.nodes[c].add(a,b);return this},isInside:function(a){return this.left<=a.x&&a.x<=this.right&&this.top<=a.y&&a.y<=this.bottom},getObjects:function(a){var b;return-1!==(b=
this.getQuadrantExtended(a))?this.nodes[b].getObjects(a):this.getAllObjects()},getAllObjects:function(){for(var a=this.objects,b=this.parent;"undefined"!==typeof b;)a=a.concat(b.objects),b=b.parent;return a},isEmpty:function(a,b){var c;for(c=0;c<this.objects.length;c+=1)if(32>Math.abs(a-this.objects[c][0].x)&&32>Math.abs(b-this.objects[c][0].y))return!1;for(c=0;c<this.nodes.length;c+=1)if(this.nodes[c].isInside({x:a,y:b}))return this.nodes[c].isEmpty(a,b);return!0},remove:function(a){var b;for(b=
0;b<this.objects.length;b+=1)a.x===this.objects[b][0].x&&a.y===this.objects[b][0].y&&(this.objects.splice(b,1),b=0);for(b=0;b<this.nodes.length;b+=1)this.nodes[b].remove(a);return this},isInsideExtended:function(a){return this.getExtendedLeft()<a.getLeft()&&a.getRight()<this.getExtendedRight()&&this.getExtendedTop()<a.getTop()&&a.getBottom()<this.getExtendedBottom()},getQuadrantExtended:function(a){var b;for(b=0;b<this.nodes.length;b+=1)if(this.nodes[b].isInsideExtended(a)&&this.nodes[b].isInside(a))return b;
return-1},getExtendedLeft:function(){"undefined"===typeof this.eLeft&&(this.eLeft=this.right-this.getExtendedWidth());return this.eLeft},getExtendedRight:function(){"undefined"===typeof this.eRight&&(this.eRight=this.left+this.getExtendedWidth());return this.eRight},getExtendedTop:function(){"undefined"===typeof this.eTop&&(this.eTop=this.bottom-this.getExtendedHeight());return this.eTop},getExtendedBottom:function(){"undefined"===typeof this.eBottom&&(this.eBottom=this.top+this.getExtendedHeight());
return this.eBottom},getExtendedWidth:function(){"undefined"===typeof this.eWidth&&(this.eWidth=this.width*this.f);return this.eWidth},getExtendedHeight:function(){"undefined"===typeof this.eHeight&&(this.eHeight=this.height*this.f);return this.eHeight},reset:function(){var a;this.objects=[];for(a=0;a<this.nodes.length;a+=1)this.nodes[a].reset();return this}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
"undefined"==typeof window.Speroteck&&(window.Speroteck={});
Speroteck.Game=Class.create({gameCycle:0,board:void 0,config:void 0,initialize:function(a){this.config=Speroteck.Game.config;"undefined"===typeof a?alert("You need to pass valid init params..."):a.hasOwnProperty("dynamicCanvas")?(this.canvas=a.dynamicCanvas,this.gameCycle=0,this.board=new Speroteck.Game.Board(a),this.enableGameCycle()):alert("Canvas is not defined...")},enableGameCycle:function(){this.gameCycle||(this.gameCycle=window.setInterval(function(){this.canvas.renderAll()}.bind(this),this.config.renderInterval))},
disableGameCycle:function(){this.gameCycle&&(window.clearInterval(this.gameCycle),this.gameCycle=!1)}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
"undefined"===typeof Speroteck.Game.config&&(Speroteck.Game.config={});Object.extend(Speroteck.Game.config,{cellWidth:32,cellHeight:32,cellWidth2:16,cellHeight2:16,numCellsHor:20,numCellsVer:20,upDirection:360,leftDirection:270,downDirection:180,rightDirection:90,renderInterval:20});isSet=function(a){return"undefined"!==typeof a};/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Object.extend(Speroteck.Game.config,{math:{random:function(a){return Math.floor(Math.random()*a+1)},isIntersection:function(a,b){var c=a.B.x-a.A.x,f=b.B.x-b.A.x,d=a.B.y-a.A.y,g=b.B.y-b.A.y,e=g*c-f*d;if(0==e)return!1;var h=a.A.x-b.A.x,k=a.A.y-b.A.y,f=(f*k-g*h)/e,c=(c*k-d*h)/e;return!(0>f||1<f||0>c||1<c)},Line:Class.create({A:{x:0,y:0},B:{x:0,y:0},initialize:function(a){a=a||[0,0,0,0];this.A={x:a[0],y:a[1]};this.B={x:a[2],y:a[3]}}}),Rectangle:Class.create({A:{x:0,y:0},B:{x:0,y:0},C:{x:0,y:0},D:{x:0,
y:0},x:0,y:0,width:0,height:0,top:0,left:0,right:0,bottom:0,topLine:void 0,bottomLine:void 0,leftLine:void 0,rightLine:void 0,initialize:function(a){a=a||[0,0,0,0,0,0,0,0];this.A={x:a[0],y:a[1]};this.B={x:a[2],y:a[3]};this.C={x:a[4],y:a[5]};this.D={x:a[6],y:a[7]};this.topLine=this.right=this.left=this.bottom=this.top=void 0;this.getTopLine();this.bottomLine=void 0;this.getBottomLine();this.leftLine=void 0;this.getLeftLine();this.rightLine=void 0;this.getRightLine();this.width=this.right-this.left;
this.height=this.bottom-this.top;this.x=(this.getRight()+this.getLeft())/2;this.y=(this.getBottom()+this.getTop())/2},getLeft:function(){return"undefined"!==typeof this.left?this.left:this.left=Math.min(this.A.x,this.B.x,this.C.x,this.D.x)},getRight:function(){return"undefined"!==typeof this.right?this.right:this.right=Math.max(this.A.x,this.B.x,this.C.x,this.D.x)},getTop:function(){return"undefined"!==typeof this.top?this.top:this.top=Math.min(this.A.y,this.B.y,this.C.y,this.D.y)},getBottom:function(){return"undefined"!==
typeof this.bottom?this.bottom:this.bottom=Math.max(this.A.y,this.B.y,this.C.y,this.D.y)},getBottomLine:function(){return"undefined"!==typeof this.bottomLine?this.bottomLine:this.bottomLine=this.getLine(this.getLeft(),this.getBottom(),this.getRight(),this.getBottom())},getTopLine:function(){return"undefined"!==typeof this.topLine?this.topLine:this.topLine=this.getLine(this.getLeft(),this.getTop(),this.getRight(),this.getTop())},getRightLine:function(){return"undefined"!==typeof this.rightLine?this.rightLine:
this.rightLine=this.getLine(this.getRight(),this.getTop(),this.getRight(),this.getBottom())},getLeftLine:function(){return"undefined"!==typeof this.leftLine?this.leftLine:this.leftLine=this.getLine(this.getLeft(),this.getTop(),this.getLeft(),this.getBottom())},getLine:function(a,b,c,f){return new Speroteck.Game.config.math.Line([a,b,c,f])}})}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
*/
"undefined"==typeof window.Speroteck&&(window.Speroteck={});
Speroteck.Image=Class.create({imgData:void 0,canvas:void 0,x:0,y:0,angle:0,config:Speroteck.Game.config,initialize:function(a){a=a||{};this.x=a.x||0;this.y=a.y||0;this.angle=a.angle||0;this.canvas=a.canvas;this.setImage(a.hasOwnProperty("imgElement")?a.imgElement:void 0)},setImage:function(a){this.imgData=new fabric.Group(["undefined"===typeof a?fabric.Rect({x:this.x,y:this.y,width:this.config.cellWidth,height:this.config.cellHeight}):new fabric.Image($(a),{left:this.x,top:this.y,angle:this.angle,
opacity:1})],{left:this.x,top:this.y});this.canvas.add(this.imgData)},addFabricObject:function(a){this.canvas.add(this.imgData.addWithUpdate(a.set({left:this.imgData.getLeft(),top:this.imgData.getTop()})))},destroy:function(){this.canvas.remove(this.imgData);delete this.imgData},move:function(a,b,c){this.imgData&&(this.imgData.get("left")!==a&&this.imgData.set("left",a),this.imgData.get("top")!==b&&this.imgData.set("top",b),"undefined"!==typeof c&&this.imgData.get("angle")!==c&&this.imgData.set("angle",
c))}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
"undefined"==typeof window.Speroteck&&(window.Speroteck={});
Speroteck.Object=Class.create(Event.Publisher,{imageObj:void 0,x:0,y:0,config:Speroteck.Game.config,imgId:"",type:"",speed:0,canvas:void 0,width:0,height:0,width2:0,height2:0,angle:0,board:void 0,initialize:function(a){a=a||{};this.width=a.width||this.config.cellWidth;this.height=a.height||this.config.cellHeight;this.width2=this.width/2;this.height2=this.height/2;this.x=a.x||0;this.y=a.y||0;this.canvas=a.canvas;"undefined"===typeof a.imageObj&&Object.extend(a,{imageObj:new Speroteck.Image({canvas:a.canvas,
imgElement:this.imgId,x:a.hasOwnProperty("x")?a.x:0,y:a.hasOwnProperty("y")?a.y:0})});this.rectangle=void 0;this.imageObj=a.imageObj;this.board=a.board},getRectangle:function(){return new Speroteck.Game.config.math.Rectangle([this.x-this.width2,this.y-this.height2,this.x+this.width2,this.y-this.height2,this.x-this.width2,this.y+this.height2,this.x+this.width2,this.y+this.height2])},getLineTracesUp:function(){var a=this.getRectangle(),b=a.getLeft(),c=a.getTop(),f=c-this.speed,d=a.getRight();return{l1:a.getLine(b,
c,b,f),l2:a.getLine(d,c,d,f)}},getLineTracesDown:function(){var a=this.getRectangle(),b=a.getLeft(),c=a.getBottom(),f=c+this.speed,d=a.getRight();return{l1:a.getLine(b,c,b,f),l2:a.getLine(d,c,d,f)}},getLineTracesLeft:function(){var a=this.getRectangle(),b=a.getLeft(),c=b-this.speed,f=a.getBottom(),d=a.getTop();return{l1:a.getLine(b,d,c,d),l2:a.getLine(b,f,c,f)}},getLineTracesRight:function(){var a=this.getRectangle(),b=a.getTop(),c=a.getBottom(),f=a.getRight(),d=f+this.speed;return{l1:a.getLine(f,
b,d,b),l2:a.getLine(f,c,d,c)}},move:function(a){switch(a){case this.config.upDirection:this.y-=this.speed;break;case this.config.leftDirection:this.x-=this.speed;break;case this.config.downDirection:this.y+=this.speed;break;case this.config.rightDirection:this.x+=this.speed}this.reDraw();return this},reDraw:function(){this.imageObj.move(this.x,this.y,this.angle);return this},setDirection:function(a){this.angle=a||this.angle;this.imageObj.move(this.x,this.y,this.angle);return this},setStopped:function(a){this.stopped=
a;return this},isStopped:function(){return this.stopped}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle=Class.create(Speroteck.Object,{rectangle:void 0,initialize:function($super,b){this.rectangle=void 0;$super(b)},getRectangle:function($super){return"undefined"!==typeof this.rectangle?this.rectangle:this.rectangle=$super()},acceptBullet:function(){return this}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Brick=Class.create(Speroteck.Object.Obstacle,{armor:0,imgId:"speroteck-image-brick",type:"brick",destructionTypes:["speroteck-image-brick-left","speroteck-image-brick-right","speroteck-image-brick-up","speroteck-image-brick-down"],initialize:function($super,b){this.armor=2;$super(b);this.board.registerEventsPublisher(["brick_destroy","brick_update_before","brick_update_after"],this)},acceptBullet:function(a){this.armor-=1;if(0<this.armor){this.dispatchEvent("brick_update_before");
switch(a){case this.config.upDirection:this.imageObj.destroy();this.width=this.config.cellWidth;this.height=this.config.cellHeight2;this.y+=this.config.cellHeight2/2;this.imgId=this.destructionTypes[3];break;case this.config.downDirection:this.imageObj.destroy();this.width=this.config.cellWidth;this.height=this.config.cellHeight2;this.y-=this.config.cellHeight2/2;this.imgId=this.destructionTypes[2];break;case this.config.leftDirection:this.imageObj.destroy();this.height=this.config.cellHeight;this.width=
this.config.cellWidth2;this.x+=this.config.cellWidth2/2;this.imgId=this.destructionTypes[1];break;case this.config.rightDirection:this.imageObj.destroy(),this.height=this.config.cellHeight,this.width=this.config.cellWidth2,this.x-=this.config.cellWidth2/2,this.imgId=this.destructionTypes[0]}this.width2=this.width/2;this.height2=this.height/2;this.imageObj=new Speroteck.Image({canvas:this.canvas,imgElement:this.imgId,x:this.x,y:this.y});this.rectangle=void 0;this.dispatchEvent("brick_update_after")}else 0===
this.armor&&(this.imageObj.destroy(),this.dispatchEvent("brick_destroy"))}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Grass=Class.create(Speroteck.Object.Obstacle,{imgId:"speroteck-image-grass",type:"grass"});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Water=Class.create(Speroteck.Object.Obstacle,{imgId:"speroteck-image-water",type:"water"});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Concrete=Class.create(Speroteck.Object.Obstacle,{imgId:"speroteck-image-concrete",type:"concrete"});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Concrete.Right=Class.create(Speroteck.Object.Obstacle.Concrete,{imgId:"speroteck-image-concrete-right",initialize:function($super,b){b=b||{};b.height=this.config.cellHeight;b.width=this.config.cellWidth2;b.x+=this.config.cellWidth2/2;$super(b)}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Concrete.Left=Class.create(Speroteck.Object.Obstacle.Concrete,{imgId:"speroteck-image-concrete-left",initialize:function($super,b){b=b||{};b.height=this.config.cellHeight;b.width=this.config.cellWidth2;b.x-=this.config.cellWidth2/2;$super(b)}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Concrete.Up=Class.create(Speroteck.Object.Obstacle.Concrete,{imgId:"speroteck-image-concrete-up",initialize:function($super,b){b=b||{};b.width=this.config.cellWidth;b.height=this.config.cellHeight2;b.y-=this.config.cellHeight2/2;$super(b)}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Concrete.Down=Class.create(Speroteck.Object.Obstacle.Concrete,{imgId:"speroteck-image-concrete-down",initialize:function($super,b){b=b||{};b.width=this.config.cellWidth;b.height=this.config.cellHeight2;b.y+=this.config.cellHeight2/2;$super(b)}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Obstacle.Home=Class.create(Speroteck.Object.Obstacle,{imgId:"speroteck-image-home",type:"home"});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Tank=Class.create(Speroteck.Object,{armor:0,fireRate:500,fireRateInterval:0,type:"tank",config:void 0,stopped:!1,bullets:[],initialize:function($super,b){b=b||{};this.speed=b.speed||this.speed;this.armor=b.armor||this.armor;this.board=b.board;this.config=this.board.config;this.stopped=!1;this.fireRateInterval=0;this.bullets=[];this.registerEvents();Object.extend(b,{width:this.config.cellWidth-1,height:this.config.cellHeight-1});$super(b)},registerEvents:function(){this.board.registerEventsPublisher(["tank_move_up",
"tank_move_down","tank_move_left","tank_move_right","tank_destroy"],this)},up:function(){this.angle!==this.config.upDirection?(this.setStopped(!1),this.setDirection(this.config.upDirection)):this.dispatchEvent("tank_move_up");return this},down:function(){this.angle!==this.config.downDirection?(this.setDirection(this.config.downDirection),this.setStopped(!1)):this.dispatchEvent("tank_move_down");return this},left:function(){this.angle!==this.config.leftDirection?(this.setDirection(this.config.leftDirection),
this.setStopped(!1)):this.dispatchEvent("tank_move_left");return this},right:function(){this.angle!==this.config.rightDirection?(this.setDirection(this.config.rightDirection),this.setStopped(!1)):this.dispatchEvent("tank_move_right");return this},acceptBullet:function(){this.armor?this.armor--:this.destroy();return this},destroy:function(){this.imageObj.destroy();this.dispatchEvent("tank_destroy");return this},move:function(a){switch(a){case this.config.upDirection:this.y-=this.speed;break;case this.config.leftDirection:this.x-=
this.speed;break;case this.config.downDirection:this.y+=this.speed;break;case this.config.rightDirection:this.x+=this.speed}this.reDraw();return this},reDraw:function(){this.imageObj.move(this.x,this.y,this.angle);return this},setDirection:function(a){this.angle=a||this.angle;this.imageObj.move(this.x,this.y,this.angle)},setStopped:function(a){this.stopped=a;return this},isStopped:function(){return this.stopped},fire:function(){var a;if(!this.fireRateInterval){switch(this.angle){case this.config.downDirection:a=
new Speroteck.Object.Bullet({canvas:this.canvas,board:this.board,x:this.x,y:this.y+this.height2-10,angle:this.angle,owner:this});break;case this.config.upDirection:a=new Speroteck.Object.Bullet({canvas:this.canvas,board:this.board,x:this.x,y:this.y-this.height2+10,angle:this.angle,owner:this});break;case this.config.leftDirection:a=new Speroteck.Object.Bullet({canvas:this.canvas,board:this.board,x:this.x-this.width2+10,y:this.y,angle:this.angle,owner:this});break;case this.config.rightDirection:a=
new Speroteck.Object.Bullet({canvas:this.canvas,board:this.board,x:this.x+this.width2-10,y:this.y,angle:this.angle,owner:this})}a&&(this.addBullet(a),this.board.objTree.add(a.getRectangle(),a));this.fireRateInterval=window.setTimeout(function(){this.fireRateInterval=0}.bind(this),this.fireRate);return this}},addBullet:function(a){this.bullets.push(a);return this},removeBullet:function(a){var b;a=a||{};for(b=0;b<this.bullets.length;b+=1)if(this.bullets[b].x===a.x&&this.bullets[b].y===a.y){this.bullets.splice(b,
1);break}return this}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Tank.M1=Class.create(Speroteck.Object.Tank,{imgId:"speroteck-image-enemy-1",speed:2});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Tank.M2=Class.create(Speroteck.Object.Tank,{imgId:"speroteck-image-enemy-2",speed:4});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Tank.M3=Class.create(Speroteck.Object.Tank,{imgId:"speroteck-image-enemy-3",speed:2});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Tank.M4=Class.create(Speroteck.Object.Tank,{imgId:"speroteck-image-enemy-4",speed:1});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Tank.M5=Class.create(Speroteck.Object.Tank,{imgId:"speroteck-image-player",speed:4,type:"player"});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Object.Bullet=Class.create(Speroteck.Object,{speed:5,type:"bullet",stopped:!1,imgId:"speroteck-image-bullet",interval:0,owner:void 0,initialize:function($super,b){b=b||{};b.width=10;b.height=20;this.speed=b.speed||this.speed;this.board=b.board;this.angle=b.angle;this.registerEvents();this.owner=b.owner;$super(b);this.run()},run:function(){this.interval=window.setInterval(function(){switch(this.angle){case this.config.upDirection:this.up();break;case this.config.downDirection:this.down();
break;case this.config.leftDirection:this.left();break;case this.config.rightDirection:this.right()}}.bind(this),20)},registerEvents:function(){this.board.registerEventsPublisher(["bullet_move_up","bullet_move_down","bullet_move_left","bullet_move_right","bullet_destroy"],this)},up:function(){this.dispatchEvent("bullet_move_up");return this},down:function(){this.dispatchEvent("bullet_move_down");return this},left:function(){this.dispatchEvent("bullet_move_left");return this},right:function(){this.dispatchEvent("bullet_move_right");
return this},acceptBullet:function(){this.destroy();return this},destroy:function(){this.imageObj.destroy();window.clearInterval(this.interval);this.interval=0;this.dispatchEvent("bullet_destroy")},getOwner:function(){return this.owner}});/*
   Copyright (c) Speroteck Inc. http://www.speroteck.com
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Object.extend(Speroteck.Game.config,{objMap:[0,Speroteck.Object.Obstacle.Brick,Speroteck.Object.Obstacle.Grass,Speroteck.Object.Obstacle.Water,Speroteck.Object.Obstacle.Concrete,Speroteck.Object.Obstacle.Concrete.Up,Speroteck.Object.Obstacle.Concrete.Down,Speroteck.Object.Obstacle.Concrete.Left,Speroteck.Object.Obstacle.Concrete.Right,Speroteck.Object.Obstacle.Home]});
Speroteck.Game.Board=Class.create(Event.Broker,{levelUrl:"",level:0,data:[],zdata:[],imgData:[],objTree:void 0,config:Speroteck.Game.config,canvases:void 0,player:void 0,gameMaster:void 0,width:void 0,height:void 0,ai:void 0,initialize:function(a){this.canvases=a.canvases;this.levelUrl=a.levelUrl;this.level=a.level||0;this.loadLevel()},loadLevel:function(){new Ajax.Request(this.levelUrl,{method:"get",parameters:{level:this.level},onComplete:this.onComplete.bind(this)})},onComplete:function(a){try{var b=
a.responseText.evalJSON()}catch(c){console.log(a)}if(b.map){this.data=b.map.split("\n");b.zmap&&(this.zdata=b.zmap.split("\n"));this.imgData=[];a=0;for(b=this.data.length;a<b;++a){this.imgData[a]=[];for(var f=0,d=this.data[a].length;f<d;++f)parseInt(this.data[a][f])?this.imgData[a][f]="undefined"!==typeof this.config.objMap[parseInt(this.data[a][f])]?new (this.config.objMap[parseInt(this.data[a][f])])({x:this.config.cellWidth2+f*this.config.cellWidth,y:this.config.cellHeight2+a*this.config.cellHeight,
canvas:"undefined"!==typeof this.canvases[parseInt(this.zdata[a][f])]?this.canvases[parseInt(this.zdata[a][f])]:this.canvases[0],board:this}):this.data[a][f]:this.imgData[a][f]=0}this.player=new Speroteck.Game.Player({tank:new Speroteck.Object.Tank.M5({canvas:this.canvases[1],board:this,x:this.config.cellWidth2+(d/2-3)*this.config.cellWidth,y:this.config.cellHeight2+(b-1)*this.config.cellHeight})});this.initObjectTree();this.ai=new Speroteck.Game.AI({board:this});this.gameMaster=new Speroteck.Game.Master({board:this})}else alert("Can't load level. Check levelUrl in the config params, check that file data/level-0000.txt exists...")},
getWidth:function(){"undefined"===typeof this.width&&(this.width=this.config.numCellsHor*this.config.cellWidth);return this.width},getHeight:function(){"undefined"===typeof this.height&&(this.height=this.config.numCellsVer*this.config.cellHeight);return this.height},initObjectTree:function(){var a,b;this.objTree=new Speroteck.QuadNode({left:-2,right:this.getWidth()+2,top:-2,bottom:this.getHeight()+2,canvas:this.canvases[this.canvases.length-1]});for(a=0;a<this.config.numCellsVer;++a)for(b=0;b<this.config.numCellsHor;++b)"object"===
typeof this.imgData[a][b]&&"grass"!==this.imgData[a][b].type&&this.objTree.add(this.imgData[a][b].getRectangle(),this.imgData[a][b]);this.objTree.add(this.player.tank.getRectangle(),this.player.tank)}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Game.Player=Class.create(Speroteck.Game,{tank:void 0,keyInterval:50,keyDownInterval:0,keyUpOccurred:!1,initialize:function(a){a=a||{};this.tank=a.tank;this.enableControl()},enableControl:function(){$(document).observe("keydown",function(a){var b=!1;if(!this.keyDownInterval||32===a.keyCode){switch(a.keyCode){case Event.KEY_UP:b="up";break;case Event.KEY_LEFT:b="left";break;case Event.KEY_DOWN:b="down";break;case Event.KEY_RIGHT:b="right";break;case 32:this.tank.fire();break;case Event.KEY_ESC:window.location.reload()}b&&
(this.keyDownInterval=window.setInterval(function(){this.tank[b]()}.bind(this),this.keyInterval))}}.bind(this));$(document).observe("keyup",function(a){32!==a.keyCode&&(window.clearInterval(this.keyDownInterval),this.keyDownInterval=0)}.bind(this))}});/*
    Copyright (c) 2013 Speroteck Inc. (www.speroteck.com)
 @author       Speroteck team (dev@speroteck.com)
 @license     http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
*/
Speroteck.Game.AI=Class.create(Speroteck.Game,{numTanks:35,numInSquad:4,squad:[],board:void 0,config:Speroteck.Game.config,gameCycle:0,checkSquadCycle:0,allowedCells:[],initialize:function(a){a=a||{};this.numTanks=a.all||this.numTanks;this.numInSquad=a.squad||this.numInSquad;this.board=a.board;this.squad=[];this.allowedCells=a.allowedCells||[{x:this.config.cellWidth2,y:this.config.cellHeight2},{x:this.config.cellWidth2+this.config.numCellsHor/4*this.config.cellWidth,y:this.config.cellHeight2},{x:this.config.cellWidth2+
this.config.numCellsHor/2*this.config.cellWidth,y:this.config.cellHeight2},{x:-this.config.cellWidth2+this.config.numCellsHor*this.config.cellWidth,y:this.config.cellHeight2}];this.initSquad();this.enableControl()},initSquad:function(){this.checkSquadCycle||(this.checkSquadCycle=window.setInterval(function(){var a,b;if(!(this.squad.length>=this.numInSquad))for(var c=0;c<this.allowedCells.length;++c){a=this.allowedCells[c];if(this.board.objTree.isEmpty(a.x,a.y)){switch(this.config.math.random(4)){case 1:b=
Speroteck.Object.Tank.M1;break;case 2:b=Speroteck.Object.Tank.M2;break;case 3:b=Speroteck.Object.Tank.M3;break;case 4:b=Speroteck.Object.Tank.M4;break;default:b=Speroteck.Object.Tank.M1}this.squad.push(new b({canvas:this.board.canvases[1],board:this.board,x:a.x,y:a.y}));this.board.objTree.add(this.squad[this.squad.length-1].getRectangle(),this.squad[this.squad.length-1])}if(this.squad.length>=this.numInSquad)break}}.bind(this),3500))},enableControl:function(){this.gameCycle=window.setInterval(function(){this.commandSquad()}.bind(this),
50)},commandSquad:function(){this.squad.each(function(a){if(a.isStopped())this.randomChangeDirection(a);else switch(a.angle){case this.config.upDirection:1!=this.config.math.random(100)?a.up():this.randomChangeDirection(a);break;case this.config.downDirection:1!=this.config.math.random(100)?a.down():this.randomChangeDirection(a);break;case this.config.leftDirection:1!=this.config.math.random(100)?a.left():this.randomChangeDirection(a);break;case this.config.rightDirection:1!=this.config.math.random(100)?
a.right():this.randomChangeDirection(a);break;default:this.randomChangeDirection(a)}3==this.config.math.random(25)&&a.fire()}.bind(this))},removeFromSquad:function(a){var b;for(b=0;b<this.squad.length;b+=1)a.x===this.squad[b].x&&a.y===this.squad[b].y&&this.squad.splice(b,1);this.numTanks--||(window.clearInterval(this.checkSquadCycle),this.checkSquadCycle=0)},randomChangeDirection:function(a){switch(this.config.math.random(10)){case 1:a.down();break;case 2:a.right();break;case 3:a.up();break;case 4:a.left();
break;default:a.down()}}});Speroteck.Game.Master=Class.create(Event.Listener,{board:void 0,config:Speroteck.Game.config,objTree:void 0,initialize:function(a){a=a||{};this.board=a.board;this.objTree=this.board.objTree;this.subscribeOnTankEvents()},subscribeOnTankEvents:function(){this.listenForEvent(this.board,"tank_move_up");this.listenForEvent(this.board,"tank_move_left");this.listenForEvent(this.board,"tank_move_down");this.listenForEvent(this.board,"tank_move_right");this.listenForEvent(this.board,"bullet_move_up");this.listenForEvent(this.board,
"bullet_move_left");this.listenForEvent(this.board,"bullet_move_down");this.listenForEvent(this.board,"bullet_move_right");this.listenForEvent(this.board,"bullet_destroy");this.listenForEvent(this.board,"tank_destroy");this.listenForEvent(this.board,"brick_destroy");this.listenForEvent(this.board,"brick_update_before");this.listenForEvent(this.board,"brick_update_after")},removeFromTree:function(a){this.objTree.remove(a.getRectangle());return this},addToTree:function(a){this.objTree.add(a.getRectangle(),
a);return this},getTreeNeighbours:function(a){return this.objTree.getObjects(a.getRectangle())},onTankMoveUp:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);a.setStopped(!0);(b=this.getCollisionsUp(a))?a.y=b.y+a.speed:a.y-a.speed<a.height2?a.y=a.height2+a.speed:a.setStopped(!1);a.move(this.config.upDirection);this.addToTree(a)},onTankMoveLeft:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);a.setStopped(!0);(b=this.getCollisionsLeft(a))?a.x=b.x+a.speed:a.x-a.speed<
a.width2?a.x=a.width2+a.speed:a.setStopped(!1);a.move(this.config.leftDirection);this.addToTree(a)},onTankMoveDown:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);a.setStopped(!0);(b=this.getCollisionsDown(a))?a.y=b.y-a.speed:a.y+a.speed+a.height2>this.board.getHeight()?a.y=this.board.getHeight()-a.speed-a.height2:a.setStopped(!1);a.move(this.config.downDirection);this.addToTree(a)},onTankMoveRight:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);a.setStopped(!0);
(b=this.getCollisionsRight(a))?a.x=b.x-a.speed:a.x+a.speed+a.width2>this.board.getWidth()?a.x=this.board.getWidth()-a.speed-a.width2:a.setStopped(!1);a.move(this.config.rightDirection);this.addToTree(a)},onBulletMoveUp:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);(b=this.getCollisionsUp(a))?(a.y=b.y+a.speed,b.object.acceptBullet(this.config.downDirection),a.destroy()):a.y-a.speed<a.height2?(a.y=a.height2+a.speed,a.destroy()):(a.move(this.config.upDirection),this.addToTree(a))},
onBulletMoveLeft:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);(b=this.getCollisionsLeft(a))?(a.x=b.x+a.speed,b.object.acceptBullet(this.config.rightDirection),a.destroy()):a.x-a.speed<a.width2?(a.x=a.width2+a.speed,a.destroy()):(a.move(this.config.leftDirection),this.addToTree(a))},onBulletMoveDown:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);(b=this.getCollisionsDown(a))?(a.y=b.y-a.speed,b.object.acceptBullet(this.config.upDirection),a.destroy()):a.y+a.speed+
a.height2>this.board.getHeight()?(a.y=this.board.getHeight()-a.speed-a.height2,a.destroy()):(a.move(this.config.downDirection),this.addToTree(a))},onBulletMoveRight:function(a){a=a.eventData.eventTarget;var b;this.removeFromTree(a);(b=this.getCollisionsRight(a))?(a.x=b.x-a.speed,b.object.acceptBullet(this.config.leftDirection),a.destroy()):a.x+a.speed+a.width2>this.board.getWidth()?(a.x=this.board.getWidth()-a.speed-a.width2,a.destroy()):(a.move(this.config.rightDirection),this.addToTree(a))},onBulletDestroy:function(a){a=
a.eventData.eventTarget;var b=a.getOwner();this.removeFromTree(a);b.removeBullet(a)},onTankDestroy:function(a){a=a.eventData.eventTarget;this.removeFromTree(a);this.board.ai.removeFromSquad(a)},onBrickDestroy:function(a){this.removeFromTree(a.eventData.eventTarget)},onBrickUpdateBefore:function(a){this.removeFromTree(a.eventData.eventTarget)},onBrickUpdateAfter:function(a){this.addToTree(a.eventData.eventTarget)},getCollisionsUp:function(a){var b=this.getTreeNeighbours(a),c,f=void 0,d,g;d=0;for(g=
b.length;d<g;d+=1)if(c=this.isIntersectionWithObstacleUp(f="undefined"===typeof f?a.getLineTracesUp():f,b[d][0]))return{y:c+a.height2,object:b[d][1]};return!1},getCollisionsDown:function(a){var b=this.getTreeNeighbours(a),c,f=void 0,d,g;d=0;for(g=b.length;d<g;d+=1)if(c=this.isIntersectionWithObstacleDown(f="undefined"===typeof f?a.getLineTracesDown():f,b[d][0]))return{y:c-a.height2,object:b[d][1]};return!1},getCollisionsRight:function(a){var b=this.getTreeNeighbours(a),c,f=void 0,d,g;d=0;for(g=b.length;d<
g;d+=1)if(c=this.isIntersectionWithObstacleRight(f="undefined"===typeof f?a.getLineTracesRight():f,b[d][0]))return{x:c-a.width2,object:b[d][1]};return!1},getCollisionsLeft:function(a){var b=this.getTreeNeighbours(a),c,f=void 0,d,g;d=0;for(g=b.length;d<g;d+=1)if(c=this.isIntersectionWithObstacleLeft(f="undefined"===typeof f?a.getLineTracesLeft():f,b[d][0]))return{x:c+a.width2,object:b[d][1]};return!1},isIntersectionWithObstacleUp:function(a,b){var c=b.getBottomLine();return this.config.math.isIntersection(a.l1,
c)||this.config.math.isIntersection(a.l2,c)?b.getBottom()+0.5:!1},isIntersectionWithObstacleDown:function(a,b){var c=b.getTopLine();return this.config.math.isIntersection(a.l1,c)||this.config.math.isIntersection(a.l2,c)?b.getTop()-0.5:!1},isIntersectionWithObstacleRight:function(a,b){var c=b.getLeftLine();return this.config.math.isIntersection(a.l1,c)||this.config.math.isIntersection(a.l2,c)?b.getLeft()-0.5:!1},isIntersectionWithObstacleLeft:function(a,b){var c=b.getRightLine();return this.config.math.isIntersection(a.l1,
c)||this.config.math.isIntersection(a.l2,c)?b.getRight()+0.5:!1}});
